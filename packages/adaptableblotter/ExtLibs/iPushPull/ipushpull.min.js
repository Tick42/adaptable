!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ipushpull=e():t.ipushpull=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=14)}([function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var dateFormat=__webpack_require__(33),Emitter_1=__webpack_require__(1),$q,api,RangesWrap=function(){function t(t,e){$q=t,api=e}return t}();exports.RangesWrap=RangesWrap;var AccessRange=function(){function t(t,e,n){this.name=t,this.range=e,this.config=n,this.rights={},this.exp=n.exp,this.rights=n.rights,this.permission=n.permission,"self"===n.range?this.updateRange={from:"R:C",to:"R:C"}:this.updateRange={from:n.range.start,to:n.range.end}}return t.prototype.toObject=function(){return{name:this.name,start:this.range.from.row+":"+this.range.from.col,end:this.range.to.row+":"+this.range.to.col,exp:this.exp,permission:this.permission,range:{start:""+this.updateRange.from,end:""+this.updateRange.to},rights:this.rights,freeze:!1,style:!1,button:!1,notification:!1,access:!0}},t}();exports.AccessRange=AccessRange;var NotificationRange=function(){function t(t,e,n){this.name=t,this.range=e,this.config=n,this.exp=n.exp,this.message=n.message}return t.prototype.toObject=function(){return{name:this.name,start:this.range.from.row+":"+this.range.from.col,end:this.range.to.row+":"+this.range.to.col,exp:this.exp,message:this.message,freeze:!1,style:!1,button:!1,notification:!0}},t}();exports.NotificationRange=NotificationRange;var StyleRange=function(){function StyleRange(t,e,n){this.name=t,this.range=e,this.config=n,this.rangeExp=!1,this.exp=n.exp,this.formatting=n.formatting}return StyleRange.prototype.toObject=function(){return{name:this.name,start:this.range.from.row+":"+this.range.from.col,end:this.range.to.row+":"+this.range.to.col,exp:this.exp,formatting:this.formatting,freeze:!1,button:!1,style:!0}},StyleRange.prototype.parseFormat=function(format,row,col,rowEnd,colEnd){void 0===rowEnd&&(rowEnd=-1),void 0===colEnd&&(colEnd=-1);var start=format.start.replace(/R/gi,row).replace(/C/gi,col).split(":"),end=format.end.replace(/R/gi,row).replace(/C/gi,col).split(":"),startRow=parseInt(eval(start[0]),10),startCol=parseInt(eval(start[1]),10),endRow=parseInt(eval(end[0]),10),endCol=parseInt(eval(end[1]),10);return{from:{row:startRow,col:startCol},to:{row:endRow<0?rowEnd:endRow,col:endCol<0?colEnd:endCol},style:format.style}},StyleRange.prototype.match=function(value){var VALUE=parseFloat(value)||value;try{return eval(this.exp)}catch(t){return!1}},StyleRange}();exports.StyleRange=StyleRange;var ButtonRange=function(){function ButtonRange(t,e,n){this.name=t,this.range=e,this.config=n,this.rangeExp=!1,this.exp=n.exp,this.setters=n.setters,"self"===n.range?this.updateRange={from:"R:C",to:"R:C"}:this.updateRange={from:n.range.start,to:n.range.end}}return ButtonRange.prototype.run=function(t,e){var n=this;void 0===e&&(e={});var i=[];return t.forEach2(function(t,r){t&&t.forEach2(function(t,o){t&&i.push(n.data(r,o,t,e))})}),i},ButtonRange.prototype.toObject=function(){var t={name:this.name,start:this.range.from.row+":"+this.range.from.col,end:this.range.to.row+":"+this.range.to.col,exp:this.exp,setters:this.setters,range:{start:""+this.updateRange.from,end:""+this.updateRange.to},rangeExp:this.rangeExp,freeze:!1,style:!1,button:!0};return"self"===this.config.range&&(t.range="self"),t},ButtonRange.prototype.parseRange=function(pos){var fromRow=this.updateRange.from.split(":")[0].replace(/R/gi,pos.row).replace(/C/gi,pos.col),fromCol=this.updateRange.from.split(":")[1].replace(/R/gi,pos.row).replace(/C/gi,pos.col),toRow=this.updateRange.to.split(":")[0].replace(/R/gi,pos.row).replace(/C/gi,pos.col),toCol=this.updateRange.to.split(":")[1].replace(/R/gi,pos.row).replace(/C/gi,pos.col);return{from:{row:eval(fromRow),col:eval(fromCol)},to:{row:eval(toRow),col:eval(toCol)}}},ButtonRange.prototype.actionRotate=function(t,e){if(!e||!e.length)return t;for(var n=t,i=0;i<e.length;i++)if(n===e[i]){n=e[i+1]?e[i+1]:e[0];break}return n===t&&(n=e[0]),n},ButtonRange.prototype.actionToday=function(t){void 0===t&&(t="yyyy-mm-dd");var e=new Date;return dateFormat(e,t)},ButtonRange.prototype.data=function(row,col,cell,vars){void 0===vars&&(vars={});var data={value:cell.value,formatted_value:cell.formatted_value};vars["=ROTATE"]="this.actionRotate",vars["=TODAY"]="this.actionToday";var exp=""+this.exp;for(var key in vars)exp=exp.replace(new RegExp(key,"g"),vars[key]);var VALUE=!/^[0-9\.\-]+$/.test(cell.value)||isNaN(cell.value)?cell.value:parseFloat(cell.value);try{VALUE=eval(exp)}catch(t){VALUE=VALUE}return data.value=VALUE,data.formatted_value=VALUE,{row:row,col:col,data:data}},ButtonRange}();exports.ButtonRange=ButtonRange;var PermissionRange=function(){function t(t,e,n,i,r,o){void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),this.name=t,this.rowStart=e,this.rowEnd=n,this.colStart=i,this.colEnd=r,this._permissions={ro:[],no:[]},o&&(this._permissions=o)}return t.prototype.setPermission=function(t,e){this._permissions.ro.indexOf(t)>=0&&this._permissions.ro.splice(this._permissions.ro.indexOf(t),1),this._permissions.no.indexOf(t)>=0&&this._permissions.no.splice(this._permissions.no.indexOf(t),1),e&&this._permissions[e].push(t)},t.prototype.getPermission=function(t){var e="";return this._permissions.ro.indexOf(t)>=0?e="ro":this._permissions.no.indexOf(t)>=0&&(e="no"),e},t.prototype.toObject=function(){return{name:this.name,start:this.rowStart+":"+this.colStart,end:this.rowEnd+":"+this.colEnd,rights:this._permissions,freeze:!1,button:!1,style:!1}},t}();exports.PermissionRange=PermissionRange;var FreezingRange=function(){function t(t,e,n){void 0===e&&(e="rows"),void 0===n&&(n=1),this.name=t,this.subject=e,this.count=n}return Object.defineProperty(t,"SUBJECT_ROWS",{get:function(){return"rows"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SUBJECT_COLUMNS",{get:function(){return"cols"},enumerable:!0,configurable:!0}),t.prototype.toObject=function(){var e={name:this.name,start:"0:0",end:"",rights:{ro:[],no:[]},freeze:!0,button:!1,style:!1};return this.subject===t.SUBJECT_ROWS?e.end=this.count-1+":-1":e.end="-1:"+(this.count-1),e},t}();exports.FreezingRange=FreezingRange;var Ranges=function(t){function e(e,n,i){var r=t.call(this)||this;return r._ranges=[],r._folderId=e,r._pageId=n,i&&r.parse(i),r}return __extends(e,t),Object.defineProperty(e.prototype,"TYPE_PERMISSION_RANGE",{get:function(){return"permissions"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TYPE_FREEZING_RANGE",{get:function(){return"freezing"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_UPDATED",{get:function(){return"updated"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ranges",{get:function(){return this._ranges},enumerable:!0,configurable:!0}),e.prototype.setRanges=function(t){return this._ranges=t,this},e.prototype.addRange=function(t){if(t instanceof FreezingRange)for(var e=0;e<this._ranges.length;e++)if(this._ranges[e].subject===t.subject){this.removeRange(this._ranges[e].name);break}for(var n=!1,i=t.name,r=1;!n;){n=!0;for(var e=0;e<this._ranges.length;e++)this._ranges[e].name===i&&(n=!1,i=t.name+"_"+r,r++)}return t.name=i,this._ranges.push(t),this},e.prototype.removeRange=function(t){for(var e=-1,n=0;n<this._ranges.length;n++)if(this._ranges[n].name===t){e=n;break}return e>=0&&this._ranges.splice(e,1),this},e.prototype.save=function(){for(var t=this,e=$q.defer(),n=[],i=0;i<this._ranges.length;i++)n.push(this._ranges[i].toObject());var r={domainId:this._folderId,pageId:this._pageId,data:{access_rights:JSON.stringify(n)}};return api.savePageSettings(r).then(function(n){t.emit(t.EVENT_UPDATED),e.resolve(n)},e.reject),e.promise},e.prototype.parse=function(t){var e=JSON.parse(t);this._ranges=[];for(var n=0;n<e.length;n++){var i={from:{row:parseInt(e[n].start.split(":")[0],10),col:parseInt(e[n].start.split(":")[1],10)},to:{row:parseInt(e[n].end.split(":")[0],10),col:parseInt(e[n].end.split(":")[1],10)}};if(e[n].style)this._ranges.push(new StyleRange(e[n].name,i,e[n]));else if(e[n].notification)this._ranges.push(new NotificationRange(e[n].name,i,e[n]));else if(e[n].access)this._ranges.push(new AccessRange(e[n].name,i,e[n]));else if(e[n].button)this._ranges.push(new ButtonRange(e[n].name,i,e[n]));else if(e[n].freeze){var r=i.to.col>=0?"cols":"rows",o=i.to.col>=0?i.to.col+1:i.to.row+1;this._ranges.push(new FreezingRange(e[n].name,r,o))}else this._ranges.push(new PermissionRange(e[n].name,i.from.row,i.to.row,i.from.col,i.to.col,e[n].rights))}return this._ranges},e}(Emitter_1.default);exports.Ranges=Ranges},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){var t=this;this.listeners=[],this.onListeners={},this.on=function(e,n){t.onListeners[e]||(t.onListeners[e]=[]),t.onListeners[e].push(n)},this.off=function(e,n){if(t.onListeners[e]){var i=t.onListeners[e].indexOf(n);i>-1&&t.onListeners[e].splice(i,1)}},this.register=function(e){t.listeners.push(e)}}return t.prototype.unRegister=function(t){var e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1)},t.prototype.emit=function(t,e){if(this.listeners.forEach2(function(n){n(t,e)}),this.onListeners[t])for(var n=1*this.onListeners[t].length,i=0;i<n;i++)this.onListeners[t]&&this.onListeners[t][i]&&this.onListeners[t][i](e)},t.prototype.removeEvent=function(){this.listeners=[],this.onListeners={}},t}();e.default=i},function(t,e,n){(function(t){!function(e){function n(t,e){if("object"!==r(t))return e;for(var i in e)"object"===r(t[i])&&"object"===r(e[i])?t[i]=n(t[i],e[i]):t[i]=e[i];return t}function i(t,e,i){var s=i[0],a=i.length;(t||"object"!==r(s))&&(s={});for(var c=0;c<a;++c){var l=i[c];if("object"===r(l))for(var u in l){var h=t?o.clone(l[u]):l[u];s[u]=e?n(s[u],h):h}}return s}function r(t){return{}.toString.call(t).slice(8,-1).toLowerCase()}var o=function(t){return i(!0===t,!1,arguments)};o.recursive=function(t){return i(!0===t,!0,arguments)},o.clone=function(t){var e,n,i=t,s=r(t);if("array"===s)for(i=[],n=t.length,e=0;e<n;++e)i[e]=o.clone(t[e]);else if("object"===s){i={};for(e in t)i[e]=o.clone(t[e])}return i},e?t.exports=o:window.merge=o}("object"==typeof t&&t&&"object"==typeof t.exports&&t.exports)}).call(e,n(9)(t))},function(t,e,n){(function(t,n){var i,r;!function(){var o="object"==typeof self&&self.self===self&&self||"object"==typeof t&&t.global===t&&t||this||{},s=o._,a=Array.prototype,c=Object.prototype,l="undefined"!=typeof Symbol?Symbol.prototype:null,u=a.push,h=a.slice,d=c.toString,f=c.hasOwnProperty,p=Array.isArray,g=Object.keys,y=Object.create,v=function(){},m=function(t){return t instanceof m?t:this instanceof m?void(this._wrapped=t):new m(t)};void 0===e||e.nodeType?o._=m:(void 0!==n&&!n.nodeType&&n.exports&&(e=n.exports=m),e._=m),m.VERSION="1.9.1";var _,b=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,o){return t.call(e,n,i,r,o)}}return function(){return t.apply(e,arguments)}},w=function(t,e,n){return m.iteratee!==_?m.iteratee(t,e):null==t?m.identity:m.isFunction(t)?b(t,e,n):m.isObject(t)&&!m.isArray(t)?m.matcher(t):m.property(t)};m.iteratee=_=function(t,e){return w(t,e,1/0)};var E=function(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var o=Array(e+1);for(r=0;r<e;r++)o[r]=arguments[r];return o[e]=i,t.apply(this,o)}},x=function(t){if(!m.isObject(t))return{};if(y)return y(t);v.prototype=t;var e=new v;return v.prototype=null,e},C=function(t){return function(e){return null==e?void 0:e[t]}},k=function(t,e){return null!=t&&f.call(t,e)},T=function(t,e){for(var n=e.length,i=0;i<n;i++){if(null==t)return;t=t[e[i]]}return n?t:void 0},S=Math.pow(2,53)-1,O=C("length"),P=function(t){var e=O(t);return"number"==typeof e&&e>=0&&e<=S};m.each=m.forEach=function(t,e,n){e=b(e,n);var i,r;if(P(t))for(i=0,r=t.length;i<r;i++)e(t[i],i,t);else{var o=m.keys(t);for(i=0,r=o.length;i<r;i++)e(t[o[i]],o[i],t)}return t},m.map=m.collect=function(t,e,n){e=w(e,n);for(var i=!P(t)&&m.keys(t),r=(i||t).length,o=Array(r),s=0;s<r;s++){var a=i?i[s]:s;o[s]=e(t[a],a,t)}return o};var R=function(t){var e=function(e,n,i,r){var o=!P(e)&&m.keys(e),s=(o||e).length,a=t>0?0:s-1;for(r||(i=e[o?o[a]:a],a+=t);a>=0&&a<s;a+=t){var c=o?o[a]:a;i=n(i,e[c],c,e)}return i};return function(t,n,i,r){var o=arguments.length>=3;return e(t,b(n,r,4),i,o)}};m.reduce=m.foldl=m.inject=R(1),m.reduceRight=m.foldr=R(-1),m.find=m.detect=function(t,e,n){var i=P(t)?m.findIndex:m.findKey,r=i(t,e,n);if(void 0!==r&&-1!==r)return t[r]},m.filter=m.select=function(t,e,n){var i=[];return e=w(e,n),m.each(t,function(t,n,r){e(t,n,r)&&i.push(t)}),i},m.reject=function(t,e,n){return m.filter(t,m.negate(w(e)),n)},m.every=m.all=function(t,e,n){e=w(e,n);for(var i=!P(t)&&m.keys(t),r=(i||t).length,o=0;o<r;o++){var s=i?i[o]:o;if(!e(t[s],s,t))return!1}return!0},m.some=m.any=function(t,e,n){e=w(e,n);for(var i=!P(t)&&m.keys(t),r=(i||t).length,o=0;o<r;o++){var s=i?i[o]:o;if(e(t[s],s,t))return!0}return!1},m.contains=m.includes=m.include=function(t,e,n,i){return P(t)||(t=m.values(t)),("number"!=typeof n||i)&&(n=0),m.indexOf(t,e,n)>=0},m.invoke=E(function(t,e,n){var i,r;return m.isFunction(e)?r=e:m.isArray(e)&&(i=e.slice(0,-1),e=e[e.length-1]),m.map(t,function(t){var o=r;if(!o){if(i&&i.length&&(t=T(t,i)),null==t)return;o=t[e]}return null==o?o:o.apply(t,n)})}),m.pluck=function(t,e){return m.map(t,m.property(e))},m.where=function(t,e){return m.filter(t,m.matcher(e))},m.findWhere=function(t,e){return m.find(t,m.matcher(e))},m.max=function(t,e,n){var i,r,o=-1/0,s=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t){t=P(t)?t:m.values(t);for(var a=0,c=t.length;a<c;a++)null!=(i=t[a])&&i>o&&(o=i)}else e=w(e,n),m.each(t,function(t,n,i){((r=e(t,n,i))>s||r===-1/0&&o===-1/0)&&(o=t,s=r)});return o},m.min=function(t,e,n){var i,r,o=1/0,s=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t){t=P(t)?t:m.values(t);for(var a=0,c=t.length;a<c;a++)null!=(i=t[a])&&i<o&&(o=i)}else e=w(e,n),m.each(t,function(t,n,i){((r=e(t,n,i))<s||r===1/0&&o===1/0)&&(o=t,s=r)});return o},m.shuffle=function(t){return m.sample(t,1/0)},m.sample=function(t,e,n){if(null==e||n)return P(t)||(t=m.values(t)),t[m.random(t.length-1)];var i=P(t)?m.clone(t):m.values(t),r=O(i);e=Math.max(Math.min(e,r),0);for(var o=r-1,s=0;s<e;s++){var a=m.random(s,o),c=i[s];i[s]=i[a],i[a]=c}return i.slice(0,e)},m.sortBy=function(t,e,n){var i=0;return e=w(e,n),m.pluck(m.map(t,function(t,n,r){return{value:t,index:i++,criteria:e(t,n,r)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index}),"value")};var I=function(t,e){return function(n,i,r){var o=e?[[],[]]:{};return i=w(i,r),m.each(n,function(e,r){var s=i(e,r,n);t(o,e,s)}),o}};m.groupBy=I(function(t,e,n){k(t,n)?t[n].push(e):t[n]=[e]}),m.indexBy=I(function(t,e,n){t[n]=e}),m.countBy=I(function(t,e,n){k(t,n)?t[n]++:t[n]=1});var A=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;m.toArray=function(t){return t?m.isArray(t)?h.call(t):m.isString(t)?t.match(A):P(t)?m.map(t,m.identity):m.values(t):[]},m.size=function(t){return null==t?0:P(t)?t.length:m.keys(t).length},m.partition=I(function(t,e,n){t[n?0:1].push(e)},!0),m.first=m.head=m.take=function(t,e,n){return null==t||t.length<1?null==e?void 0:[]:null==e||n?t[0]:m.initial(t,t.length-e)},m.initial=function(t,e,n){return h.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},m.last=function(t,e,n){return null==t||t.length<1?null==e?void 0:[]:null==e||n?t[t.length-1]:m.rest(t,Math.max(0,t.length-e))},m.rest=m.tail=m.drop=function(t,e,n){return h.call(t,null==e||n?1:e)},m.compact=function(t){return m.filter(t,Boolean)};var j=function(t,e,n,i){i=i||[];for(var r=i.length,o=0,s=O(t);o<s;o++){var a=t[o];if(P(a)&&(m.isArray(a)||m.isArguments(a)))if(e)for(var c=0,l=a.length;c<l;)i[r++]=a[c++];else j(a,e,n,i),r=i.length;else n||(i[r++]=a)}return i};m.flatten=function(t,e){return j(t,e,!1)},m.without=E(function(t,e){return m.difference(t,e)}),m.uniq=m.unique=function(t,e,n,i){m.isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=w(n,i));for(var r=[],o=[],s=0,a=O(t);s<a;s++){var c=t[s],l=n?n(c,s,t):c;e&&!n?(s&&o===l||r.push(c),o=l):n?m.contains(o,l)||(o.push(l),r.push(c)):m.contains(r,c)||r.push(c)}return r},m.union=E(function(t){return m.uniq(j(t,!0,!0))}),m.intersection=function(t){for(var e=[],n=arguments.length,i=0,r=O(t);i<r;i++){var o=t[i];if(!m.contains(e,o)){var s;for(s=1;s<n&&m.contains(arguments[s],o);s++);s===n&&e.push(o)}}return e},m.difference=E(function(t,e){return e=j(e,!0,!0),m.filter(t,function(t){return!m.contains(e,t)})}),m.unzip=function(t){for(var e=t&&m.max(t,O).length||0,n=Array(e),i=0;i<e;i++)n[i]=m.pluck(t,i);return n},m.zip=E(m.unzip),m.object=function(t,e){for(var n={},i=0,r=O(t);i<r;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n};var N=function(t){return function(e,n,i){n=w(n,i);for(var r=O(e),o=t>0?0:r-1;o>=0&&o<r;o+=t)if(n(e[o],o,e))return o;return-1}};m.findIndex=N(1),m.findLastIndex=N(-1),m.sortedIndex=function(t,e,n,i){n=w(n,i,1);for(var r=n(e),o=0,s=O(t);o<s;){var a=Math.floor((o+s)/2);n(t[a])<r?o=a+1:s=a}return o};var D=function(t,e,n){return function(i,r,o){var s=0,a=O(i);if("number"==typeof o)t>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(n&&o&&a)return o=n(i,r),i[o]===r?o:-1;if(r!==r)return o=e(h.call(i,s,a),m.isNaN),o>=0?o+s:-1;for(o=t>0?s:a-1;o>=0&&o<a;o+=t)if(i[o]===r)return o;return-1}};m.indexOf=D(1,m.findIndex,m.sortedIndex),m.lastIndexOf=D(-1,m.findLastIndex),m.range=function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/n),0),r=Array(i),o=0;o<i;o++,t+=n)r[o]=t;return r},m.chunk=function(t,e){if(null==e||e<1)return[];for(var n=[],i=0,r=t.length;i<r;)n.push(h.call(t,i,i+=e));return n};var L=function(t,e,n,i,r){if(!(i instanceof e))return t.apply(n,r);var o=x(t.prototype),s=t.apply(o,r);return m.isObject(s)?s:o};m.bind=E(function(t,e,n){if(!m.isFunction(t))throw new TypeError("Bind must be called on a function");var i=E(function(r){return L(t,i,e,this,n.concat(r))});return i}),m.partial=E(function(t,e){var n=m.partial.placeholder,i=function(){for(var r=0,o=e.length,s=Array(o),a=0;a<o;a++)s[a]=e[a]===n?arguments[r++]:e[a];for(;r<arguments.length;)s.push(arguments[r++]);return L(t,i,this,this,s)};return i}),m.partial.placeholder=m,m.bindAll=E(function(t,e){e=j(e,!1,!1);var n=e.length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=e[n];t[i]=m.bind(t[i],t)}}),m.memoize=function(t,e){var n=function(i){var r=n.cache,o=""+(e?e.apply(this,arguments):i);return k(r,o)||(r[o]=t.apply(this,arguments)),r[o]};return n.cache={},n},m.delay=E(function(t,e,n){return setTimeout(function(){return t.apply(null,n)},e)}),m.defer=m.partial(m.delay,m,1),m.throttle=function(t,e,n){var i,r,o,s,a=0;n||(n={});var c=function(){a=!1===n.leading?0:m.now(),i=null,s=t.apply(r,o),i||(r=o=null)},l=function(){var l=m.now();a||!1!==n.leading||(a=l);var u=e-(l-a);return r=this,o=arguments,u<=0||u>e?(i&&(clearTimeout(i),i=null),a=l,s=t.apply(r,o),i||(r=o=null)):i||!1===n.trailing||(i=setTimeout(c,u)),s};return l.cancel=function(){clearTimeout(i),a=0,i=r=o=null},l},m.debounce=function(t,e,n){var i,r,o=function(e,n){i=null,n&&(r=t.apply(e,n))},s=E(function(s){if(i&&clearTimeout(i),n){var a=!i;i=setTimeout(o,e),a&&(r=t.apply(this,s))}else i=m.delay(o,e,this,s);return r});return s.cancel=function(){clearTimeout(i),i=null},s},m.wrap=function(t,e){return m.partial(e,t)},m.negate=function(t){return function(){return!t.apply(this,arguments)}},m.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},m.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},m.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},m.once=m.partial(m.before,2),m.restArguments=E;var z=!{toString:null}.propertyIsEnumerable("toString"),M=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],G=function(t,e){var n=M.length,i=t.constructor,r=m.isFunction(i)&&i.prototype||c,o="constructor";for(k(t,o)&&!m.contains(e,o)&&e.push(o);n--;)(o=M[n])in t&&t[o]!==r[o]&&!m.contains(e,o)&&e.push(o)};m.keys=function(t){if(!m.isObject(t))return[];if(g)return g(t);var e=[];for(var n in t)k(t,n)&&e.push(n);return z&&G(t,e),e},m.allKeys=function(t){if(!m.isObject(t))return[];var e=[];for(var n in t)e.push(n);return z&&G(t,e),e},m.values=function(t){for(var e=m.keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=t[e[r]];return i},m.mapObject=function(t,e,n){e=w(e,n);for(var i=m.keys(t),r=i.length,o={},s=0;s<r;s++){var a=i[s];o[a]=e(t[a],a,t)}return o},m.pairs=function(t){for(var e=m.keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=[e[r],t[e[r]]];return i},m.invert=function(t){for(var e={},n=m.keys(t),i=0,r=n.length;i<r;i++)e[t[n[i]]]=n[i];return e},m.functions=m.methods=function(t){var e=[];for(var n in t)m.isFunction(t[n])&&e.push(n);return e.sort()};var F=function(t,e){return function(n){var i=arguments.length;if(e&&(n=Object(n)),i<2||null==n)return n;for(var r=1;r<i;r++)for(var o=arguments[r],s=t(o),a=s.length,c=0;c<a;c++){var l=s[c];e&&void 0!==n[l]||(n[l]=o[l])}return n}};m.extend=F(m.allKeys),m.extendOwn=m.assign=F(m.keys),m.findKey=function(t,e,n){e=w(e,n);for(var i,r=m.keys(t),o=0,s=r.length;o<s;o++)if(i=r[o],e(t[i],i,t))return i};var B=function(t,e,n){return e in n};m.pick=E(function(t,e){var n={},i=e[0];if(null==t)return n;m.isFunction(i)?(e.length>1&&(i=b(i,e[1])),e=m.allKeys(t)):(i=B,e=j(e,!1,!1),t=Object(t));for(var r=0,o=e.length;r<o;r++){var s=e[r],a=t[s];i(a,s,t)&&(n[s]=a)}return n}),m.omit=E(function(t,e){var n,i=e[0];return m.isFunction(i)?(i=m.negate(i),e.length>1&&(n=e[1])):(e=m.map(j(e,!1,!1),String),i=function(t,n){return!m.contains(e,n)}),m.pick(t,i,n)}),m.defaults=F(m.allKeys,!0),m.create=function(t,e){var n=x(t);return e&&m.extendOwn(n,e),n},m.clone=function(t){return m.isObject(t)?m.isArray(t)?t.slice():m.extend({},t):t},m.tap=function(t,e){return e(t),t},m.isMatch=function(t,e){var n=m.keys(e),i=n.length;if(null==t)return!i;for(var r=Object(t),o=0;o<i;o++){var s=n[o];if(e[s]!==r[s]||!(s in r))return!1}return!0};var V,U;V=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!==t)return e!==e;var r=typeof t;return("function"===r||"object"===r||"object"==typeof e)&&U(t,e,n,i)},U=function(t,e,n,i){t instanceof m&&(t=t._wrapped),e instanceof m&&(e=e._wrapped);var r=d.call(t);if(r!==d.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return l.valueOf.call(t)===l.valueOf.call(e)}var o="[object Array]"===r;if(!o){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,a=e.constructor;if(s!==a&&!(m.isFunction(s)&&s instanceof s&&m.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],i=i||[];for(var c=n.length;c--;)if(n[c]===t)return i[c]===e;if(n.push(t),i.push(e),o){if((c=t.length)!==e.length)return!1;for(;c--;)if(!V(t[c],e[c],n,i))return!1}else{var u,h=m.keys(t);if(c=h.length,m.keys(e).length!==c)return!1;for(;c--;)if(u=h[c],!k(e,u)||!V(t[u],e[u],n,i))return!1}return n.pop(),i.pop(),!0},m.isEqual=function(t,e){return V(t,e)},m.isEmpty=function(t){return null==t||(P(t)&&(m.isArray(t)||m.isString(t)||m.isArguments(t))?0===t.length:0===m.keys(t).length)},m.isElement=function(t){return!(!t||1!==t.nodeType)},m.isArray=p||function(t){return"[object Array]"===d.call(t)},m.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},m.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(t){m["is"+t]=function(e){return d.call(e)==="[object "+t+"]"}}),m.isArguments(arguments)||(m.isArguments=function(t){return k(t,"callee")});var H=o.document&&o.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof H&&(m.isFunction=function(t){return"function"==typeof t||!1}),m.isFinite=function(t){return!m.isSymbol(t)&&isFinite(t)&&!isNaN(parseFloat(t))},m.isNaN=function(t){return m.isNumber(t)&&isNaN(t)},m.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===d.call(t)},m.isNull=function(t){return null===t},m.isUndefined=function(t){return void 0===t},m.has=function(t,e){if(!m.isArray(e))return k(t,e);for(var n=e.length,i=0;i<n;i++){var r=e[i];if(null==t||!f.call(t,r))return!1;t=t[r]}return!!n},m.noConflict=function(){return o._=s,this},m.identity=function(t){return t},m.constant=function(t){return function(){return t}},m.noop=function(){},m.property=function(t){return m.isArray(t)?function(e){return T(e,t)}:C(t)},m.propertyOf=function(t){return null==t?function(){}:function(e){return m.isArray(e)?T(t,e):t[e]}},m.matcher=m.matches=function(t){return t=m.extendOwn({},t),function(e){return m.isMatch(e,t)}},m.times=function(t,e,n){var i=Array(Math.max(0,t));e=b(e,n,1);for(var r=0;r<t;r++)i[r]=e(r);return i},m.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},m.now=Date.now||function(){return(new Date).getTime()};var q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},W=m.invert(q),Y=function(t){var e=function(e){return t[e]},n="(?:"+m.keys(t).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,e):t}};m.escape=Y(q),m.unescape=Y(W),m.result=function(t,e,n){m.isArray(e)||(e=[e]);var i=e.length;if(!i)return m.isFunction(n)?n.call(t):n;for(var r=0;r<i;r++){var o=null==t?void 0:t[e[r]];void 0===o&&(o=n,r=i),t=m.isFunction(o)?o.call(t):o}return t};var K=0;m.uniqueId=function(t){var e=++K+"";return t?t+e:e},m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var X=/(.)^/,$={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},J=/\\|'|\r|\n|\u2028|\u2029/g,Z=function(t){return"\\"+$[t]};m.template=function(t,e,n){!e&&n&&(e=n),e=m.defaults({},e,m.templateSettings);var i=RegExp([(e.escape||X).source,(e.interpolate||X).source,(e.evaluate||X).source].join("|")+"|$","g"),r=0,o="__p+='";t.replace(i,function(e,n,i,s,a){return o+=t.slice(r,a).replace(J,Z),r=a+e.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?o+="'+\n((__t=("+i+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),e}),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";var s;try{s=new Function(e.variable||"obj","_",o)}catch(t){throw t.source=o,t}var a=function(t){return s.call(this,t,m)};return a.source="function("+(e.variable||"obj")+"){\n"+o+"}",a},m.chain=function(t){var e=m(t);return e._chain=!0,e};var Q=function(t,e){return t._chain?m(e).chain():e};m.mixin=function(t){return m.each(m.functions(t),function(e){var n=m[e]=t[e];m.prototype[e]=function(){var t=[this._wrapped];return u.apply(t,arguments),Q(this,n.apply(m,t))}}),m},m.mixin(m),m.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=a[t];m.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],Q(this,n)}}),m.each(["concat","join","slice"],function(t){var e=a[t];m.prototype[t]=function(){return Q(this,e.apply(this._wrapped,arguments))}}),m.prototype.value=function(){return this._wrapped},m.prototype.valueOf=m.prototype.toJSON=m.prototype.value,m.prototype.toString=function(){return String(this._wrapped)},i=[],void 0!==(r=function(){return m}.apply(e,i))&&(n.exports=r)}()}).call(e,n(4),n(9)(t))},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.validHex=function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},t.prototype.rgbToHex=function(t){t=t.replace("rgba(","").replace("rgb(","").replace(")","");var e=t.split(",");return 4===e.length&&"0"===e[3].trim()?"FFFFFF":this.componentToHex(parseInt(e[0],10))+this.componentToHex(parseInt(e[1],10))+this.componentToHex(parseInt(e[2],10))},t.prototype.componentToHex=function(t){var e=t.toString(16);return 1===e.length?"0"+e:e},t.prototype.addEvent=function(t,e,n){t&&(t.addEventListener?(t.addEventListener(e,n,!1),"click"===e&&t.addEventListener("touchstart",n,!1)):t.attachEvent&&t.attachEvent("on"+e,n))},t.prototype.capitalizeFirstLetter=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},t.prototype.removeEvent=function(t,e,n){t.removeEventListener?(t.removeEventListener(e,n,!1),"click"===e&&t.removeEventListener("touchstart",n,!1)):t.detachEvent&&t.detachEvent("on"+e,n)},t.prototype.isTouch=function(){return"ontouchstart"in document.documentElement},t.prototype.clickEvent=function(){return this.isTouch()?"touchstart":"click"},t.prototype.openWindow=function(t,e,n){void 0===e&&(e="_blank"),void 0===n&&(n={});var i="";for(var r in n)n.hasOwnProperty(r)&&(i+=r+"="+n[r]+",");return i=i.substring(0,i.length-1),window.open(t,e,i)},t.prototype.createSlug=function(t){return t.split(" ").join("_")},t.prototype.getScrollbarWidth=function(){var t=document.createElement("div");t.style.visibility="hidden",t.style.width="100px",t.style.msOverflowStyle="scrollbar",document.body.appendChild(t);var e=t.offsetWidth;t.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",t.appendChild(n);var i=n.offsetWidth;return t.parentNode.removeChild(t),e-i},t.prototype.parseDateExcel=function(t){var e=new Date(1899,11,31),n=e.getTime(),i=n-864e5,r=86400*t*1e3,o=r+i;return isNaN(o)?null:o},t.prototype.getContrastYIQ=function(t){return t=t.replace("#",""),(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>=128?"light":"dark"},t.prototype.convertTime=function(t){"string"==typeof t&&(t=new Date(t));var e=t.getHours();e<10&&(e="0"+e);var n=t.getMinutes();n<10&&(n="0"+n);var i=t.getSeconds();return i<10&&(i="0"+i),e+":"+n+":"+i},t.prototype.isValidEmail=function(t){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)},t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.hasClass=function(t,e){return!(!t||void 0===t.className)&&!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},t.prototype.addClass=function(t,e){if(!t)return!1;t.classList.add(e)},t.prototype.removeClass=function(t,e){if(!t)return!1;t.classList.remove(e)},t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=function(){function t(){}return t.prototype.parseApiError=function(t,e){var n=e;if(t.data){var i=Object.keys(t.data);n=i.length?r.isArray(t.data[i[0]])?t.data[i[0]][0]:"string"==typeof t.data[i[0]]?t.data[i[0]]:e:e}else n=e;return n},t.prototype.clonePageContent=function(t){for(var e=[],n={},r=0;r<t.length;r++){e[r]=[];for(var o=0;o<t[r].length;o++){var s=i({},t[r][o]),a={};for(var c in s.style)s.style[c]!==n[c]&&(a[c]=s.style[c]);n=i({},s.style),s.style=a,e[r].push(s)}}return e},t.prototype.comparePageContent=function(t,e,n){if(void 0===n&&(n=!1),!t||!e)return!1;for(var i=[],r=0;r<e.length;r++)for(var o=0;o<e[r].length;o++){var s=!1;if(t[r]&&t[r][o]){if(e[r][o].value!==t[r][o].value&&(s=!0),!s&&!n)for(var a in e[r][o].style)if(e[r][o].style[a]!==t[r][o].style[a]){s=!0;break}}else s=!0;s&&(i[r]||(i[r]=[]),i[r][o]=e[r][o])}if(i.length||e.length<t.length||e[0].length<t[0].length){var c=t.length-e.length;return{content:e,content_diff:i,colDiff:t[0].length-e[0].length,rowDiff:c}}return!1},t}();e.default=o},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r,o,s,a,c,l,u=n(1),h=function(){function t(t,e,n,i,u,h){r=t,o=e,s=n,a=i,c=u,l=h}return t}();e.Providers=h;var d=function(t){function e(e,n,i){var r=t.call(this)||this;return r._pageId=e,r._folderId=n,r._uuid=i,r._stopped=!1,r._requestOngoing=!1,r._timeout=1e3,r._seqNo=0,r._error=!1,r.start(),r}return i(e,t),Object.defineProperty(e.prototype,"seqNo",{set:function(t){this._seqNo=t},enumerable:!0,configurable:!0}),e.prototype.start=function(){this._stopped=!1,this.startPolling()},e.prototype.stop=function(){this._stopped=!0,o.cancel(this._timer)},e.prototype.destroy=function(){this.stop(),this.removeEvent()},e.prototype.getData=function(){return this._data},e.prototype.startPolling=function(){var t=this;this.load(),this._timer=o(function(){t.startPolling()},this._timeout)},e.prototype.load=function(t){var e=this;void 0===t&&(t=!1);var n=r.defer();if(this._requestOngoing||this._stopped)return n.reject({}),n.promise;this._requestOngoing=!0;var i=function(t){200===t.httpCode||204===t.httpCode?(200===t.httpCode||e._error?(e._seqNo=t.data.seq_no,e._timeout=1e3*t.data.pull_interval,e._data=t.data,e.emit("content_update",e.tempGetContentOb(t.data)),e.emit("meta_update",e.tempGetSettingsOb(t.data))):e.emit("empty_update"),e._error=!1,n.resolve(t.data)):(e.onError(t.data),n.reject({}))};return this._uuid?s.getPageByUuid({uuid:this._uuid,seq_no:t?void 0:this._seqNo}).then(i,function(t){e.onError(t),n.reject(t)}).finally(function(){e._requestOngoing=!1}):s.getPage({domainId:this._folderId,pageId:this._pageId,seq_no:t?void 0:this._seqNo}).then(i,function(t){e.onError(t),n.reject(t)}).finally(function(){e._requestOngoing=!1}),n.promise},e.prototype.onError=function(t){this._error=!0,this.emit("error",t)},e.prototype.tempGetContentOb=function(t){return{id:t.id,domain_id:t.domain_id,seq_no:t.seq_no,content_modified_timestamp:t.content_modified_timestamp,content:t.content,content_modified_by:t.content_modified_by,push_interval:t.push_interval,pull_interval:t.pull_interval,is_public:t.is_public,description:t.description,encrypted_content:t.encrypted_content,encryption_key_used:t.encryption_key_used,encryption_type_used:t.encryption_type_used,special_page_type:t.special_page_type}},e.prototype.tempGetSettingsOb=function(t){return JSON.parse(JSON.stringify(t))},e}(u.default);e.ProviderREST=d;var f=function(t){function e(e,n){var i=t.call(this)||this;return i._pageId=e,i._folderId=n,i._stopped=!1,i._redirectCounter=0,i._redirectLimit=10,i._error=!1,i.onConnect=function(){},i.onReconnectingError=function(t){i.emit("error",{message:"Streaming is currently not available",code:502,type:"redirect"}),i.destroy(!0)},i.onReconnectError=function(){i.destroy(!1),i._wsUrl=l.ws_url+"/page/"+i._pageId,i.start()},i.onDisconnect=function(){},i.onRedirect=function(t){if(i._wsUrl=t,++i._redirectCounter>=i._redirectLimit)return i.emit("error",{message:"Streaming connection limit reached",code:500,type:"redirect"}),i.destroy(!0),void(i._redirectCounter=0);i.destroy(!1),i.start()},i.onPageContent=function(t){i._data=t,i._stopped||o(function(){i.emit("content_update",t)})},i.onPageSettings=function(t){o(function(){i.emit("meta_update",t)})},i.onPageError=function(t){o(function(){i._error=!0,401===t.code?a.emit(a.EVENT_401):i.emit("error",t)})},i.onOAuthError=function(t){},i.onAuthRefresh=function(){i._pageId;i.start()},i.supportsWebSockets=function(){return"WebSocket"in window||"MozWebSocket"in window},i._wsUrl=l.ws_url+"/page/"+i._pageId,i.start(),i}return i(e,t),Object.defineProperty(e,"SOCKET_EVENT_PAGE_ERROR",{get:function(){return"page_error"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SOCKET_EVENT_PAGE_CONTENT",{get:function(){return"page_content"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SOCKET_EVENT_PAGE_PUSH",{get:function(){return"page_push"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SOCKET_EVENT_PAGE_SETTINGS",{get:function(){return"page_settings"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SOCKET_EVENT_PAGE_DATA",{get:function(){return"page_data"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SOCKET_EVENT_PAGE_USER_JOINED",{get:function(){return"page_user_joined"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SOCKET_EVENT_PAGE_USER_LEFT",{get:function(){return"page_user_left"},enumerable:!0,configurable:!0}),e.prototype.start=function(){this._stopped=!1,this._socket&&this._socket.connected?this._data:(a.on(a.EVENT_LOGIN_REFRESHED,this.onAuthRefresh),this.init())},e.prototype.stop=function(){this._stopped=!0},e.prototype.destroy=function(t){void 0===t&&(t=!0),this._socket.removeAllListeners(),this._socket.disconnect(),this.stop(),a.off(a.EVENT_LOGIN_REFRESHED,this.onAuthRefresh),t&&this.removeEvent()},e.prototype.getData=function(){return this._data},e.prototype.init=function(){this._socket=this.connect(),this._socket.on("connect",this.onConnect),this._socket.on("reconnecting",this.onReconnectingError),this._socket.on("reconnect_error",this.onReconnectError),this._socket.on("redirect",this.onRedirect),this._socket.on(e.SOCKET_EVENT_PAGE_CONTENT,this.onPageContent),this._socket.on(e.SOCKET_EVENT_PAGE_SETTINGS,this.onPageSettings),this._socket.on(e.SOCKET_EVENT_PAGE_ERROR,this.onPageError),this._socket.on("oauth_error",this.onOAuthError),this._socket.on("disconnect",this.onDisconnect),this._stopped=!1},e.prototype.connect=function(){var t=s.tokens&&s.tokens.access_token?s.tokens.access_token:c?c.persistent.get("access_token"):"",e=["access_token="+t];return e=e.filter(function(t){return t.length>0}),io.connect(this._wsUrl,{query:e.join("&"),transports:this.supportsWebSockets()?["websocket"]:["polling"],forceNew:!0,reconnectionAttempts:5})},e}(u.default);e.ProviderSocket=f},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){function n(t){var e=i.call(t);return"[object Function]"===e||"function"==typeof t&&"[object RegExp]"!==e||"undefined"!=typeof window&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}t.exports=n;var i=Object.prototype.toString},function(t,e,n){var i;/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
!function(r,o,s,a){"use strict";function c(t,e,n){return setTimeout(f(t,n),e)}function l(t,e,n){return!!Array.isArray(t)&&(u(t,n[e],n),!0)}function u(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==a)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function h(t,e,n){var i="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=r.console&&(r.console.warn||r.console.log);return o&&o.call(r.console,i,n),t.apply(this,arguments)}}function d(t,e,n){var i,r=e.prototype;i=t.prototype=Object.create(r),i.constructor=t,i._super=r,n&&pt(i,n)}function f(t,e){return function(){return t.apply(e,arguments)}}function p(t,e){return typeof t==vt?t.apply(e?e[0]||a:a,e):t}function g(t,e){return t===a?e:t}function y(t,e,n){u(b(e),function(e){t.addEventListener(e,n,!1)})}function v(t,e,n){u(b(e),function(e){t.removeEventListener(e,n,!1)})}function m(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function _(t,e){return t.indexOf(e)>-1}function b(t){return t.trim().split(/\s+/g)}function w(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function E(t){return Array.prototype.slice.call(t,0)}function x(t,e,n){for(var i=[],r=[],o=0;o<t.length;){var s=e?t[o][e]:t[o];w(r,s)<0&&i.push(t[o]),r[o]=s,o++}return n&&(i=e?i.sort(function(t,n){return t[e]>n[e]}):i.sort()),i}function C(t,e){for(var n,i,r=e[0].toUpperCase()+e.slice(1),o=0;o<gt.length;){if(n=gt[o],(i=n?n+r:e)in t)return i;o++}return a}function k(){return xt++}function T(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||r}function S(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){p(t.options.enable,[t])&&n.handler(e)},this.init()}function O(t){var e=t.options.inputClass;return new(e||(Tt?V:St?q:kt?Y:B))(t,P)}function P(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,o=e&Pt&&i-r==0,s=e&(It|At)&&i-r==0;n.isFirst=!!o,n.isFinal=!!s,o&&(t.session={}),n.eventType=e,R(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function R(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=j(e)),r>1&&!n.firstMultiple?n.firstMultiple=j(e):1===r&&(n.firstMultiple=!1);var o=n.firstInput,s=n.firstMultiple,a=s?s.center:o.center,c=e.center=N(i);e.timeStamp=bt(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=M(a,c),e.distance=z(a,c),I(n,e),e.offsetDirection=L(e.deltaX,e.deltaY);var l=D(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=l.x,e.overallVelocityY=l.y,e.overallVelocity=_t(l.x)>_t(l.y)?l.x:l.y,e.scale=s?F(s.pointers,i):1,e.rotation=s?G(s.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,A(n,e);var u=t.element;m(e.srcEvent.target,u)&&(u=e.srcEvent.target),e.target=u}function I(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};e.eventType!==Pt&&o.eventType!==It||(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}function A(t,e){var n,i,r,o,s=t.lastInterval||e,c=e.timeStamp-s.timeStamp;if(e.eventType!=At&&(c>Ot||s.velocity===a)){var l=e.deltaX-s.deltaX,u=e.deltaY-s.deltaY,h=D(c,l,u);i=h.x,r=h.y,n=_t(h.x)>_t(h.y)?h.x:h.y,o=L(l,u),t.lastInterval=e}else n=s.velocity,i=s.velocityX,r=s.velocityY,o=s.direction;e.velocity=n,e.velocityX=i,e.velocityY=r,e.direction=o}function j(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:mt(t.pointers[n].clientX),clientY:mt(t.pointers[n].clientY)},n++;return{timeStamp:bt(),pointers:e,center:N(e),deltaX:t.deltaX,deltaY:t.deltaY}}function N(t){var e=t.length;if(1===e)return{x:mt(t[0].clientX),y:mt(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:mt(n/e),y:mt(i/e)}}function D(t,e,n){return{x:e/t||0,y:n/t||0}}function L(t,e){return t===e?jt:_t(t)>=_t(e)?t<0?Nt:Dt:e<0?Lt:zt}function z(t,e,n){n||(n=Bt);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function M(t,e,n){n||(n=Bt);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}function G(t,e){return M(e[1],e[0],Vt)+M(t[1],t[0],Vt)}function F(t,e){return z(e[0],e[1],Vt)/z(t[0],t[1],Vt)}function B(){this.evEl=Ht,this.evWin=qt,this.pressed=!1,S.apply(this,arguments)}function V(){this.evEl=Kt,this.evWin=Xt,S.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function U(){this.evTarget=Jt,this.evWin=Zt,this.started=!1,S.apply(this,arguments)}function H(t,e){var n=E(t.touches),i=E(t.changedTouches);return e&(It|At)&&(n=x(n.concat(i),"identifier",!0)),[n,i]}function q(){this.evTarget=te,this.targetIds={},S.apply(this,arguments)}function W(t,e){var n=E(t.touches),i=this.targetIds;if(e&(Pt|Rt)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,s=E(t.changedTouches),a=[],c=this.target;if(o=n.filter(function(t){return m(t.target,c)}),e===Pt)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<s.length;)i[s[r].identifier]&&a.push(s[r]),e&(It|At)&&delete i[s[r].identifier],r++;return a.length?[x(o.concat(a),"identifier",!0),a]:void 0}function Y(){S.apply(this,arguments);var t=f(this.handler,this);this.touch=new q(this.manager,t),this.mouse=new B(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function K(t,e){t&Pt?(this.primaryTouch=e.changedPointers[0].identifier,X.call(this,e)):t&(It|At)&&X.call(this,e)}function X(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches,r=function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)};setTimeout(r,ee)}}function $(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(e-r.x),s=Math.abs(n-r.y);if(o<=ne&&s<=ne)return!0}return!1}function J(t,e){this.manager=t,this.set(e)}function Z(t){if(_(t,ae))return ae;var e=_(t,ce),n=_(t,le);return e&&n?ae:e||n?e?ce:le:_(t,se)?se:oe}function Q(t){this.options=pt({},this.defaults,t||{}),this.id=k(),this.manager=null,this.options.enable=g(this.options.enable,!0),this.state=he,this.simultaneous={},this.requireFail=[]}function tt(t){return t&ye?"cancel":t&pe?"end":t&fe?"move":t&de?"start":""}function et(t){return t==zt?"down":t==Lt?"up":t==Nt?"left":t==Dt?"right":""}function nt(t,e){var n=e.manager;return n?n.get(t):t}function it(){Q.apply(this,arguments)}function rt(){it.apply(this,arguments),this.pX=null,this.pY=null}function ot(){it.apply(this,arguments)}function st(){Q.apply(this,arguments),this._timer=null,this._input=null}function at(){it.apply(this,arguments)}function ct(){it.apply(this,arguments)}function lt(){Q.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ut(t,e){return e=e||{},e.recognizers=g(e.recognizers,ut.defaults.preset),new ht(t,e)}function ht(t,e){this.options=pt({},ut.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=O(this),this.touchAction=new J(this,this.options.touchAction),dt(this,!0),u(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function dt(t,e){var n=t.element;if(n.style){var i;u(t.options.cssProps,function(r,o){i=C(n.style,o),e?(t.oldCssProps[i]=n.style[i],n.style[i]=r):n.style[i]=t.oldCssProps[i]||""}),e||(t.oldCssProps={})}}function ft(t,e){var n=o.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}var pt,gt=["","webkit","Moz","MS","ms","o"],yt=o.createElement("div"),vt="function",mt=Math.round,_t=Math.abs,bt=Date.now;pt="function"!=typeof Object.assign?function(t){if(t===a||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==a&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e}:Object.assign;var wt=h(function(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;)(!n||n&&t[i[r]]===a)&&(t[i[r]]=e[i[r]]),r++;return t},"extend","Use `assign`."),Et=h(function(t,e){return wt(t,e,!0)},"merge","Use `assign`."),xt=1,Ct=/mobile|tablet|ip(ad|hone|od)|android/i,kt="ontouchstart"in r,Tt=C(r,"PointerEvent")!==a,St=kt&&Ct.test(navigator.userAgent),Ot=25,Pt=1,Rt=2,It=4,At=8,jt=1,Nt=2,Dt=4,Lt=8,zt=16,Mt=Nt|Dt,Gt=Lt|zt,Ft=Mt|Gt,Bt=["x","y"],Vt=["clientX","clientY"];S.prototype={handler:function(){},init:function(){this.evEl&&y(this.element,this.evEl,this.domHandler),this.evTarget&&y(this.target,this.evTarget,this.domHandler),this.evWin&&y(T(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(T(this.element),this.evWin,this.domHandler)}};var Ut={mousedown:Pt,mousemove:Rt,mouseup:It},Ht="mousedown",qt="mousemove mouseup";d(B,S,{handler:function(t){var e=Ut[t.type];e&Pt&&0===t.button&&(this.pressed=!0),e&Rt&&1!==t.which&&(e=It),this.pressed&&(e&It&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var Wt={pointerdown:Pt,pointermove:Rt,pointerup:It,pointercancel:At,pointerout:At},Yt={2:"touch",3:"pen",4:"mouse",5:"kinect"},Kt="pointerdown",Xt="pointermove pointerup pointercancel";r.MSPointerEvent&&!r.PointerEvent&&(Kt="MSPointerDown",Xt="MSPointerMove MSPointerUp MSPointerCancel"),d(V,S,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=Wt[i],o=Yt[t.pointerType]||t.pointerType,s="touch"==o,a=w(e,t.pointerId,"pointerId");r&Pt&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):r&(It|At)&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(a,1))}});var $t={touchstart:Pt,touchmove:Rt,touchend:It,touchcancel:At},Jt="touchstart",Zt="touchstart touchmove touchend touchcancel";d(U,S,{handler:function(t){var e=$t[t.type];if(e===Pt&&(this.started=!0),this.started){var n=H.call(this,t,e);e&(It|At)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}}});var Qt={touchstart:Pt,touchmove:Rt,touchend:It,touchcancel:At},te="touchstart touchmove touchend touchcancel";d(q,S,{handler:function(t){var e=Qt[t.type],n=W.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}});var ee=2500,ne=25;d(Y,S,{handler:function(t,e,n){var i="touch"==n.pointerType,r="mouse"==n.pointerType;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)K.call(this,e,n);else if(r&&$.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ie=C(yt.style,"touchAction"),re=ie!==a,oe="auto",se="manipulation",ae="none",ce="pan-x",le="pan-y",ue=function(){if(!re)return!1;var t={},e=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){t[n]=!e||r.CSS.supports("touch-action",n)}),t}();J.prototype={set:function(t){"compute"==t&&(t=this.compute()),re&&this.manager.element.style&&ue[t]&&(this.manager.element.style[ie]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return u(this.manager.recognizers,function(e){p(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),Z(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var i=this.actions,r=_(i,ae)&&!ue[ae],o=_(i,le)&&!ue[le],s=_(i,ce)&&!ue[ce];if(r){var a=1===t.pointers.length,c=t.distance<2,l=t.deltaTime<250;if(a&&c&&l)return}return s&&o?void 0:r||o&&n&Mt||s&&n&Gt?this.preventSrc(e):void 0},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var he=1,de=2,fe=4,pe=8,ge=pe,ye=16;Q.prototype={defaults:{},set:function(t){return pt(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(l(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=nt(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return l(t,"dropRecognizeWith",this)?this:(t=nt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(l(t,"requireFailure",this))return this;var e=this.requireFail;return t=nt(t,this),-1===w(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(l(t,"dropRequireFailure",this))return this;t=nt(t,this);var e=w(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){n.manager.emit(e,t)}var n=this,i=this.state;i<pe&&e(n.options.event+tt(i)),e(n.options.event),t.additionalEvent&&e(t.additionalEvent),i>=pe&&e(n.options.event+tt(i))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|he)))return!1;t++}return!0},recognize:function(t){var e=pt({},t);if(!p(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(ge|ye|32)&&(this.state=he),this.state=this.process(e),this.state&(de|fe|pe|ye)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},d(it,Q,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=e&(de|fe),r=this.attrTest(t);return i&&(n&At||!r)?e|ye:i||r?n&It?e|pe:e&de?e|fe:de:32}}),d(rt,it,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ft},getTouchAction:function(){var t=this.options.direction,e=[];return t&Mt&&e.push(le),t&Gt&&e.push(ce),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,o=t.deltaX,s=t.deltaY;return r&e.direction||(e.direction&Mt?(r=0===o?jt:o<0?Nt:Dt,n=o!=this.pX,i=Math.abs(t.deltaX)):(r=0===s?jt:s<0?Lt:zt,n=s!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return it.prototype.attrTest.call(this,t)&&(this.state&de||!(this.state&de)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=et(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),d(ot,it,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ae]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&de)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),d(st,Q,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[oe]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!i||!n||t.eventType&(It|At)&&!r)this.reset();else if(t.eventType&Pt)this.reset(),this._timer=c(function(){this.state=ge,this.tryEmit()},e.time,this);else if(t.eventType&It)return ge;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===ge&&(t&&t.eventType&It?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=bt(),this.manager.emit(this.options.event,this._input)))}}),d(at,it,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ae]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&de)}}),d(ct,it,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Mt|Gt,pointers:1},getTouchAction:function(){return rt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&(Mt|Gt)?e=t.overallVelocity:n&Mt?e=t.overallVelocityX:n&Gt&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&_t(e)>this.options.velocity&&t.eventType&It},emit:function(t){var e=et(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),d(lt,Q,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[se]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&Pt&&0===this.count)return this.failTimeout();if(i&&r&&n){if(t.eventType!=It)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,s=!this.pCenter||z(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,s&&o?this.count+=1:this.count=1,this._input=t;if(0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=c(function(){this.state=ge,this.tryEmit()},e.interval,this),de):ge}return 32},failTimeout:function(){return this._timer=c(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ge&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ut.VERSION="2.0.7",ut.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[at,{enable:!1}],[ot,{enable:!1},["rotate"]],[ct,{direction:Mt}],[rt,{direction:Mt},["swipe"]],[lt],[lt,{event:"doubletap",taps:2},["tap"]],[st]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};ht.prototype={set:function(t){return pt(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var n,i=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&ge)&&(r=e.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],2===e.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&n.state&(de|fe|pe)&&(r=e.curRecognizer=n),o++}},get:function(t){if(t instanceof Q)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(l(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(l(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=w(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==a&&e!==a){var n=this.handlers;return u(b(t),function(t){n[t]=n[t]||[],n[t].push(e)}),this}},off:function(t,e){if(t!==a){var n=this.handlers;return u(b(t),function(t){e?n[t]&&n[t].splice(w(n[t],e),1):delete n[t]}),this}},emit:function(t,e){this.options.domEvents&&ft(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},destroy:function(){this.element&&dt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},pt(ut,{INPUT_START:Pt,INPUT_MOVE:Rt,INPUT_END:It,INPUT_CANCEL:At,STATE_POSSIBLE:he,STATE_BEGAN:de,STATE_CHANGED:fe,STATE_ENDED:pe,STATE_RECOGNIZED:ge,STATE_CANCELLED:ye,STATE_FAILED:32,DIRECTION_NONE:jt,DIRECTION_LEFT:Nt,DIRECTION_RIGHT:Dt,DIRECTION_UP:Lt,DIRECTION_DOWN:zt,DIRECTION_HORIZONTAL:Mt,DIRECTION_VERTICAL:Gt,DIRECTION_ALL:Ft,Manager:ht,Input:S,TouchAction:J,TouchInput:q,MouseInput:B,PointerEventInput:V,TouchMouseInput:Y,SingleTouchInput:U,Recognizer:Q,AttrRecognizer:it,Tap:lt,Pan:rt,Swipe:ct,Pinch:ot,Rotate:at,Press:st,on:y,off:v,each:u,merge:Et,extend:wt,assign:pt,inherit:d,bindFn:f,prefixed:C}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=ut,(i=function(){return ut}.call(e,n,e,t))!==a&&(t.exports=i)}(window,document)},function(t,e,n){var i;/*!
 * UAParser.js v0.7.18
 * Lightweight JavaScript-based User-Agent string parser
 * https://github.com/faisalman/ua-parser-js
 *
 * Copyright Â© 2012-2016 Faisal Salman <fyzlman@gmail.com>
 * Dual licensed under GPLv2 or MIT
 */
!function(r,o){"use strict";var s="model",a="name",c="type",l="vendor",u="version",h="mobile",d="tablet",f={extend:function(t,e){var n={};for(var i in t)e[i]&&e[i].length%2==0?n[i]=e[i].concat(t[i]):n[i]=t[i];return n},has:function(t,e){return"string"==typeof t&&-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()},major:function(t){/*!
 * UAParser.js v0.7.18
 * Lightweight JavaScript-based User-Agent string parser
 * https://github.com/faisalman/ua-parser-js
 *
 * Copyright Â© 2012-2016 Faisal Salman <fyzlman@gmail.com>
 * Dual licensed under GPLv2 or MIT
 */
return"string"==typeof t?t.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},p={rgx:function(t,e){for(var n,i,r,o,s,a,c=0;c<e.length&&!s;){var l=e[c],u=e[c+1];for(n=i=0;n<l.length&&!s;)if(s=l[n++].exec(t))for(r=0;r<u.length;r++)a=s[++i],o=u[r],"object"==typeof o&&o.length>0?2==o.length?"function"==typeof o[1]?this[o[0]]=o[1].call(this,a):this[o[0]]=o[1]:3==o.length?"function"!=typeof o[1]||o[1].exec&&o[1].test?this[o[0]]=a?a.replace(o[1],o[2]):void 0:this[o[0]]=a?o[1].call(this,a,o[2]):void 0:4==o.length&&(this[o[0]]=a?o[3].call(this,a.replace(o[1],o[2])):void 0):this[o]=a||void 0;c+=2}},str:function(t,e){for(var n in e)if("object"==typeof e[n]&&e[n].length>0){for(var i=0;i<e[n].length;i++)if(f.has(e[n][i],t))return"?"===n?void 0:n}else if(f.has(e[n],t))return"?"===n?void 0:n;return t}},g={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},y={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[a,u],[/(opios)[\/\s]+([\w\.]+)/i],[[a,"Opera Mini"],u],[/\s(opr)\/([\w\.]+)/i],[[a,"Opera"],u],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[a,u],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[a,"IE"],u],[/(edge|edgios|edgea)\/((\d+)?[\w\.]+)/i],[[a,"Edge"],u],[/(yabrowser)\/([\w\.]+)/i],[[a,"Yandex"],u],[/(puffin)\/([\w\.]+)/i],[[a,"Puffin"],u],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[a,"UCBrowser"],u],[/(comodo_dragon)\/([\w\.]+)/i],[[a,/_/g," "],u],[/(micromessenger)\/([\w\.]+)/i],[[a,"WeChat"],u],[/(qqbrowserlite)\/([\w\.]+)/i],[a,u],[/(QQ)\/([\d\.]+)/i],[a,u],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[a,u],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[a,u],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[a,u],[/(MetaSr)[\/\s]?([\w\.]+)/i],[a],[/(LBBROWSER)/i],[a],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[u,[a,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[u,[a,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[u,[a,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[a,/(.+)/,"$1 WebView"],u],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[a,/(.+(?:g|us))(.+)/,"$1 $2"],u],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[u,[a,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[a,u],[/(dolfin)\/([\w\.]+)/i],[[a,"Dolphin"],u],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[a,"Chrome"],u],[/(coast)\/([\w\.]+)/i],[[a,"Opera Coast"],u],[/fxios\/([\w\.-]+)/i],[u,[a,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[u,[a,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[u,a],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[a,"GSA"],u],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[a,[u,p.str,g.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[a,u],[/(navigator|netscape)\/([\w\.-]+)/i],[[a,"Netscape"],u],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[a,u]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",f.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",f.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",f.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[s,l,[c,d]],[/applecoremedia\/[\w\.]+ \((ipad)/],[s,[l,"Apple"],[c,d]],[/(apple\s{0,1}tv)/i],[[s,"Apple TV"],[l,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[l,s,[c,d]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[s,[l,"Amazon"],[c,d]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[s,p.str,g.device.amazon.model],[l,"Amazon"],[c,h]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[s,l,[c,h]],[/\((ip[honed|\s\w*]+);/i],[s,[l,"Apple"],[c,h]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[l,s,[c,h]],[/\(bb10;\s(\w+)/i],[s,[l,"BlackBerry"],[c,h]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[s,[l,"Asus"],[c,d]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[l,"Sony"],[s,"Xperia Tablet"],[c,d]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[s,[l,"Sony"],[c,h]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[l,s,[c,"console"]],[/android.+;\s(shield)\sbuild/i],[s,[l,"Nvidia"],[c,"console"]],[/(playstation\s[34portablevi]+)/i],[s,[l,"Sony"],[c,"console"]],[/(sprint\s(\w+))/i],[[l,p.str,g.device.sprint.vendor],[s,p.str,g.device.sprint.model],[c,h]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[l,s,[c,d]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[l,[s,/_/g," "],[c,h]],[/(nexus\s9)/i],[s,[l,"HTC"],[c,d]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[s,[l,"Huawei"],[c,h]],[/(microsoft);\s(lumia[\s\w]+)/i],[l,s,[c,h]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[s,[l,"Microsoft"],[c,"console"]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[l,"Microsoft"],[c,h]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[s,[l,"Motorola"],[c,h]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[s,[l,"Motorola"],[c,d]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[l,f.trim],[s,f.trim],[c,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[l,"Samsung"],[c,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[s,[l,"Sharp"],[c,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[l,"Samsung"],s,[c,d]],[/smart-tv.+(samsung)/i],[l,[c,"smarttv"],s],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[l,"Samsung"],s,[c,h]],[/sie-(\w*)/i],[s,[l,"Siemens"],[c,h]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[l,"Nokia"],s,[c,h]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[s,[l,"Acer"],[c,d]],[/android.+([vl]k\-?\d{3})\s+build/i],[s,[l,"LG"],[c,d]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[l,"LG"],s,[c,d]],[/(lg) netcast\.tv/i],[l,s,[c,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[s,[l,"LG"],[c,h]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[s,[l,"Lenovo"],[c,d]],[/linux;.+((jolla));/i],[l,s,[c,h]],[/((pebble))app\/[\d\.]+\s/i],[l,s,[c,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[l,s,[c,h]],[/crkey/i],[[s,"Chromecast"],[l,"Google"]],[/android.+;\s(glass)\s\d/i],[s,[l,"Google"],[c,"wearable"]],[/android.+;\s(pixel c)\s/i],[s,[l,"Google"],[c,d]],[/android.+;\s(pixel xl|pixel)\s/i],[s,[l,"Google"],[c,h]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[s,/_/g," "],[l,"Xiaomi"],[c,h]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[s,/_/g," "],[l,"Xiaomi"],[c,d]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[s,[l,"Meizu"],[c,d]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[s,[l,"OnePlus"],[c,h]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[s,[l,"RCA"],[c,d]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[s,[l,"Dell"],[c,d]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[s,[l,"Verizon"],[c,d]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[l,"Barnes & Noble"],s,[c,d]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[s,[l,"NuVision"],[c,d]],[/android.+;\s(k88)\sbuild/i],[s,[l,"ZTE"],[c,d]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[s,[l,"Swiss"],[c,h]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[s,[l,"Swiss"],[c,d]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[s,[l,"Zeki"],[c,d]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[l,"Dragon Touch"],s,[c,d]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[s,[l,"Insignia"],[c,d]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[s,[l,"NextBook"],[c,d]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[l,"Voice"],s,[c,h]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[l,"LvTel"],s,[c,h]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[s,[l,"Envizen"],[c,d]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[l,s,[c,d]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[s,[l,"MachSpeed"],[c,d]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[l,s,[c,d]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[s,[l,"Rotor"],[c,d]],[/android.+(KS(.+))\s+build/i],[s,[l,"Amazon"],[c,d]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[l,s,[c,d]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[c,f.lowerize],l,s],[/(android[\w\.\s\-]{0,9});.+build/i],[s,[l,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[u,[a,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[a,u],[/rv\:([\w\.]{1,9}).+(gecko)/i],[u,a]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[a,u],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[a,[u,p.str,g.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[a,"Windows"],[u,p.str,g.os.windows.version]],[/\((bb)(10);/i],[[a,"BlackBerry"],u],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[a,u],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[a,"Symbian"],u],[/\((series40);/i],[a],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[a,"Firefox OS"],u],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[a,u],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[a,"Chromium OS"],u],[/(sunos)\s?([\w\.\d]*)/i],[[a,"Solaris"],u],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[a,u],[/(haiku)\s(\w+)/i],[a,u],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[u,/_/g,"."],[a,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[a,"Mac OS"],[u,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]*)/i],[a,u]]},v=function(t,e){if("object"==typeof t&&(e=t,t=void 0),!(this instanceof v))return new v(t,e).getResult();var n=t||(r&&r.navigator&&r.navigator.userAgent?r.navigator.userAgent:""),i=e?f.extend(y,e):y;return this.getBrowser=function(){var t={name:void 0,version:void 0};return p.rgx.call(t,n,i.browser),t.major=f.major(t.version),t},this.getCPU=function(){var t={architecture:void 0};return p.rgx.call(t,n,i.cpu),t},this.getDevice=function(){var t={vendor:void 0,model:void 0,type:void 0};return p.rgx.call(t,n,i.device),t},this.getEngine=function(){var t={name:void 0,version:void 0};return p.rgx.call(t,n,i.engine),t},this.getOS=function(){var t={name:void 0,version:void 0};return p.rgx.call(t,n,i.os),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(t){return n=t,this},this};v.VERSION="0.7.18",v.BROWSER={NAME:a,MAJOR:"major",VERSION:u},v.CPU={ARCHITECTURE:"architecture"},v.DEVICE={MODEL:s,VENDOR:l,TYPE:c,CONSOLE:"console",MOBILE:h,SMARTTV:"smarttv",TABLET:d,WEARABLE:"wearable",EMBEDDED:"embedded"},v.ENGINE={NAME:a,VERSION:u},v.OS={NAME:a,VERSION:u},void 0!==e?(void 0!==t&&t.exports&&(e=t.exports=v),e.UAParser=v):n(34)?void 0!==(i=function(){return v}.call(e,n,e,t))&&(t.exports=i):r&&(r.UAParser=v);var m=r&&(r.jQuery||r.Zepto);if(void 0!==m){var _=new v;m.ua=_.getResult(),m.ua.get=function(){return _.getUA()},m.ua.set=function(t){_.setUA(t);var e=_.getResult();for(var n in e)m.ua[n]=e[n]}}}("object"==typeof window?window:this)},function(t,e,n){"use strict";function i(t,e){s.set(t,e)}function r(t,e){c.set(t,e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this.funcs=[]}return t.prototype.set=function(t,e){this.funcs.push(setTimeout(t,e))},t.prototype.cancel=function(t){var e=this.funcs.indexOf(t);e>-1&&(clearTimeout(this.funcs[e]),this.funcs[e]=void 0)},t}(),s=new o;e.timers=i,i.cancel=function(t){s.cancel(t)};var a=function(){function t(){this.funcs=[]}return t.prototype.set=function(t,e){this.funcs.push(setInterval(t,e))},t.prototype.cancel=function(t){var e=this.funcs.indexOf(t);e>-1&&(clearTimeout(this.funcs[e]),this.funcs[e]=void 0)},t}(),c=new a;e.intervals=r,r.cancel=function(t){c.cancel(t)}},function(t,e,n){"use strict";function i(t){return new R(t)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(15),o=n(18),s=n(2),a=n(21),c=n(27),l=n(28),u=n(29),h=n(30),d=n(6),f=n(7),p=n(5),g=n(31),y=n(32),v=n(35),m=n(36),_=n(37),b=n(38),w=n(13),E=n(13),x=n(39),C=n(0),k=n(0),T=n(0),S=n(0),O=n(0),P=n(0);Array.prototype.forEach2=function(t){for(var e=this.length,n=0;n<e;n++)t(this[n],n)};var R=function(){function t(t){this.settings=t,this.config=new c.Config,this.config.set(t),this.crypto=new b.Crypto,this.classy=new d.default,this.helpers=new p.default,this.utils=new f.default,this.storage=new l.StorageService(this.config),this.api=new u.Api(o.stringify,r,this.storage,this.config,this.utils,a),this.auth=new h.Auth(r,w.timers,this.api,this.storage,this.config,this.utils),this.page=new x.PageWrap(r,w.timers,E.intervals,this.api,this.auth,this.storage,this.crypto,this.config),this.tracking=new _.Tracking(E.intervals,this.storage),this.freezingRange=C.FreezingRange,this.permissionRange=k.PermissionRange,this.buttonRange=T.ButtonRange,this.styleRange=S.StyleRange,this.notificationRange=O.NotificationRange,this.accessRange=P.AccessRange,this.table=g.default,this.grid=y.Grid,this.pdf=new m.default(r,this.storage,this.config),this.clipboard=v.Clipboard}return t}(),I=i();I.IPushpull=R,I.create=function(t){return i(s({api_url:"http://ipushpull.dev/api/1.0",ws_url:"http://ipushpull.dev",storage_prefix:"ipp_local",api_key:"LC8aOmGqqydL3n8HyKaz8ue34M13WPux2zyuBAl1",api_secret:"kXXRR7jsoEm6JgjvBDYGca1YlGIDynuxpM9kiu9GTlqzLtmCvNWLm3pmzWUc6Uptp4DwvS1kLlC6mh5PHGGnKRNh0eBPG1IIUB5NtsEY1oSgqLcteNCdGBLnIwnOO7SY",transport:"polling"},t))},t.exports=I,t.exports.defaults=I},function(t,e,n){(function(e){/*!
 *
 * Copyright 2009-2017 Kris Kowal under the terms of the MIT
 * license found at https://github.com/kriskowal/q/blob/v1/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
!function(e){"use strict";if("function"==typeof bootstrap)bootstrap("promise",e);else{t.exports=e()}}(function(){"use strict";function t(t){return function(){return Y.apply(t,arguments)}}function n(t){return t===Object(t)}function i(t){return"[object StopIteration]"===nt(t)||t instanceof U}function r(t,e){if(B&&e.stack&&"object"==typeof t&&null!==t&&t.stack){for(var n=[],i=e;i;i=i.source)i.stack&&(!t.__minimumStackCounter__||t.__minimumStackCounter__>i.stackCounter)&&(Q(t,"__minimumStackCounter__",{value:i.stackCounter,configurable:!0}),n.unshift(i.stack));n.unshift(t.stack);var r=n.join("\n"+it+"\n"),s=o(r);Q(t,"stack",{value:s,configurable:!0})}}function o(t){for(var e=t.split("\n"),n=[],i=0;i<e.length;++i){var r=e[i];c(r)||s(r)||!r||n.push(r)}return n.join("\n")}function s(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function a(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(t);return i?[i[1],Number(i[2])]:void 0}function c(t){var e=a(t);if(!e)return!1;var n=e[0],i=e[1];return n===V&&i>=H&&i<=lt}function l(){if(B)try{throw new Error}catch(i){var t=i.stack.split("\n"),e=t[0].indexOf("@")>0?t[1]:t[2],n=a(e);if(!n)return;return V=n[0],n[1]}}function u(t){return t instanceof p?t:m(t)?S(t):T(t)}function h(){function t(t){e=t,u.longStackSupport&&B&&(o.source=t),X(n,function(e,n){u.nextTick(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,i=void 0}var e,n=[],i=[],r=Z(h.prototype),o=Z(p.prototype);if(o.promiseDispatch=function(t,r,o){var s=K(arguments);n?(n.push(s),"when"===r&&o[1]&&i.push(o[1])):u.nextTick(function(){e.promiseDispatch.apply(e,s)})},o.valueOf=function(){if(n)return o;var t=y(e);return v(t)&&(e=t),t},o.inspect=function(){return e?e.inspect():{state:"pending"}},u.longStackSupport&&B)try{throw new Error}catch(t){o.stack=t.stack.substring(t.stack.indexOf("\n")+1),o.stackCounter=rt++}return r.promise=o,r.resolve=function(n){e||t(u(n))},r.fulfill=function(n){e||t(T(n))},r.reject=function(n){e||t(k(n))},r.notify=function(t){e||X(i,function(e,n){u.nextTick(function(){n(t)})},void 0)},r}function d(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=h();try{t(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}return e.promise}function f(t){return d(function(e,n){for(var i=0,r=t.length;i<r;i++)u(t[i]).then(e,n)})}function p(t,e,n){void 0===e&&(e=function(t){return k(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var i=Z(p.prototype);if(i.promiseDispatch=function(n,r,o){var s;try{s=t[r]?t[r].apply(i,o):e.call(i,r,o)}catch(t){s=k(t)}n&&n(s)},i.inspect=n,n){var r=n();"rejected"===r.state&&(i.exception=r.reason),i.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?i:t.value}}return i}function g(t,e,n,i){return u(t).then(e,n,i)}function y(t){if(v(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function v(t){return t instanceof p}function m(t){return n(t)&&"function"==typeof t.then}function _(t){return v(t)&&"pending"===t.inspect().state}function b(t){return!v(t)||"fulfilled"===t.inspect().state}function w(t){return v(t)&&"rejected"===t.inspect().state}function E(){ot.length=0,st.length=0,ct||(ct=!0)}function x(t,e){ct&&("object"==typeof process&&"function"==typeof process.emit&&u.nextTick.runAfter(function(){-1!==$(st,t)&&(process.emit("unhandledRejection",e,t),at.push(t))}),st.push(t),e&&void 0!==e.stack?ot.push(e.stack):ot.push("(no stack) "+e))}function C(t){if(ct){var e=$(st,t);-1!==e&&("object"==typeof process&&"function"==typeof process.emit&&u.nextTick.runAfter(function(){var n=$(at,t);-1!==n&&(process.emit("rejectionHandled",ot[e],t),at.splice(n,1))}),st.splice(e,1),ot.splice(e,1))}}function k(t){var e=p({when:function(e){return e&&C(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return x(e,t),e}function T(t){return p({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},delete:function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return et(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function S(t){var e=h();return u.nextTick(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}}),e.promise}function O(t){return p({isDef:function(){}},function(e,n){return N(t,e,n)},function(){return u(t).inspect()})}function P(t,e,n){return u(t).spread(e,n)}function R(t){return function(){function e(t,e){var s;if("undefined"==typeof StopIteration){try{s=n[t](e)}catch(t){return k(t)}return s.done?u(s.value):g(s.value,r,o)}try{s=n[t](e)}catch(t){return i(t)?u(t.value):k(t)}return g(s,r,o)}var n=t.apply(this,arguments),r=e.bind(e,"next"),o=e.bind(e,"throw");return r()}}function I(t){u.done(u.async(t)())}function A(t){throw new U(t)}function j(t){return function(){return P([this,D(arguments)],function(e,n){return t.apply(e,n)})}}function N(t,e,n){return u(t).dispatch(e,n)}function D(t){return g(t,function(t){var e=0,n=h();return X(t,function(i,r,o){var s;v(r)&&"fulfilled"===(s=r.inspect()).state?t[o]=s.value:(++e,g(r,function(i){t[o]=i,0==--e&&n.resolve(t)},n.reject,function(t){n.notify({index:o,value:t})}))},void 0),0===e&&n.resolve(t),n.promise})}function L(t){if(0===t.length)return u.resolve();var e=u.defer(),n=0;return X(t,function(i,r,o){function s(t){e.resolve(t)}function a(t){if(0===--n){var i=t||new Error(""+t);i.message="Q can't get fulfillment value from any promise, all promises were rejected. Last error message: "+i.message,e.reject(i)}}function c(t){e.notify({index:o,value:t})}var l=t[o];n++,g(l,s,a,c)},void 0),e.promise}function z(t){return g(t,function(t){return t=J(t,u),g(D(J(t,function(t){return g(t,q,q)})),function(){return t})})}function M(t){return u(t).allSettled()}function G(t,e){return u(t).then(void 0,void 0,e)}function F(t,e){return u(t).nodeify(e)}var B=!1;try{throw new Error}catch(t){B=!!t.stack}var V,U,H=l(),q=function(){},W=function(){function t(){for(var t,e;i.next;)i=i.next,t=i.task,i.task=void 0,e=i.domain,e&&(i.domain=void 0,e.enter()),n(t,e);for(;c.length;)t=c.pop(),n(t);o=!1}function n(e,n){try{e()}catch(e){if(a)throw n&&n.exit(),setTimeout(t,0),n&&n.enter(),e;setTimeout(function(){throw e},0)}n&&n.exit()}var i={task:void 0,next:null},r=i,o=!1,s=void 0,a=!1,c=[];if(W=function(t){r=r.next={task:t,domain:a&&process.domain,next:null},o||(o=!0,s())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)a=!0,s=function(){process.nextTick(t)};else if("function"==typeof e)s="undefined"!=typeof window?e.bind(window,t):function(){e(t)};else if("undefined"!=typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=function(){s=u,l.port1.onmessage=t,t()};var u=function(){l.port2.postMessage(0)};s=function(){setTimeout(t,0),u()}}else s=function(){setTimeout(t,0)};return W.runAfter=function(t){c.push(t),o||(o=!0,s())},W}(),Y=Function.call,K=t(Array.prototype.slice),X=t(Array.prototype.reduce||function(t,e){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;n<i;n++)n in this&&(e=t(e,this[n],n));return e}),$=t(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),J=t(Array.prototype.map||function(t,e){var n=this,i=[];return X(n,function(r,o,s){i.push(t.call(e,o,s,n))},void 0),i}),Z=Object.create||function(t){function e(){}return e.prototype=t,new e},Q=Object.defineProperty||function(t,e,n){return t[e]=n.value,t},tt=t(Object.prototype.hasOwnProperty),et=Object.keys||function(t){var e=[];for(var n in t)tt(t,n)&&e.push(n);return e},nt=t(Object.prototype.toString);U="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var it="From previous event:";u.resolve=u,u.nextTick=W,u.longStackSupport=!1;var rt=1;"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(u.longStackSupport=!0),u.defer=h,h.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):arguments.length>2?t.resolve(K(arguments,1)):t.resolve(n)}},u.Promise=d,u.promise=d,d.race=f,d.all=D,d.reject=k,d.resolve=u,u.passByCopy=function(t){return t},p.prototype.passByCopy=function(){return this},u.join=function(t,e){return u(t).join(e)},p.prototype.join=function(t){return u([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Q can't join: not the same: "+t+" "+e)})},u.race=f,p.prototype.race=function(){return this.then(u.race)},u.makePromise=p,p.prototype.toString=function(){return"[object Promise]"},p.prototype.then=function(t,e,n){function i(e){try{return"function"==typeof t?t(e):e}catch(t){return k(t)}}function o(t){if("function"==typeof e){r(t,a);try{return e(t)}catch(t){return k(t)}}return k(t)}function s(t){return"function"==typeof n?n(t):t}var a=this,c=h(),l=!1;return u.nextTick(function(){a.promiseDispatch(function(t){l||(l=!0,c.resolve(i(t)))},"when",[function(t){l||(l=!0,c.resolve(o(t)))}])}),a.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=s(t)}catch(t){if(n=!0,!u.onerror)throw t;u.onerror(t)}n||c.notify(e)}]),c.promise},u.tap=function(t,e){return u(t).tap(e)},p.prototype.tap=function(t){return t=u(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},u.when=g,p.prototype.thenResolve=function(t){return this.then(function(){return t})},u.thenResolve=function(t,e){return u(t).thenResolve(e)},p.prototype.thenReject=function(t){return this.then(function(){throw t})},u.thenReject=function(t,e){return u(t).thenReject(e)},u.nearer=y,u.isPromise=v,u.isPromiseAlike=m,u.isPending=_,p.prototype.isPending=function(){return"pending"===this.inspect().state},u.isFulfilled=b,p.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},u.isRejected=w,p.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ot=[],st=[],at=[],ct=!0;u.resetUnhandledRejections=E,u.getUnhandledReasons=function(){return ot.slice()},u.stopUnhandledRejectionTracking=function(){E(),ct=!1},E(),u.reject=k,u.fulfill=T,u.master=O,u.spread=P,p.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},u.async=R,u.spawn=I,u.return=A,u.promised=j,u.dispatch=N,p.prototype.dispatch=function(t,e){var n=this,i=h();return u.nextTick(function(){n.promiseDispatch(i.resolve,t,e)}),i.promise},u.get=function(t,e){return u(t).dispatch("get",[e])},p.prototype.get=function(t){return this.dispatch("get",[t])},u.set=function(t,e,n){return u(t).dispatch("set",[e,n])},p.prototype.set=function(t,e){return this.dispatch("set",[t,e])},u.del=u.delete=function(t,e){return u(t).dispatch("delete",[e])},p.prototype.del=p.prototype.delete=function(t){return this.dispatch("delete",[t])},u.mapply=u.post=function(t,e,n){return u(t).dispatch("post",[e,n])},p.prototype.mapply=p.prototype.post=function(t,e){return this.dispatch("post",[t,e])},u.send=u.mcall=u.invoke=function(t,e){return u(t).dispatch("post",[e,K(arguments,2)])},p.prototype.send=p.prototype.mcall=p.prototype.invoke=function(t){return this.dispatch("post",[t,K(arguments,1)])},u.fapply=function(t,e){return u(t).dispatch("apply",[void 0,e])},p.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},u.try=u.fcall=function(t){return u(t).dispatch("apply",[void 0,K(arguments,1)])},p.prototype.fcall=function(){return this.dispatch("apply",[void 0,K(arguments)])},u.fbind=function(t){var e=u(t),n=K(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(K(arguments))])}},p.prototype.fbind=function(){var t=this,e=K(arguments);return function(){return t.dispatch("apply",[this,e.concat(K(arguments))])}},u.keys=function(t){return u(t).dispatch("keys",[])},p.prototype.keys=function(){return this.dispatch("keys",[])},u.all=D,p.prototype.all=function(){return D(this)},u.any=L,p.prototype.any=function(){return L(this)},u.allResolved=function(t,e,n){return function(){return"undefined"!=typeof console&&console.warn,t.apply(t,arguments)}}(z,"allResolved","allSettled"),p.prototype.allResolved=function(){return z(this)},u.allSettled=M,p.prototype.allSettled=function(){return this.then(function(t){return D(J(t,function(t){function e(){return t.inspect()}return t=u(t),t.then(e,e)}))})},u.fail=u.catch=function(t,e){return u(t).then(void 0,e)},p.prototype.fail=p.prototype.catch=function(t){return this.then(void 0,t)},u.progress=G,p.prototype.progress=function(t){return this.then(void 0,void 0,t)},u.fin=u.finally=function(t,e){return u(t).finally(e)},p.prototype.fin=p.prototype.finally=function(t){if(!t||"function"!=typeof t.apply)throw new Error("Q can't apply finally callback");return t=u(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},u.done=function(t,e,n,i){return u(t).done(e,n,i)},p.prototype.done=function(t,e,n){var i=function(t){u.nextTick(function(){if(r(t,o),!u.onerror)throw t;u.onerror(t)})},o=t||e||n?this.then(t,e,n):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),o.then(void 0,i)},u.timeout=function(t,e,n){return u(t).timeout(e,n)},p.prototype.timeout=function(t,e){var n=h(),i=setTimeout(function(){e&&"string"!=typeof e||(e=new Error(e||"Timed out after "+t+" ms"),e.code="ETIMEDOUT"),n.reject(e)},t);return this.then(function(t){clearTimeout(i),n.resolve(t)},function(t){clearTimeout(i),n.reject(t)},n.notify),n.promise},u.delay=function(t,e){return void 0===e&&(e=t,t=void 0),u(t).delay(e)},p.prototype.delay=function(t){return this.then(function(e){var n=h();return setTimeout(function(){n.resolve(e)},t),n.promise})},u.nfapply=function(t,e){return u(t).nfapply(e)},p.prototype.nfapply=function(t){var e=h(),n=K(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},u.nfcall=function(t){var e=K(arguments,1);return u(t).nfapply(e)},p.prototype.nfcall=function(){var t=K(arguments),e=h();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},u.nfbind=u.denodeify=function(t){if(void 0===t)throw new Error("Q can't wrap an undefined function");var e=K(arguments,1);return function(){var n=e.concat(K(arguments)),i=h();return n.push(i.makeNodeResolver()),u(t).fapply(n).fail(i.reject),i.promise}},p.prototype.nfbind=p.prototype.denodeify=function(){var t=K(arguments);return t.unshift(this),u.denodeify.apply(void 0,t)},u.nbind=function(t,e){var n=K(arguments,2);return function(){function i(){return t.apply(e,arguments)}var r=n.concat(K(arguments)),o=h();return r.push(o.makeNodeResolver()),u(i).fapply(r).fail(o.reject),o.promise}},p.prototype.nbind=function(){var t=K(arguments,0);return t.unshift(this),u.nbind.apply(void 0,t)},u.nmapply=u.npost=function(t,e,n){return u(t).npost(e,n)},p.prototype.nmapply=p.prototype.npost=function(t,e){var n=K(e||[]),i=h();return n.push(i.makeNodeResolver()),this.dispatch("post",[t,n]).fail(i.reject),i.promise},u.nsend=u.nmcall=u.ninvoke=function(t,e){var n=K(arguments,2),i=h();return n.push(i.makeNodeResolver()),u(t).dispatch("post",[e,n]).fail(i.reject),i.promise},p.prototype.nsend=p.prototype.nmcall=p.prototype.ninvoke=function(t){var e=K(arguments,1),n=h();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},u.nodeify=F,p.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){u.nextTick(function(){t(null,e)})},function(e){u.nextTick(function(){t(e)})})},u.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var lt=l();return u})}).call(e,n(16).setImmediate)},function(t,e,n){(function(t){function i(t,e){this._id=t,this._clearFn=e}var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;e.setTimeout=function(){return new i(o.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new i(o.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(17),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(e,n(4))},function(t,e,n){(function(t){!function(t,e){"use strict";function n(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[a]=i,s(a),a++}function i(t){delete c[t]}function r(t){var n=t.callback,i=t.args;switch(i.length){case 0:n();break;case 1:n(i[0]);break;case 2:n(i[0],i[1]);break;case 3:n(i[0],i[1],i[2]);break;default:n.apply(e,i)}}function o(t){if(l)setTimeout(o,0,t);else{var e=c[t];if(e){l=!0;try{r(e)}finally{i(t),l=!1}}}}if(!t.setImmediate){var s,a=1,c={},l=!1,u=t.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(t);h=h&&h.setTimeout?h:t,"[object process]"==={}.toString.call(t.process)?function(){s=function(t){process.nextTick(function(){o(t)})}}():function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&o(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),s=function(n){t.postMessage(e+n,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){o(t.data)},s=function(e){t.port2.postMessage(e)}}():u&&"onreadystatechange"in u.createElement("script")?function(){var t=u.documentElement;s=function(e){var n=u.createElement("script");n.onreadystatechange=function(){o(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():function(){s=function(t){setTimeout(o,0,t)}}(),h.setImmediate=n,h.clearImmediate=i}}("undefined"==typeof self?void 0===t?this:t:self)}).call(e,n(4))},function(t,e,n){"use strict";e.decode=e.parse=n(19),e.encode=e.stringify=n(20)},function(t,e,n){"use strict";function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,n,o){e=e||"&",n=n||"=";var s={};if("string"!=typeof t||0===t.length)return s;var a=/\+/g;t=t.split(e);var c=1e3;o&&"number"==typeof o.maxKeys&&(c=o.maxKeys);var l=t.length;c>0&&l>c&&(l=c);for(var u=0;u<l;++u){var h,d,f,p,g=t[u].replace(a,"%20"),y=g.indexOf(n);y>=0?(h=g.substr(0,y),d=g.substr(y+1)):(h=g,d=""),f=decodeURIComponent(h),p=decodeURIComponent(d),i(s,f)?r(s[f])?s[f].push(p):s[f]=[s[f],p]:s[f]=p}return s};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,e,n){"use strict";function i(t,e){if(t.map)return t.map(e);for(var n=[],i=0;i<t.length;i++)n.push(e(t[i],i));return n}var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,n,a){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?i(s(t),function(s){var a=encodeURIComponent(r(s))+n;return o(t[s])?i(t[s],function(t){return a+encodeURIComponent(r(t))}).join(e):a+encodeURIComponent(r(t[s]))}).join(e):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(t)):""};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},s=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},function(t,e,n){"use strict";function i(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function r(t,e,n){var i=t;return u(e)?(n=e,"string"==typeof t&&(i={uri:t})):i=d(e,{uri:t}),i.callback=n,i}function o(t,e,n){return e=r(t,e,n),s(e)}function s(t){function e(){4===u.readyState&&setTimeout(s,0)}function n(){var t=void 0;if(t=u.response?u.response:u.responseText||a(u),b)try{t=JSON.parse(t)}catch(t){}return t}function r(t){return clearTimeout(p),t instanceof Error||(t=new Error(""+(t||"Unknown XMLHttpRequest Error"))),t.statusCode=0,l(t,w)}function s(){if(!f){var e;clearTimeout(p),e=t.useXDR&&void 0===u.status?200:1223===u.status?204:u.status;var i=w,r=null;return 0!==e?(i={body:n(),statusCode:e,method:y,headers:{},url:g,rawRequest:u},u.getAllResponseHeaders&&(i.headers=h(u.getAllResponseHeaders()))):r=new Error("Internal XMLHttpRequest Error"),l(r,i,i.body)}}if(void 0===t.callback)throw new Error("callback argument missing");var c=!1,l=function(e,n,i){c||(c=!0,t.callback(e,n,i))},u=t.xhr||null;u||(u=t.cors||t.useXDR?new o.XDomainRequest:new o.XMLHttpRequest);var d,f,p,g=u.url=t.uri||t.url,y=u.method=t.method||"GET",v=t.body||t.data,m=u.headers=t.headers||{},_=!!t.sync,b=!1,w={body:void 0,headers:{},statusCode:0,method:y,url:g,rawRequest:u};if("json"in t&&!1!==t.json&&(b=!0,m.accept||m.Accept||(m.Accept="application/json"),"GET"!==y&&"HEAD"!==y&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),v=JSON.stringify(!0===t.json?v:t.json))),u.onreadystatechange=e,u.onload=s,u.onerror=r,u.onprogress=function(){},u.onabort=function(){f=!0},u.ontimeout=r,u.open(y,g,!_,t.username,t.password),_||(u.withCredentials=!!t.withCredentials),!_&&t.timeout>0&&(p=setTimeout(function(){if(!f){f=!0,u.abort("timeout");var t=new Error("XMLHttpRequest timeout");t.code="ETIMEDOUT",r(t)}},t.timeout)),u.setRequestHeader)for(d in m)m.hasOwnProperty(d)&&u.setRequestHeader(d,m[d]);else if(t.headers&&!i(t.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in t&&(u.responseType=t.responseType),"beforeSend"in t&&"function"==typeof t.beforeSend&&t.beforeSend(u),u.send(v||null),u}function a(t){try{if("document"===t.responseType)return t.responseXML;var e=t.responseXML&&"parsererror"===t.responseXML.documentElement.nodeName;if(""===t.responseType&&!e)return t.responseXML}catch(t){}return null}function c(){}var l=n(22),u=n(10),h=n(23),d=n(26);t.exports=o,t.exports.default=o,o.XMLHttpRequest=l.XMLHttpRequest||c,o.XDomainRequest="withCredentials"in new o.XMLHttpRequest?o.XMLHttpRequest:l.XDomainRequest,function(t,e){for(var n=0;n<t.length;n++)e(t[n])}(["get","put","post","patch","head","delete"],function(t){o["delete"===t?"del":t]=function(e,n,i){return n=r(e,n,i),n.method=t.toUpperCase(),s(n)}})},function(t,e,n){(function(e){var n;n="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},t.exports=n}).call(e,n(4))},function(t,e,n){var i=n(24),r=n(25),o=function(t){return"[object Array]"===Object.prototype.toString.call(t)};t.exports=function(t){if(!t)return{};var e={};return r(i(t).split("\n"),function(t){var n=t.indexOf(":"),r=i(t.slice(0,n)).toLowerCase(),s=i(t.slice(n+1));void 0===e[r]?e[r]=s:o(e[r])?e[r].push(s):e[r]=[e[r],s]}),e}},function(t,e){function n(t){return t.replace(/^\s*|\s*$/g,"")}e=t.exports=n,e.left=function(t){return t.replace(/^\s*/,"")},e.right=function(t){return t.replace(/\s*$/,"")}},function(t,e,n){function i(t,e,n){if(!a(e))throw new TypeError("iterator must be a function");arguments.length<3&&(n=this),"[object Array]"===c.call(t)?r(t,e,n):"string"==typeof t?o(t,e,n):s(t,e,n)}function r(t,e,n){for(var i=0,r=t.length;i<r;i++)l.call(t,i)&&e.call(n,t[i],i,t)}function o(t,e,n){for(var i=0,r=t.length;i<r;i++)e.call(n,t.charAt(i),i,t)}function s(t,e,n){for(var i in t)l.call(t,i)&&e.call(n,t[i],i,t)}var a=n(10);t.exports=i;var c=Object.prototype.toString,l=Object.prototype.hasOwnProperty},function(t,e){function n(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var r in n)i.call(n,r)&&(t[r]=n[r])}return t}t.exports=n;var i=Object.prototype.hasOwnProperty},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._config={api_url:"https://www.ipushpull.com/api/1.0",ws_url:"https://www.ipushpull.com",docs_url:"https://docs.ipushpull.com",api_key:"",api_secret:"",transport:"",storage_prefix:"ipp",cookie:{oauth_access_token:"access_token",ouath_refresh_token:"refresh_token",uuid:"uuid"}}}return t.prototype.set=function(t){if(t){for(var e in t)t.hasOwnProperty(e)&&(this._config[e]=t[e]);if(t.api_url&&!t.ws_url){var n=t.api_url.split("/");this._config.ws_url=n[0]+"//"+n[2]}}},Object.defineProperty(t.prototype,"api_url",{get:function(){return this._config.api_url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ws_url",{get:function(){return this._config.ws_url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"docs_url",{get:function(){return this._config.docs_url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"api_key",{get:function(){return this._config.api_key},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"api_secret",{get:function(){return this._config.api_secret},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transport",{get:function(){return this._config.transport},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storage_prefix",{get:function(){return this._config.storage_prefix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cookie",{get:function(){return this._config.cookie},enumerable:!0,configurable:!0}),t.prototype.$get=function(){return this._config},t}();e.Config=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.prefix="ipp"}return t.prototype.create=function(t,e){localStorage.setItem(this.makeKey(t),e)},t.prototype.save=function(t,e){return this.create(t,e)},t.prototype.get=function(t,e){void 0===e&&(e=null);var n=localStorage.getItem(this.makeKey(t));return n?this.isValidJSON(n)?JSON.parse(n):n:e},t.prototype.remove=function(t){localStorage.removeItem(this.makeKey(t))},t.prototype.makeKey=function(t){return this.prefix&&0!==t.indexOf(this.prefix)&&(t=this.prefix+"_"+t),this.suffix&&(t=t+"_"+this.suffix),t},t.prototype.isValidJSON=function(t){try{JSON.parse(t);return!0}catch(t){return!1}},t}(),r=function(){function t(){this.prefix="ipp";var t=document.domain;if(document.domain.indexOf("ipushpull")>0){var e=document.domain.split(".");e.splice(0,1),t=e.join(".")}this._domain=t}return t.prototype.create=function(t,e,n){var i="";if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),i="; expires="+r.toUTCString()}var o=this._domain.indexOf("localhost")>=0?"":"path=/;";document.cookie=this.makeKey(t)+"="+e+i+"; "+o+" domain="+this._domain+(this.isSecure()?";secure;":"")},t.prototype.save=function(t,e,n){this.create(t,e,n)},t.prototype.get=function(t,e){t=this.makeKey(t);for(var n=t+"=",i=document.cookie.split(";"),r=0;r<i.length;r++){for(var o=i[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(n)){var s=o.substring(n.length,o.length);return this.isValidJSON(s)?JSON.parse(s):s}}},t.prototype.remove=function(t){this.create(this.makeKey(t),"",-1)},t.prototype.isSecure=function(){return"https:"===window.location.protocol},t.prototype.makeKey=function(t){return this.prefix&&0!==t.indexOf(this.prefix)&&(t=this.prefix+"_"+t),this.suffix&&(t=t+"_"+this.suffix),t},t.prototype.isValidJSON=function(t){try{JSON.parse(t);return!0}catch(t){return!1}},t}(),o=function(){function t(t){var e=new i;e.suffix="GUEST";var n=new i,o="undefined"!=typeof navigator&&navigator.cookieEnabled?new r:new i;return t.storage_prefix&&(e.prefix=t.storage_prefix,n.prefix=t.storage_prefix,o.prefix=t.storage_prefix),{user:e,global:n,persistent:o}}return t.$inject=["ippConfig"],t}();e.StorageService=o},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=n(2),s=function(){function t(t,e){this._headers={},this._cache=!1,this._overrideLock=!1,this._json=!0,this._method=t,this._url=e,this._headers={"Content-Type":"application/json","x-requested-with":"XMLHttpRequest","x-ipp-device-uuid":"","x-ipp-client":"","x-ipp-client-version":""}}return t.get=function(e){return new t("GET",e)},t.post=function(e){return new t("POST",e)},t.put=function(e){return new t("PUT",e)},t.del=function(e){return new t("DELETE",e)},Object.defineProperty(t.prototype,"METHOD",{get:function(){return this._method},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"URL",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HEADERS",{get:function(){return this._headers},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DATA",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"PARAMS",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CACHE",{get:function(){return this._cache},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OVERRIDE_LOCK",{get:function(){return this._overrideLock},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"JSON",{get:function(){return this._json},enumerable:!0,configurable:!0}),t.prototype.method=function(t){return this._method=t,this},t.prototype.url=function(t){return this._url=t,this},t.prototype.headers=function(t,e){return void 0===e&&(e=!1),this._headers=e?t:o.recursive(!0,this._headers,t),this},t.prototype.data=function(t,e){return void 0===e&&(e=!1),this._data=e?Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"):t,this},t.prototype.params=function(t,e){return void 0===e&&(e=!1),this._params=e?t:o.recursive(!0,this._params,t),this},t.prototype.cache=function(t){return t&&"GET"===this._method&&(this._cache=t),this},t.prototype.overrideLock=function(t){return void 0===t&&(t=!0),this._overrideLock=t,this},t.prototype.json=function(t){return void 0===t&&(t=!0),this._json=t,this},t}(),a=function(t){function e(e,n,i,r,o,s){var a=t.call(this)||this;return a.qs=e,a.q=n,a.storage=i,a.config=r,a.utils=o,a.req=s,a.tokens={access_token:"",refresh_token:""},a._locked=!1,a.dummyRequest=function(t){var e=a.q.defer();return e.reject({data:{},status:666,statusText:"Api is locked",config:t}),e.promise},a.handleSuccess=function(t){return{success:!0,data:t.body,httpCode:parseInt(t.statusCode,10),httpText:t.statusMessage}},a.request=s,a._endPoint=""+a.config.api_url,a}return i(e,t),Object.defineProperty(e.prototype,"EVENT_401",{get:function(){return"401"},enumerable:!0,configurable:!0}),e.prototype.block=function(){this._locked=!0},e.prototype.unblock=function(){this._locked=!1},e.prototype.getSelfInfo=function(){return this.send(s.get(this._endPoint+"/users/self/").cache(!1).overrideLock())},e.prototype.refreshAccessTokens=function(t){return this.send(s.post(this._endPoint+"/oauth/token/").data({grant_type:"refresh_token",client_id:this.config.api_key,client_secret:this.config.api_secret,refresh_token:t},!0).headers({"Content-Type":"application/x-www-form-urlencoded"}).json(!1).overrideLock())},e.prototype.userLogin=function(t){return this.send(s.post(this._endPoint+"/oauth/token/").data({grant_type:"password",client_id:this.config.api_key,client_secret:this.config.api_secret,username:t.email,password:t.password},!0).headers({"Content-Type":"application/x-www-form-urlencoded"}).json(!1))},e.prototype.userLoginByCode=function(t){return this.send(s.post(this._endPoint+"/oauth/token/").params(o({grant_type:"authorization_code",client_id:this.config.api_key,client_secret:this.config.api_secret},t)).headers({"Content-Type":"application/x-www-form-urlencoded"}))},e.prototype.userLogout=function(t){return void 0===t&&(t={}),this.send(s.post(this._endPoint+"/oauth/logout/").params({all:t.all||""}))},e.prototype.getDomains=function(){return this.send(s.get(this._endPoint+"/domains/"))},e.prototype.getDomain=function(t){return this.send(s.get(this._endPoint+"/domains/"+t+"/"))},e.prototype.createFolder=function(t){return this.send(s.post(this._endPoint+"/domains/").data(t.data))},e.prototype.createDomain=function(t){return this.send(s.post(this._endPoint+"/domains/").data(t.data))},e.prototype.updateDomain=function(t){return this.send(s.put(this._endPoint+"/domains/"+t.domainId+"/").data(t.data))},e.prototype.disableDomain=function(t){return this.send(s.del(this._endPoint+"/domains/"+t.domainId+"/").data(t.data))},e.prototype.getDomainPages=function(t){return this.send(s.get(this._endPoint+"/domains/"+t+"/page_access/"))},e.prototype.getDomainsAndPages=function(t){return t||(t=""),this.send(s.get(this._endPoint+"/domain_page_access/").params({client:t}))},e.prototype.getPage=function(t){return this.send(s.get(this._endPoint+"/domains/id/"+t.domainId+"/page_content/id/"+t.pageId+"/").params({client_seq_no:t.seq_no}))},e.prototype.getPageByName=function(t){return this.send(s.get(this._endPoint+"/domains/name/"+t.domainId+"/page_content/name/"+t.pageId+"/").params({client_seq_no:t.seq_no}))},e.prototype.getPageByUuid=function(t){return this.send(s.get(this._endPoint+"/internal/page_content/"+t.uuid+"/").params({client_seq_no:t.seq_no}))},e.prototype.getPageVerions=function(t){return this.send(s.get(this._endPoint+"/page/id/"+t.pageId+"/versions/").params({before:t.before,after:t.after,max:t.max,page:t.page}))},e.prototype.getPageVerion=function(t){return this.send(s.get(this._endPoint+"/page/id/"+t.pageId+"/version/"+t.seqNo+"/"))},e.prototype.restorePageVerion=function(t){return this.send(s.put(this._endPoint+"/page/id/"+t.pageId+"/version/"+t.seqNo+"/restore/"))},e.prototype.getPageAccess=function(t){return this.send(s.get(this._endPoint+"/domains/id/"+t.domainId+"/page_access/id/"+t.pageId+"/"))},e.prototype.createPage=function(t){return this.send(s.post(this._endPoint+"/domains/"+t.domainId+"/pages/").data(t.data))},e.prototype.createPageNotification=function(t){return this.send(s.post(this._endPoint+"/page/"+t.pageId+"/notification/").data(t.data))},e.prototype.createPageNotificationByUuid=function(t){return this.send(s.post(this._endPoint+"/page/"+t.uuid+"/notification/").data(t.data))},e.prototype.createAnonymousPage=function(t){return this.send(s.post(this._endPoint+"/anonymous/page/").data(t.data))},e.prototype.savePageContent=function(t){return this.send(s.put(this._endPoint+"/domains/id/"+t.domainId+"/page_content/id/"+t.pageId+"/").data(t.data))},e.prototype.savePageContentDelta=function(t){return this.send(s.put(this._endPoint+"/domains/id/"+t.domainId+"/page_content_delta/id/"+t.pageId+"/").data(t.data))},e.prototype.savePageSettings=function(t){return this.send(s.put(this._endPoint+"/domains/"+t.domainId+"/pages/"+t.pageId+"/").data(t.data))},e.prototype.deletePage=function(t){return this.send(s.del(this._endPoint+"/domains/"+t.domainId+"/pages/"+t.pageId+"/"))},e.prototype.saveUserInfo=function(t){return this.send(s.put(this._endPoint+"/users/self/").data(t))},e.prototype.getUserMetaData=function(t){return this.send(s.get(this._endPoint+"/users/"+t.userId+"/meta/").data(t.data))},e.prototype.saveUserMetaData=function(t){return this.send(s.put(this._endPoint+"/users/"+t.userId+"/meta/").data(t.data))},e.prototype.deleteUserMetaData=function(t){return this.send(s.del(this._endPoint+"/users/"+t.userId+"/meta/").data(t.data))},e.prototype.changePassword=function(t){return this.send(s.put(this._endPoint+"/credentials/self/").data(t))},e.prototype.changeEmail=function(t){return this.send(s.put(this._endPoint+"/credentials/self/").data(t))},e.prototype.forgotPassword=function(t){return this.send(s.post(this._endPoint+"/password_reset/").data(t))},e.prototype.resetPassword=function(t){return this.send(s.post(this._endPoint+"/password_reset/confirm/").data(t))},e.prototype.inviteUsers=function(t){return this.send(s.post(this._endPoint+"/domains/"+t.domainId+"/invitations/").data(t.data))},e.prototype.acceptInvitation=function(t){return this.send(s.post(this._endPoint+"/users/invitation/confirm/").data(t))},e.prototype.refuseInvitation=function(t){return this.send(s.del(this._endPoint+"/users/invitation/confirm/").data(t))},e.prototype.domainInvitations=function(t){return this.send(s.get(this._endPoint+"/domains/"+t.domainId+"/invitations/").params({is_complete:"False"}))},e.prototype.userInvitations=function(){return this.send(s.get(this._endPoint+"/users/self/invitations/").params({is_complete:"False"}))},e.prototype.domainAccessLog=function(t){return this.send(s.get(this._endPoint+"/domain_access/"+t.domainId+"/events/").params({page_size:t.limit}))},e.prototype.domainUsers=function(t){return this.send(s.get(this._endPoint+"/domain_access/"+t.domainId+"/users/"))},e.prototype.signupUser=function(t){return this.send(s.post(this._endPoint+"/users/signup/").data(t))},e.prototype.activateUser=function(t){return this.send(s.post(this._endPoint+"/users/signup/confirm/").data(t))},e.prototype.setDomainDefault=function(t){return this.send(s.put(this._endPoint+"/domain_access/"+t.domainId+"/users/self/").data(t.data))},e.prototype.resendInvite=function(t){return this.send(s.put(this._endPoint+"/domains/"+t.domainId+"/invitations/"+t.inviteId+"/resend/"))},e.prototype.updateDomainAccess=function(t){return this.send(s.put(this._endPoint+"/domain_access/"+t.domainId+"/users/").data(t.data))},e.prototype.removeUsersFromDomain=function(t){return this.send(s.del(this._endPoint+"/domain_access/"+t.domainId+"/users/").data(t.data))},e.prototype.getInvitation=function(t){return this.send(s.get(this._endPoint+"/users/invitations/"+t.token+"/"))},e.prototype.cancelInvitations=function(t){return this.send(s.del(this._endPoint+"/domains/"+t.domainId+"/invitations/").data(t.data))},e.prototype.getDomainAccessGroups=function(t){return this.send(s.get(this._endPoint+"/domains/"+t.domainId+"/access_groups/"))},e.prototype.getDomainAccessGroup=function(t){return this.send(s.get(this._endPoint+"/domains/"+t.domainId+"/access_groups/"+t.groupId+"/"))},e.prototype.addDomainAccessGroup=function(t){return this.send(s.post(this._endPoint+"/domains/"+t.domainId+"/access_groups/").data(t.data))},e.prototype.putDomainAgroupMembers=function(t){return this.send(s.post(this._endPoint+"/domains/"+t.domainId+"/access_groups/"+t.agroupId+"/members/").data(t.data))},e.prototype.putDomainAgroupPages=function(t){return this.send(s.post(this._endPoint+"/domains/"+t.domainId+"/access_groups/"+t.agroupId+"/pages/").data(t.data))},e.prototype.updateDomainAgroup=function(t){return this.send(s.put(this._endPoint+"/domains/"+t.domainId+"/access_groups/"+t.agroupId+"/").data(t.data))},e.prototype.deleteDomainAGroup=function(t){return this.send(s.del(this._endPoint+"/domains/"+t.domainId+"/access_groups/"+t.agroupId+"/"))},e.prototype.getDomainPageAccess=function(t){return this.send(s.get(this._endPoint+"/domain_page_access/"+t.domainId+"/"))},e.prototype.getDomainCustomers=function(t){return this.send(s.get(this._endPoint+"/domains/"+t.domainId+"/customers/"))},e.prototype.getDomainUsage=function(t){return void 0===t&&(t={}),this.send(s.get(this._endPoint+"/domains/id/"+t.domainId+"/usage/").params({from_date:t.fromDate,to_date:t.toDate}))},e.prototype.saveDomainPageAccess=function(t){return this.send(s.put(this._endPoint+"/domain_page_access/"+t.domainId+"/basic/").data(t.data))},e.prototype.getTemplates=function(t){return this.send(s.get(this._endPoint+"/templates/"))},e.prototype.saveCustomer=function(t){return this.send(s.post(this._endPoint+"/domains/"+t.domainId+"/customers/").data(t.data))},e.prototype.updateCustomer=function(t){return this.send(s.put(this._endPoint+"/domains/"+t.domainId+"/customers/"+t.data.id+"/").data(t.data))},e.prototype.removeCustomer=function(t){return this.send(s.del(this._endPoint+"/domains/"+t.domainId+"/customers/"+t.customerId+"/"))},e.prototype.getDocEmailRules=function(t){return this.send(s.get(this._endPoint+"/domains/"+t.domainId+"/docsnames/"))},e.prototype.createDocEmailRule=function(t){return this.send(s.post(this._endPoint+"/domains/"+t.domainId+"/docsnames/").data(t.data))},e.prototype.updateDocEmailRule=function(t){return this.send(s.put(this._endPoint+"/domains/"+t.domainId+"/docsnames/"+t.docRuleId+"/").data(t.data))},e.prototype.deleteDocEmailRule=function(t){return this.send(s.del(this._endPoint+"/domains/"+t.domainId+"/docsnames/"+t.docRuleId+"/"))},e.prototype.send=function(t){var e=this,n=this.q.defer(),i="";this.storage&&(i=this.storage.persistent.get("access_token")),!i&&this.tokens&&this.tokens.access_token&&(i=this.tokens.access_token),i&&t.headers({Authorization:"Bearer "+i});var r=this._locked&&!t.OVERRIDE_LOCK?this.dummyRequest:this.request;t.cache(!1);r({url:t.URL+"?"+this.qs(t.PARAMS),cache:t.CACHE,method:t.METHOD,data:t.DATA,headers:t.HEADERS,resolveWithFullResponse:!0,json:t.JSON},function(i,r,o){if(i||r.statusCode>=300)if(i)n.reject(i);else{if(!t.JSON)try{o=JSON.parse(o)}catch(t){o={}}var s={method:r.method,data:o,code:r.statusCode,statusCode:r.statusCode,httpCode:r.statusCode,error:e.utils.parseApiError({data:o})||"Error",httpText:e.utils.parseApiError({data:o})||"Error",message:e.utils.parseApiError({data:o})||"Error"};401!==s.code||e._locked||"invalid_grant"===s.message||e.emit(e.EVENT_401),n.reject(s)}else{if(!t.JSON)try{r.body=JSON.parse(r.body)}catch(t){r.body={}}n.resolve(e.handleSuccess(r))}});return n.promise},e.prototype.getApplicationPageList=function(t){return void 0===t&&(t=""),this.send(s.get(this._endPoint+"/application_page_list/").params({client:t}))},e.prototype.getOrganization=function(t){return this.send(s.get(this._endPoint+"/organizations/"+t.organizationId+"/"))},e.prototype.getOrganizationUsers=function(t){return this.send(s.get(this._endPoint+"/organizations/"+t.organizationId+"/users/").params({query:t.query}))},e.prototype.getOrganizationUsage=function(t){return void 0===t&&(t={}),this.send(s.get(this._endPoint+"/organizations/self/usage/").params({from_date:t.fromDate,to_date:t.toDate}))},e.prototype.getOrganizationUser=function(t){return this.send(s.get(this._endPoint+"/organizations/"+t.organizationId+"/users/"+t.userId+"/"))},e.prototype.createOrganizationUser=function(t){return this.send(s.post(this._endPoint+"/organizations/"+t.organizationId+"/users/").data(t.data))},e.prototype.saveOrganizationUser=function(t){return this.send(s.put(this._endPoint+"/organizations/"+t.organizationId+"/users/"+t.userId+"/").data(t.data))},e.prototype.getOrganizationDomains=function(t){return this.send(s.get(this._endPoint+"/organizations/"+t.organizationId+"/domains/"))},e.prototype.getOrganizationDomain=function(t){return this.send(s.get(this._endPoint+"/organizations/"+t.organizationId+"/domains/"+t.domainId+"/"))},e.prototype.createOrganizationDomain=function(t){return this.send(s.post(this._endPoint+"/organizations/"+t.organizationId+"/domains/").data(t.data))},e.prototype.saveOrganizationDomain=function(t){return this.send(s.put(this._endPoint+"/organizations/"+t.organizationId+"/domains/"+t.domainId+"/").data(t.data))},e.$inject=["$httpParamSerializerJQLike","$q","ippStorageService","ippConfig","ippUtilsService","ippReqService"],e}(r.default);e.Api=a},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=n(3),s=function(t){function e(e,n,i,r,s,a){var c=t.call(this)||this;return c.$q=e,c.$timeout=n,c.ippApi=i,c.storage=r,c.config=s,c.utils=a,c.polling=!1,c._user={},c._authenticated=!1,c._authInProgress=!1,c._selfTimeout=15e3,c.on401=function(){if(!c.polling){c.storage.persistent.get("renew")||(c.ippApi.block(),c.ippApi.tokens.access_token="",c.storage.persistent.remove("access_token"),c.storage.persistent.create("renew",1),c.emit(c.EVENT_RE_LOGGING),c.authenticate(!0).then(function(){c.storage.user.suffix=c._user.id,c.emit(c.EVENT_LOGIN_REFRESHED)},function(){c.emit(c.EVENT_ERROR)}).finally(function(){c.storage.persistent.remove("renew"),c.ippApi.unblock()}))}},c._selfTimeout=1e3*o.random(15,45),i.on(i.EVENT_401,c.on401),c}return i(e,t),Object.defineProperty(e.prototype,"EVENT_LOGGED_IN",{get:function(){return"logged_in"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_RE_LOGGING",{get:function(){return"re_logging"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_LOGIN_REFRESHED",{get:function(){return"login_refreshed"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_LOGGED_OUT",{get:function(){return"logged_out"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_ERROR",{get:function(){return"error"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_401",{get:function(){return"401"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_USER_UPDATED",{get:function(){return"user_updated"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"user",{get:function(){return this._user},enumerable:!0,configurable:!0}),e.prototype.authenticate=function(t,e){var n=this;void 0===t&&(t=!1),void 0===e&&(e={}),e&&e.access_token&&(this.ippApi.tokens=e);var i=this.$q.defer();return this._authInProgress?(i.reject("Auth already in progress"),i.promise):(this._authInProgress=!0,this._authenticated&&!t?(this._authInProgress=!1,i.resolve(),i.promise):(this.processAuth(t).then(function(t){n._authenticated||(n._authenticated=!0,n.storage.user.suffix=n._user.id,n.emit(n.EVENT_LOGGED_IN),n.startPollingSelf()),i.resolve()},function(t){n.emit(n.EVENT_ERROR,t),n._authenticated&&n.logout(!1,!0),i.reject(t)}).finally(function(){n._authInProgress=!1}),i.promise))},e.prototype.login=function(t,e){var n=this,i=this.$q.defer();return this.ippApi.userLogin({grant_type:"password",client_id:this.config.api_key,client_secret:this.config.api_secret,email:t,password:e}).then(function(t){n.saveTokens(t.data),n.authenticate().then(i.resolve,i.reject)},function(t){if(400===t.httpCode||401===t.httpCode)switch(t.data){case"invalid_grant":t.message="The username and password you entered did not match our records. Please double-check and try again.";break;case"invalid_client":t.message="Your client doesn't have access to iPushPull system."}n.emit(n.EVENT_ERROR,t),i.reject(t)}),i.promise},e.prototype.logout=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),e||this.ippApi.userLogout({all:t}),this.ippApi.tokens={access_token:"",refresh_token:""},this.storage.persistent.remove("access_token"),this.storage.persistent.remove("refresh_token"),this._authenticated=!1,this.$timeout.cancel(this._selfTimer),this.storage.user.suffix="GUEST",this.emit(this.EVENT_LOGGED_OUT)},e.prototype.processAuth=function(t){var e=this;void 0===t&&(t=!1);var n=this.$q.defer(),i=this.storage.persistent.get("access_token")||this.ippApi.tokens.access_token,r=this.storage.persistent.get("refresh_token")||this.ippApi.tokens.refresh_token;return i&&!t?this.getUserInfo():(r?this.refreshTokens().then(function(t){e.saveTokens(t.data),e.getUserInfo().then(n.resolve,n.reject)},function(t){e.storage.persistent.remove("refresh_token"),n.reject(t)}):n.reject("No tokens available"),n.promise)},e.prototype.refreshTokens=function(){var t=this.storage.persistent.get("refresh_token")||this.ippApi.tokens.refresh_token;return this.ippApi.refreshAccessTokens(t)},e.prototype.saveTokens=function(t){this.storage.persistent.create("access_token",t.access_token,t.expires_in/86400),this.storage.persistent.create("refresh_token",t.refresh_token,365),this.ippApi.tokens=t},e.prototype.getUserInfo=function(){var t=this,e=this.$q.defer();return this.ippApi.getSelfInfo().then(function(n){o.isEqual(t._user,n.data)||(t._user=n.data,t.emit(t.EVENT_USER_UPDATED)),e.resolve()},e.reject),e.promise},e.prototype.startPollingSelf=function(){var t=this;this.$timeout.cancel(this._selfTimer),this._selfTimer=this.$timeout(function(){t.getUserInfo().then(function(){},function(){}).finally(function(){t.startPollingSelf()})},this._selfTimeout)},e.$inject=["$q","$timeout","ippApiService","ippStorageService","ippConfig","ippUtilsService"],e}(r.default);e.Auth=s},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=n(6),s=n(5),a=n(3),c=function(t){function e(e){var n=t.call(this)||this;return n.data=[],n.accessRanges=[],n.initialized=!1,n.dirty=!1,n.rendering=!1,n.tags=!1,n.isTouch=!1,n.container="content",n.validStyles=["color","background","background-color","border","border-left","border-right","border-top","border-bottom","width","height","max-height","text-align","vertical-align","font-family","font-size","font-weight","font-style","text-wrap","text-decoration","number-format","word-wrap","white-space"],n._editing=!1,n._tracking=!1,n.numOfCells=0,n.freeze=!1,n.freezeRange={valid:!1,index:{row:0,col:0}},n.accessRangesClassNames={no:"no-access",ro:"read-only"},n.clicked=0,n.clickCellLink=function(t){for(var e=t.target;e&&"a"!==e.nodeName.toLowerCase();)e=e.parentNode;if(!e||"a"!==e.nodeName.toLowerCase())return!1;if(n.classy.hasClass(e,"external")){if(!n.app.isEmbedded||!n.app.externalLink)return;window.parent.postMessage({event:"link",link:e.getAttribute("href")},"*"),t.preventDefault()}"standalone"in window.navigator&&window.navigator.standalone&&(t.preventDefault(),n.$location.path(e.getAttribute("href")))},n.onTableClick=function(t){var e=n.getClickedCell(t.target),i=new Date;return n.clicked&&i.getTime()-n.clicked<=300?(n.emit(n.ON_CELL_DOUBLE_CLICKED,e),void(n.clicked=i.getTime())):(n.clicked=i.getTime(),"span"===t.target.nodeName.toLowerCase()?void n.emit(n.ON_TAG_CLICKED,e):(n.editing&&n.showInput(e),void n.emit(n.ON_CELL_CLICKED,e)))},n.onWindowScroll=function(t){n.freeze&&n.updateFreezePanes(t.target)},e&&(n.container=e),n.classy=new o.default,n.helpers=new s.default,n.init(),n}return i(e,t),Object.defineProperty(e.prototype,"ON_CELL_CLICKED",{get:function(){return"cell_clicked"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ON_CELL_DOUBLE_CLICKED",{get:function(){return"cell_double_clicked"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ON_TAG_CLICKED",{get:function(){return"tag_clicked"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ON_CELL_CHANGED",{get:function(){return"cell_changed"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editing",{get:function(){return this._editing},set:function(t){this._editing=t,t?this.classy.addClass(this.containerEl,"edit-mode"):this.classy.removeClass(this.containerEl,"edit-mode")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tracking",{get:function(){return this._tracking},set:function(t){this._tracking=t,this.clearCellClassNames(["changed"])},enumerable:!0,configurable:!0}),e.prototype.init=function(){return!!this.initialized||(this.containerEl=document.getElementById(this.container),!!this.containerEl&&(this.viewEl=document.createElement("div"),this.viewEl.className="page-content-view",this.scrollEl=document.createElement("div"),this.scrollEl.className="page-content-scroll",this.zoomEl=document.createElement("div"),this.zoomEl.className="page-content-zoom",this.tableEl=document.createElement("table"),this.tableHeadEl=document.createElement("thead"),this.tableBodyEl=document.createElement("tbody"),this.tableEl.appendChild(this.tableHeadEl),this.tableEl.appendChild(this.tableBodyEl),this.tableFrozenRowsEl=document.createElement("table"),this.tableFrozenRowsEl.className="frozen-rows",this.tableFrozenColsEl=document.createElement("table"),this.tableFrozenColsEl.className="frozen-cols",this.zoomEl.appendChild(this.tableEl),this.zoomEl.appendChild(this.tableFrozenRowsEl),this.zoomEl.appendChild(this.tableFrozenColsEl),this.scrollEl.appendChild(this.zoomEl),this.viewEl.appendChild(this.scrollEl),this.containerEl.appendChild(this.viewEl),this.helpers.addEvent(this.tableEl,"click",this.onTableClick),this.helpers.addEvent(this.viewEl,"scroll",this.onWindowScroll),this.dirty=!1,this.initialized=!0,!0))},e.prototype.render=function(t){if(this.rendering)return!1;if(this.rendering=!0,this.setData(t),!(this.data&&this.data[0]&&this.data[0][0]&&this.init()))return this.rendering=!1,!1;for(var e=0;e<this.data.length;e++)this.renderRow(-1,this.data[e]);return this.softMerges(),this.rendering=!1,!0},e.prototype.update=function(t,e){if(this.rendering||!this.initialized)return!1;this.rendering=!0,this.setData(e);for(var n in t)if(t.hasOwnProperty(n)){if(this.tableBodyEl.rows[n])for(var i in t[n])t[n].hasOwnProperty(i)&&(this.tableBodyEl.rows[n].cells[i]?this.setCellValues(this.tableBodyEl.rows[n].cells[i],t[n][i]):this.setCellValues(this.tableBodyEl.rows[n].insertCell(i),t[n][i]));else this.renderRow(n,this.data[n]);this.softMerges(this.tableBodyEl.rows[n])}for(;this.tableBodyEl.rows.length>e.length;)this.tableBodyEl.deleteRow(this.tableBodyEl.rows.length-1);if(this.tableBodyEl.rows[0].cells.length>e[0].length)for(var n=0;n<this.tableBodyEl.rows.length;n++){for(;this.tableBodyEl.rows[n].cells.length>e[n].length;)this.tableBodyEl.rows[n].deleteCell(this.tableBodyEl.rows[n].cells.length-1);this.softMerges(this.tableBodyEl.rows[n])}return this.rendering=!1,!0},e.prototype.getData=function(){return this.data},e.prototype.setData=function(t){t||(t=[]),this.data=t,this.numOfCells=t.length&&t[0].length?t.length*t[0].length:0},e.prototype.setAccessRanges=function(t){this.setRanges(t)},e.prototype.setRanges=function(t,e){void 0===e&&(e=void 0),this.accessRanges=[],this.clearCellClassNames(Object.values(this.accessRangesClassNames)),this.freezeRange={valid:!1,index:{row:0,col:0}};for(var n=0;n<t.length;n++){var i=t[n];if("frozen_rows"===i.name)this.freezeRange.index.row=i.count;else if("frozen_cols"===i.name)this.freezeRange.index.col=i.count;else{var r=i.getPermission(e||0);-1===i.rowEnd&&(i.rowEnd=this.data.length-1),-1===i.colEnd&&(i.colEnd=this.data[0].length-1);for(var o=i.rowStart;o<=i.rowEnd;o++)for(var s=i.colStart;s<=i.colEnd;s++)this.accessRanges[o]||(this.accessRanges[o]=[]),this.accessRanges[o][s]||(this.accessRanges[o][s]=[]),this.accessRanges[o][s].push(r)}}this.freezeRange.index.row>0&&this.freezeRange.index.col>0&&(this.freezeRange.valid=!0),this.initialized&&this.freezePanes()},e.prototype.generateBlankData=function(){for(var t={value:"",style:{width:"60px",height:"22px"}},e=[],n=0;n<10;n++){e[n]=[];for(var i=0;i<6;i++){var r=a.clone(t);0===n&&0===i&&(r.value="Click Me"),e[n][i]=r}}return e},e.prototype.destroy=function(){if(this.initialized){for(this.helpers.removeEvent(this.containerEl,"scroll",this.onWindowScroll);this.containerEl.firstChild;)this.containerEl.removeChild(this.containerEl.firstChild);this.initialized=!1}},e.prototype.getEditCell=function(){return this.tableBodyEl?this.tableBodyEl.getElementsByClassName("edit")[0]:void 0},e.prototype.addRow=function(t,e){this.renderRow(t,e)},e.prototype.getRowIndex=function(){var t=this.getEditCell();return t?parseInt(t.parentNode.rowIndex+1,10):-1},e.prototype.addColumn=function(){},e.prototype.getColumnIndex=function(){var t=this.getEditCell();return t?parseInt(t.cellIndex+1):-1},e.prototype.setEditCell=function(t){var e=this.getClickedCell(t);if(e){if(this.accessRanges&&this.accessRanges[e.parentNode.rowIndex]&&this.accessRanges[e.parentNode.rowIndex][e.cellIndex])return!1;this.editing=!0,this.showInput(e)}},e.prototype.freezePanes=function(){this.tableFrozenColsEl.innerHTML="",this.tableFrozenColsEl.style.display="none",this.tableFrozenRowsEl.innerHTML="",this.tableFrozenRowsEl.style.display="none",this.freeze=!1;var t=this.viewEl.getBoundingClientRect(),e=this.tableEl.getBoundingClientRect();if(!(t.width>=e.width&&t.height>=e.height)&&this.freezeRange.valid){this.freeze=!0;for(var n=0;n<this.freezeRange.index.row;n++)this.tableBodyEl.rows.length<=n||this.tableFrozenRowsEl.appendChild(this.tableBodyEl.rows[n].cloneNode(!0));for(var n=0;n<this.tableBodyEl.rows.length;n++){this.tableFrozenColsEl.appendChild(this.tableBodyEl.rows[n].cloneNode(!1));for(var i=0;i<this.freezeRange.index.row;i++)this.tableBodyEl.rows[n].cells.length<=i||this.tableFrozenColsEl.rows[n].appendChild(this.tableBodyEl.rows[n].cells[i].cloneNode(!0))}this.updateFreezePanes(this.viewEl)}},e.prototype.renderRow=function(t,e){t&&void 0!==t||(t=-1),this.renderCells(this.tableEl.insertRow(t),e,void 0)},e.prototype.renderCells=function(t,e,n){void 0===n&&(n=0);for(var i=0;i<e.length;i++)this.setCellValues(t.insertCell(i+n),e[i])},e.prototype.setCellValues=function(t,e){var n=this;t.removeAttribute("style");for(var i in e.style)if(e.style.hasOwnProperty(i)){var r=i;if(r.indexOf("border-")>-1){var o=r.split("-");r=o[0]+"-"+o[1]}if(-1!==this.validStyles.indexOf(r)){var s=e.style[i];"font-family"===i&&(s+=", Arial, Helvetica, sans-serif"),"color"!==i&&"background-color"!==i&&-1===i.indexOf("-color")||~s.indexOf("#")||~s.indexOf("rgb")||(s="#"+s),t.style.setProperty(i,s)}}var a=this.getCellValue(e);t.setAttribute("data-value",a);var c=t.getElementsByTagName("div"),l=c.length?c[0]:document.createElement("div"),u=t.parentNode.rowIndex+t.cellIndex;if(0===u&&(u=.5),l.style["z-index"]=Math.round(this.numOfCells*this.numOfCells*1/u),l.innerHTML=a,l.dataset.format=e.style?e.style["number-format"]||"@":"@",this.tags){var h=t.getElementsByTagName("span"),d=h.length?h[0]:document.createElement("span");d.innerText="tag",t.appendChild(d),this.classy.addClass(l,"tag"),l.dataset.tag=e.tag||""}if(void 0!==e.link&&e.link){var f=this.processLink(e.link),p=t.getElementsByTagName("a"),g=p.length?p[0]:document.createElement("a");g.setAttribute("href",f.url),g.setAttribute("target",f.target);var y=e.link.external?"external":"internal";g.setAttribute("class",y),p.length||this.helpers.addEvent(g,"click",this.clickCellLink,!0),p.length||(t.appendChild(g),g.appendChild(l)),t.setAttribute("data-link-href",f.url),t.setAttribute("data-link-target",f.target),t.setAttribute("data-link-class",y)}else t.appendChild(l);this.accessRanges&&this.accessRanges[t.parentNode.rowIndex]&&this.accessRanges[t.parentNode.rowIndex][t.cellIndex]&&this.accessRanges[t.parentNode.rowIndex][t.cellIndex].forEach2(function(e){n.accessRangesClassNames[e]&&n.classy.addClass(t,n.accessRangesClassNames[e])}),this.tracking&&this.classy.addClass(t,"changed")},e.prototype.processLink=function(t){var e=t.external?t.address:"",n="_blank";if(!t.external){var i=t.address.split("/");e="domains/"+i[0]+"/pages/"+i[1],n=""}return(t.address.indexOf("tel:")>=0||t.address.indexOf("sms:")>=0||t.address.indexOf("mailto:")>=0)&&(n=""),{url:e,target:n}},e.prototype.getCellValue=function(t,e){void 0===e&&(e=!0);var n="&nbsp;";return t.formatted_value&&t.formatted_value.length?n=t.formatted_value:t.value&&t.value.length&&(n=t.value),e&&(n=n.replace(/</g,"&lt;").replace(/</g,"&rt;")),n=n.replace(/&amp;/g,"&"),0===n.indexOf("data:image")&&(n='<img src="'+t.value+'" />'),n},e.prototype.showInput=function(t){var e=this;if(t&&!this.classy.hasClass(t,"edit")){this.classy.addClass(t,"edit");var n=t.getElementsByTagName("div").length?t.getElementsByTagName("div")[0]:void 0,i=document.createElement("input"),r=t.dataset.newValue||t.dataset.value;i.value="&nbsp;"===r?"":r,t.appendChild(i),i.focus(),i.selectionStart=0,i.selectionEnd=999,this.helpers.addEvent(i,"keydown",function(n){13!==n.keyCode&&9!==n.keyCode&&27!==n.keyCode||n.preventDefault(),13===n.keyCode&&(n.shiftKey||(i.blur(),e.nextCellInput(t,"down"))),9===n.keyCode&&e.nextCellInput(t)}),this.helpers.addEvent(i,"blur",function(r){e.classy.removeClass(t,"edit"),t.dataset.value!==i.value&&(e.dirty=!0,t.setAttribute("data-new-value",i.value),n&&(n.innerHTML=i.value),e.emit(e.ON_CELL_CHANGED,{cell:t,value:i.value,rowIndex:t.parentNode.rowIndex,colIndex:t.cellIndex})),t.removeChild(i)}),this.helpers.addEvent(i,"paste",function(t){})}},e.prototype.nextCellInput=function(t,e){void 0===e&&(e="");var n=t.parentNode.rowIndex,i=t.cellIndex;return"down"===e&&this.data[n+1]&&this.data[n+1][i]?void this.showInput(this.tableBodyEl.rows[n+1].cells[i]):this.data[n][i+1]?void this.showInput(this.tableBodyEl.rows[n].cells[i+1]):this.data[n+1]?void this.showInput(this.tableBodyEl.rows[n+1].cells[0]):void this.showInput(this.tableBodyEl.rows[0].cells[0])},e.prototype.getClickedCell=function(t){for(;t&&"td"!==t.nodeName.toLowerCase();)t=t.parentNode;return!(!t||"td"!==t.nodeName.toLowerCase())&&(this.classy.hasClass(t,"edit"),t)},e.prototype.softMerges=function(t){var e=this,n=function(t,n,i){var r=e.tableBodyEl.rows[t].cells[n].getElementsByTagName("div")[0];i?(r.style.width=Math.round(i+1)+"px",e.classy.addClass(r,"soft-merge")):(r.style.width="auto",e.classy.removeClass(r,"soft-merge"))},i=function(t,e){var n=i.canvas||(i.canvas=document.createElement("canvas")),r=n.getContext("2d");return r.font=e,r.measureText(t).width},r=function(t,r){for(var o=0;o<r.length;o++)if(o+1!==r.length){var s=r[o+1].formatted_value||r[o+1].value;if(s.length)n(t,o,0);else{var a=r[o],c=a.formatted_value||a.value,l=e.tableBodyEl.rows[t].cells[o],u=l.clientWidth;if(!c.length||"break-word"===a.style["word-wrap"]||a.style.hasOwnProperty("text-align")&&"left"!==a.style["text-align"]&&"start"!==a.style["text-align"])n(t,o,0);else{var h=a.style["font-size"]||"12pt",d=a.style["font-family"]?a.style["font-family"].replace(/"/gi,""):"sans-serif",f=a.style["font-weight"]||"normal",p=i(c,f+" "+h+" "+d);if(p<u)n(t,o,0);else{for(var g=u,y=o+1;y<r.length;y++){var v=e.tableBodyEl.rows[t].cells[y].clientWidth;if(g+=v,y+1===r.length){p=g;break}var m=(r[y].formatted_value||r[o+1].value).trim();if(m.length){p>g&&(p=g);break}if(g>p)break}n(t,o,p)}}}}else n(t,o,0)};if(t)r(function(t){return t.rowIndex-e.tableHeadEl.rows.length}(t),t);else for(var o=0;o<this.data.length;o++)r(o,this.data[o])},e.prototype.updateFreezePanes=function(t){t.scrollTop>0?(this.tableFrozenRowsEl.style.top=t.scrollTop+"px",this.tableFrozenRowsEl.style.display="table"):(this.tableFrozenRowsEl.style.top="0px",this.tableFrozenRowsEl.style.display="none"),t.scrollLeft>0?(this.tableFrozenColsEl.style.left=t.scrollLeft+"px",this.tableFrozenColsEl.style.display="table"):(this.tableFrozenColsEl.style.left="0px",this.tableFrozenColsEl.style.display="none")},e.prototype.clearCellClassNames=function(t){var e=this;if(this.data&&this.data.length)for(var n=this,i=0;i<this.data.length;i++)!function(i){for(var r=0;r<n.data[i].length;r++)!function(r){n.tableBodyEl.rows[i]&&n.tableBodyEl.rows[i].cells[r]&&t.forEach2(function(t){e.classy.removeClass(e.tableBodyEl.rows[i].cells[r],t)})}(r)}(i)},e}(r.default);e.default=c},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Emitter_1=__webpack_require__(1),Classy_1=__webpack_require__(6),Helpers_1=__webpack_require__(5),Range_1=__webpack_require__(0),Range_2=__webpack_require__(0),Range_3=__webpack_require__(0),_=__webpack_require__(3),Hammer=__webpack_require__(11),ua=__webpack_require__(12),merge=__webpack_require__(2),Grid=function(_super){function Grid(t,e,n){void 0===e&&(e=!1),void 0===n&&(n={});var i=_super.call(this)||this;i.scale=1,i.ratio=1,i.ratioScale=1,i.pause=!1,i.canEdit=!1,i.scrollbars={width:8,inset:!1,scrolling:!1,x:{dimension:"width",label:"col",show:!1,anchor:"left",track:void 0,handle:void 0},y:{dimension:"height",label:"row",show:!1,anchor:"top",track:void 0,handle:void 0}},i.alwaysEditing=!1,i.disallowSelection=!1,i.historyIndicatorSize=16,i.trackingHighlightClassname="yellow",i.trackingHighlightMatchColor=!0,i.trackingHighlightLifetime=3e3,i.hasFocus=!1,i.fluid=!1,i.noAccessImages={light:"",dark:""},i.borders={widths:{none:0,thin:1,medium:2,thick:3},styles:{none:"solid",solid:"solid",double:"double"},names:{t:"top",r:"right",b:"bottom",l:"left"}},i.originalContent=[],i.content=[],i.history=[],i.trackingHighlights=[],i.offsets={x:{offset:0,index:0,max:0,maxOffset:0},y:{offset:0,index:0,max:0,maxOffset:0}},i.width=0,i.height=0,i.visible=[],i.gridLines=[],i.found=[],i.foundSelection={count:0,selected:0,cell:void 0},i.touch=!1,i.allowBrowserScroll=!1,i.links=[],i.styleRanges=[],i.buttonRanges=[],i.accessRanges=[],i.freezeRange={valid:!1,index:{row:0,col:0}},i.containerRect={x:0,y:0,height:0,width:0},i._tracking=!1,i._editing=!1,i._fit="scroll",i.userTrackingColors=["deeppink","aqua","tomato","orange","yellow","limegreen"],i.cellSelection={from:void 0,to:void 0,last:void 0,go:!1,on:!1,clicked:0,found:void 0},i.filters={},i.sorting={},i.dirty=!1,i.rightClick=!1,i.keyValue="",i.ctrlDown=!1,i.shiftDown=!1,i.cellStyles=["background-color","color","font-family","font-size","font-style","font-weight","height","number-format","text-align","text-wrap","width","vertical-align"],i.init=!1,i.hidden=!1,i.drawGrid=function(){var t=1*i.width/i.scale*i.ratio,e=1*i.height/i.scale*i.ratio;i.gc.bufferContext.save(),i.gc.bufferContext.clearRect(0,0,i.width*i.ratio,i.height*i.ratio),i.gc.bufferContext.scale(i.scale,i.scale),i.gridLines=[],i.visible=[];for(var n={cols:[],rows:[],common:[]},r=[],o=0;o<i.content.length;o++){var s=i.content[o],a=s[0].y-i.offsets.y.offset,c=s[0].y-i.offsets.y.offset+s[0].height,l=a>=0&&a<=e||c>=0&&c<=e;if(l||i.freezeRange.valid&&o<i.freezeRange.index.row){i.visible[o]=[],s[0].overlayWidth||i.softMerges(s,o);for(var u=0;u<s.length;u++){var h=s[u],d=h.overlayWidth,f=h.height,p=h.overlayStart<u?i.content[o][h.overlayStart].x:h.x,g=p-i.offsets.x.offset,y=h.x-i.offsets.x.offset,v=h.y-i.offsets.y.offset,m=h.x-i.offsets.x.offset+d,_=h.x-i.offsets.x.offset+h.width,b=h.y-i.offsets.y.offset+f,w=g>=0&&g<=t||m>=0&&m<=t||h.overlayEnd&&u<=h.overlayEnd||h.overlayStart&&u>=h.overlayStart;if(h.width&&(l&&w||i.freezeRange.valid&&u<i.freezeRange.index.col||i.freezeRange.valid&&o<i.freezeRange.index.row)){var E=i.originalContent[h.position.row][h.position.col];if(i.visible[o][u]={originalCell:E,coords:{x:g,y:v,a:m,b:b,width:d,height:f,_x:y,_a:_},cell:h},i.freezeRange.valid){var x="";if(o<i.freezeRange.index.row&&u<i.freezeRange.index.col?(g=y=h.x,m=_=h.x+d,v=h.y,b=h.y+f,x="common"):o<i.freezeRange.index.row?(v=h.y,b=h.y+f,x=w?"rows":""):u<i.freezeRange.index.col&&(g=y=h.x,m=_=h.x+d,x=l?"cols":""),x){n[x].push({originalCell:E,coords:{x:g,y:v,a:m,b:b,width:d,height:f,_x:y,_a:_},col:h});continue}}i.tracking&&i.history[h.position.row]&&i.history[h.position.row][h.position.col]>=0&&!h.button&&r.push({originalCell:E,coords:{x:g,y:v,a:m,b:b,width:d,height:f},col:h})}}}}for(var o=0;o<i.visible.length;o++)if(i.visible[o])for(var u=0;u<i.visible[o].length;u++)if(i.visible[o][u]){var h=i.visible[o][u];"no"===h.cell.allow&&i.imgPattern||i.drawOffsetRect(h.originalCell,h.coords,h.cell)}for(var o=0;o<i.visible.length;o++)if(i.visible[o])for(var u=0;u<i.visible[o].length;u++)if(i.visible[o][u]){var h=i.visible[o][u];i.drawGraphics(h.originalCell,h.coords,h.cell)}i.gridLines.forEach2(function(t){i.drawLine(t[0],t[1],t[2])}),r.forEach2(function(t){i.drawTrackingRect(t.coords,t.col)});for(var x in n)i.gridLines=[],n[x].forEach2(function(t){i.drawOffsetRect(t.originalCell,t.coords,t.col)}),n[x].forEach2(function(t){i.drawGraphics(t.originalCell,t.coords,t.col)}),i.gridLines.forEach2(function(t){i.drawLine(t[0],t[1],t[2])});for(var C in i.sorting){var h=i.sorting[C],k=i.content[0][h.col];i.drawSortingIndicator(k,h.direction)}i.gc.bufferContext.restore(),i.gc.canvasContext.clearRect(0,0,i.width*i.ratio,i.height*i.ratio),i.gc.canvasContext.drawImage(i.gc.buffer,0,0),i.updateSelector(!0)},i.onWheelEvent=function(t){i.animation&&cancelAnimationFrame(i.animation);var e=t.deltaX?Math.abs(t.deltaX)>=100?Math.round(Math.abs(t.deltaX)/100):1:0,n=t.deltaY?Math.abs(t.deltaY)>=100?Math.round(Math.abs(t.deltaY)/100):1:0,r=t.deltaX>0?1:-1,o=t.deltaY>0?1:-1;e*=r,n*=o,i.stage.y.size*i.scale/i.ratio<=i.height&&i.stage.x.size*i.scale/i.ratio>i.width&&(e=n);var s=JSON.parse(JSON.stringify(i.offsets));i.setOffsets({x:e,y:n}),i.updateScrollbars(),i.animation=i.drawGrid(),s.x.offset===i.offsets.x.offset&&s.y.offset===i.offsets.y.offset||t.preventDefault()},i.onResizeEvent=function(t){i.ratio=window.devicePixelRatio,i.setSize(),i.touch||i.setScale(i.ratio),i.setFit(i.fit,!0),i.touch&&i.editing?setTimeout(function(){i.cellSelection.from.position.col;i.keepSelectorWithinView()},300):i.touch&&i.cellSelection&&i.setOffsets({y:i.cellSelection.from.position.row})},i.onMouseMove=function(t){if(["x","y"].forEach2(function(e){if(i.scrollbars[e].drag&&i.scrollbars.scrolling){var n=i.stage[e].label,r=i[n],o=r*(r/(i.stage[e].size*i.scale)),s=r-o,a=t[e]-i.scrollbars[e].start+i.scrollbars[e].offset;a>s?a=s:a<0&&(a=0);var c=i.scrollbars[e].anchor;i.scrollbars[e].handle.style[c]=a+"px";var l=a/s,u=Math.round(i.offsets[e].max*l);i.offsets[e].index=u;var h=i.stage[e].increments[u];h>i.offsets[e].maxOffset&&(h=i.offsets[e].maxOffset),i.offsets[e].offset=h}}),i.scrollbars.scrolling)i.drawGrid();else{i.classy.removeClass(i.containerEl,"link"),i.classy.removeClass(i.containerEl,"denied");var e=i.getCell(t.clientX,t.clientY);if(e){if(i.cellHasHistory(e,{x:t.clientX,y:t.clientY}),!0!==e.allow?i.classy.addClass(i.containerEl,"denied"):(e.filter||e.link||e.button)&&i.classy.addClass(i.containerEl,"link"),e.history.valid&&!e.button?(i.containerEl.contains(i.historyIndicator)||i.containerEl.appendChild(i.historyIndicator),i.updateSelectorAttributes(e,e,i.historyIndicator,!0)):i.containerEl.contains(i.historyIndicator)&&i.containerEl.removeChild(i.historyIndicator),i.freeScroll){var n=Math.round((t.clientX-i.freeScroll.startX)/20),r=Math.round((t.clientY-i.freeScroll.startY)/20);i.freeScroll.x=n,i.freeScroll.y=r}i.cellSelection.go&&!i.alwaysEditing&&(i.cellSelection.to=e,i.updateSelector())}}},i.onMouseUp=function(t){i.scrollbars.scrolling=!1,i.cellSelection.go=!1,["x","y"].forEach2(function(t){i.scrollbars[t].drag=!1}),i.emit(i.ON_CELL_SELECTED,i.cellSelection),i.rightClick=i.isRightClick(t),2===t.which&&(i.freeScroll?(i.classy.removeClass(i.containerEl,"move"),cancelAnimationFrame(i.freeScroll.animation),i.freeScroll=void 0):(i.freeScroll={x:0,y:0,startX:t.clientX,startY:t.clientY,row:1*i.cellSelection.from.position.row,col:1*i.cellSelection.from.position.col,animation:requestAnimationFrame(i.startFreeScroll)},i.classy.addClass(i.containerEl,"move")))},i.onVisibilityEvent=function(t){i.hidden=document.hidden,i.hidden||i.renderGrid()},i.onMouseDown=function(t){i.rightClick=i.isRightClick(t);var e=!1;["x","y"].forEach2(function(n){i.scrollbars[n].handle===t.target&&(e=!0)});var n=i.isCanvas(t.target)||i.isInput(t.target)||t.target===i.selection||t.target===i.historyIndicator;if(!e&&n){if(t.touches){if(t.touches.length>1)return!0;t.clientX=t.touches[0].pageX,t.clientY=t.touches[0].pageY}var r=i.getCell(t.clientX,t.clientY);if(r){if(i.rightClick)return;var o=new Date;return i.cellSelection.clicked&&o.getTime()-i.cellSelection.clicked<=300&&!i.cellSelection.from.button?(i.emit(i.ON_CELL_DOUBLE_CLICKED,r),i.cellSelection.clicked=o.getTime(),i.editing=!0,void(i.touch&&(t.stopPropagation(),t.preventDefault()))):(i.editing=!1,i.setCellSelection(r,!0,o.getTime(),{x:t.clientX,y:t.clientY}),void(i.touch&&(t.stopPropagation(),t.preventDefault())))}i.editing=!1,i.hideSelector(!0)}else n||"INPUT"!==t.target.nodeName?e||n||(i.hasFocus=!1):i.hasFocus=!1},i.onMouseOver=function(t){i.hasFocus=!0},i.onKeydown=function(t){if(27===t.keyCode)return i.editing?i.editing=!1:i.hideSelector(!0),i.emit(i.ON_CELL_RESET,{cell:i.cellSelection.from}),void i.drawGrid();if(i.hasFocus){if(17===t.keyCode||91===t.keyCode)return void(i.ctrlDown=!0);var e=0,n=0;switch(t.keyCode){case 37:e=-1;break;case 38:n=-1;break;case 39:e=1;break;case 40:n=1}if((0!==e||0!==n)&&!i.editing){var r=i.cellSelection.from,o=void 0,s=void 0;return void(i.cellSelection.from&&!i.disallowSelection?(o=r.index.row+n,s=r.index.col+e,o>=i.content.length?o=0:o<0&&(o=i.content.length-1),s>=i.content[0].length?s=0:s<0&&(s=i.content[0].length-1),i.setCellSelection(i.content[o][s]),i.keepSelectorWithinView(),t.preventDefault()):(i.setOffsets({x:e,y:n}),i.updateScrollbars(),i.drawGrid(),(n>0&&i.offsets.y.index!==i.offsets.y.max||n<0&&i.offsets.y.index)&&t.preventDefault()))}if(13===t.keyCode)return i.alwaysEditing||i.touch||(i.editing=!1),i.nextCellInput(i.cellSelection.from||i.cellSelection.last||i.content[0][0],i.shiftDown?"up":"down"),void i.keepSelectorWithinView();if(9===t.keyCode&&i.cellSelection.from)return i.alwaysEditing||i.touch||(i.editing=!1),i.nextCellInput(i.cellSelection.from,i.shiftDown?"left":""),t.preventDefault(),void i.keepSelectorWithinView();if("Shift"===t.key&&(i.shiftDown=!0),i.editing||i.disallowSelection||!i.canEdit)i.editing&&(i.dirty=!0);else{if("F2"===t.key&&!t.shiftKey)return void i.setEditCell(i.cellSelection.from);i.cellSelection.from&&!i.ctrlDown&&(1===t.key.length&&/[a-zA-Z0-9-_ ]/.test(t.key)&&(i.keyValue=t.key,i.input.value=t.key),"Delete"===t.key&&(i.keyValue="",i.input.value=""),void 0!==i.keyValue&&(i.cellSelection.on=!0,i.setEditCell(i.cellSelection.from),i.ctrlDown=!1))}}},i.onKeyup=function(t){17!==t.keyCode&&91!==t.keyCode||(i.ctrlDown=!1),"Shift"===t.key&&(i.shiftDown=!1)},i.startFreeScroll=function(){i.freeScroll&&(i.setOffsets({x:i.freeScroll.x,y:i.freeScroll.y}),i.updateScrollbars(),i.drawGrid(),requestAnimationFrame(i.startFreeScroll))},i.destroy(),i.fluid=e,i.init=!1,n.inset_scrollbars&&(i.scrollbars.inset=n.inset_scrollbars);var r=new ua,o=r.getResult();i.touch=o.device&&("tablet"===o.device.type||"mobile"===o.device.type),i.classy=new Classy_1.default,i.helpers=new Helpers_1.default,i.containerEl="string"==typeof t?document.getElementById(t):t,i.containerEl.style.overflow="hidden";var s=document.createElement("canvas"),a=document.createElement("canvas");return i.gc={buffer:s,bufferContext:s.getContext("2d"),canvas:a,canvasContext:a.getContext("2d")},i.containerEl.appendChild(i.gc.canvas),i.ratio=window.devicePixelRatio,i.scale=i.ratio,i.ratioScale=i.scale,i.resetStage(),i.createSelector(),document.addEventListener("visibilitychange",i.onVisibilityEvent,!1),window.addEventListener("resize",i.onResizeEvent),window.addEventListener("keydown",i.onKeydown,!1),window.addEventListener("keyup",i.onKeyup,!1),window.oncontextmenu=function(){i.rightClick&&i.cellSelection.from},i.touch?(i.setupTouch(),i.containerEl.addEventListener("touchstart",i.onMouseDown,!1),i.containerEl.addEventListener("touchend",i.onMouseUp,!1)):(e||i.createScrollbars(),i.containerEl.addEventListener("wheel",i.onWheelEvent,!1),i.containerEl.addEventListener("mouseover",i.onMouseOver,!1),window.addEventListener("mousemove",i.onMouseMove,!1),window.addEventListener("mouseup",i.onMouseUp,!1),window.addEventListener("mousedown",i.onMouseDown,!1)),i}return __extends(Grid,_super),Object.defineProperty(Grid.prototype,"ON_CELL_CLICKED",{get:function(){return"cell_clicked"},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"ON_CELL_CLICKED_RIGHT",{get:function(){return"cell_clicked_right"},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"ON_CELL_HISTORY_CLICKED",{get:function(){return"cell_history_clicked"},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"ON_CELL_LINK_CLICKED",{get:function(){return"cell_link_clicked"},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"ON_CELL_DOUBLE_CLICKED",{get:function(){return"cell_double_clicked"},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"ON_TAG_CLICKED",{get:function(){return"tag_clicked"},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"ON_CELL_VALUE",{get:function(){return"cell_value"},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"ON_CELL_SELECTED",{get:function(){return"cell_selected"},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"ON_CELL_RESET",{get:function(){return"cell_reset"},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"ON_EDITING",{get:function(){return"editing"},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"fit",{get:function(){return this._fit},set:function(t){-1!==["scroll","width","height","contain"].indexOf(t)&&(this._fit=t)},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"editing",{get:function(){return this._editing},set:function(t){if(this._editing=t,this.emit(this.ON_EDITING,{cell:this.cellSelection.from,editing:this._editing,dirty:this.dirty}),t){if(!this.cellSelection.from||!0!==this.cellSelection.from.allow||!this.canEdit)return void(this._editing=!1);this.showInput()}else this.keyValue=void 0,this.selection.contains(this.input)&&(this.input.value="",this.input.blur(),this.input.style.visibility="hidden"),!this.touch&&this.selection.contains(this.input)&&(this.selection.removeChild(this.input),this.selection.contentEditable=!0),this.dirty&&(this.dirty=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(Grid.prototype,"tracking",{get:function(){return this._tracking},set:function(t){this._tracking=t,t||(this.history=[]),this.drawGrid()},enumerable:!0,configurable:!0}),Grid.prototype.destroy=function(){if(this.containerEl)try{window.removeEventListener("resize",this.onResizeEvent),window.removeEventListener("keydown",this.onKeydown,!1),window.removeEventListener("keyup",this.onKeyup,!1),document.removeEventListener("visibilitychange",this.onVisibilityEvent,!1),this.touch?(this.containerEl.removeEventListener("touchstart",this.onMouseDown,!1),this.containerEl.removeEventListener("touchend",this.onMouseUp,!1)):(this.containerEl.removeEventListener("wheel",this.onWheelEvent),this.containerEl.removeEventListener("mouseover",this.onMouseOver,!1),window.removeEventListener("mousemove",this.onMouseMove,!1),window.removeEventListener("mouseup",this.onMouseUp,!1),window.removeEventListener("mousedown",this.onMouseDown,!1)),this.containerEl.innerHTML="",this.hammer&&this.hammer.destroy(),this.removeEvent()}catch(t){}},Grid.prototype.cellHistory=function(t){var e=this;if(this.history=[],t.length){var n=[],i=0;t.forEach2(function(t){if(1!==++i){-1===n.indexOf(t.modified_by.id)&&n.push(t.modified_by.id);var r=n.indexOf(t.modified_by.id);t.content_diff.forEach2(function(t,n){t&&(e.history[n]||(e.history[n]=[]),t.forEach2(function(t,i){t&&(e.history[n][i]=r)}))})}})}},Grid.prototype.setTrackingHighlights=function(t){if(this.clearTrackingHighlights(),t&&t.content_diff&&t.content_diff.length)for(var e=0;e<t.content_diff.length;e++){var n=t.content_diff[e];if(n)for(var i=0;i<n.length;i++)n[i]&&(this.trackingHighlights[e]||(this.trackingHighlights[e]=[]),this.trackingHighlights[e][i]=!0)}},Grid.prototype.clearTrackingHighlights=function(){for(var t=this.containerEl.getElementsByClassName("tracking");t[0];)t[0].parentNode.removeChild(t[0]);this.trackingHighlights=[]},Grid.prototype.setContent=function(t){this.originalContent=t,this.updateContent()},Grid.prototype.getContentHtml=function(){for(var t='<table style="border-collapse: collapse;">',e=0;e<this.content.length;e++){var n=this.content[e];if(!this.cellSelection.from||!(e<this.cellSelection.from.index.row||e>this.cellSelection.to.index.row)){t+="<tr>";for(var i=0;i<n.length;i++){var r=n[i];if(!this.cellSelection.to||!(i<this.cellSelection.from.index.col||i>this.cellSelection.to.index.col)){var o=this.originalContent[e][i];t+='<td style="'+this.flattenStyles(o.style)+'">'+("no"===r.allow?"":o.formatted_value)+"</td>"}}t+="</tr>"}}return t+="</table>"},Grid.prototype.getCells=function(t,e,n){var i=e.row;-1===i&&(i=this.originalContent.length-1);var r=e.col;-1===r&&(r=this.originalContent[0].length-1);for(var o=[],s=t.row;s<=i;s++)for(var a=t.col;a<=r;a++)o[s]||(o[s]=[]),o[s][a]=this.content[s][a];return o},Grid.prototype.renderGrid=function(t){if(void 0===t&&(t=!1),!this.hidden){var e=!this.width||t||!this.content.length&&!this.content.length||this.content.length!==this.content.length||this.content[0].length!==this.content[0].length;this.buildCells(),this.updateCellAccess(),e&&this.setSize(),this.setOffsets(void 0),e&&this.setFit(this.fit),this.updateScrollbars(),this.init?this.drawGrid():(this.init=!0,requestAnimationFrame(this.drawGrid))}},Grid.prototype.setScale=function(t){this.scale=t*this.ratio,this.setOffsets(void 0),this.updateScrollbars(),requestAnimationFrame(this.drawGrid)},Grid.prototype.setFit=function(t,e){/(scroll|width|height|contain)/.test(t)&&(this.updateFit(t,e),this.setSize(),this.touch||this.updateFit(t,e))},Grid.prototype.clearRanges=function(){this.accessRanges=[],this.buttonRanges=[],this.styleRanges=[],this.freezeRange={valid:!1,index:{row:0,col:0}}},Grid.prototype.setRanges=function(t,e){void 0===e&&(e=void 0),this.clearRanges();for(var n=0;n<t.length;n++){var i=t[n],r=void 0,o=void 0;if(i.range&&(r=_.clone(i.range.to.row),o=_.clone(i.range.to.col),-1===r&&(r=this.originalContent.length-1),-1===o&&(o=this.originalContent[0].length-1)),"frozen_rows"===i.name)this.freezeRange.index.row=i.count;else if("frozen_cols"===i.name)this.freezeRange.index.col=i.count;else if(i instanceof Range_3.StyleRange)for(var s=i.range.from.row;s<=r;s++)for(var a=i.range.from.col;a<=o;a++)this.styleRanges[s]||(this.styleRanges[s]=[]),this.styleRanges[s][a]||(this.styleRanges[s][a]=[]),this.styleRanges[s][a].push(i);else if(i instanceof Range_2.ButtonRange)for(var c=i.range.from.row;c<=r;c++)for(var a=i.range.from.col;a<=o;a++)this.buttonRanges[c]||(this.buttonRanges[c]=[]),this.buttonRanges[c][a]||(this.buttonRanges[c][a]=[]),this.buttonRanges[c][a].push(i);else if(i instanceof Range_1.PermissionRange&&this.originalContent.length){var l=i.getPermission(e||0)||(e?"yes":"no"),u=_.clone(i.rowEnd),h=_.clone(i.colEnd);-1===u&&(u=this.originalContent.length-1),-1===h&&(h=this.originalContent[0].length-1);for(var d=i.rowStart;d<=u;d++)for(var a=i.colStart;a<=h;a++)this.accessRanges[d]||(this.accessRanges[d]=[]),this.accessRanges[d][a]||(this.accessRanges[d][a]=[]),l&&this.accessRanges[d][a].push(l)}}this.updateCellAccess(),(this.freezeRange.index.row>0||this.freezeRange.index.col>0)&&(this.freezeRange.valid=!0)},Grid.prototype.clearFilters=function(){this.filters={},this.updateContent()},Grid.prototype.setFilters=function(t){var e=this;t.col>=0&&(t=[t]),t.forEach2(function(t){if(!t.value||t.remove)return void(e.filters["col"+t.col]&&delete e.filters["col"+t.col]);t.type||(t.type="number"),t.type=/(number|string|date)/.test(t.type)?t.type:"number",(!t.exp||"number"===t.type&&-1===[">","<","<=",">=","==","==="].indexOf(t.exp))&&(t.exp="=="),e.filters["col"+t.col]=t}),this.updateContent()},Grid.prototype.clearSorting=function(){this.sorting={},this.updateContent()},Grid.prototype.setSorting=function(t){var e=this;this.clearSorting(),t.col>=0&&(t=[t]),t.forEach2(function(t){if(t.remove)return void(e.filters["col"+t.col]&&delete e.filters["col"+t.col]);t.direction||(t.direction="ASC"),t.direction=(""+t.direction).toUpperCase(),t.direction=/(ASC|DESC)/.test(t.direction)?t.direction:"ASC",t.col=1*t.col||0,t.type=/(number|string|date)/.test(t.type)?t.type:"number",e.sorting["col"+t.col]=t}),this.updateContent()},Grid.prototype.hideSelector=function(t){void 0===t&&(t=!1),this.emitCellChange(this.cellSelection.from),this.cellSelection.last=this.cellSelection.from,this.cellSelection.on=!1,this.cellSelection.from=void 0,this.cellSelection.to=void 0,this.selection.style.display="none",this.emit(this.ON_CELL_SELECTED,this.cellSelection),this.hideHistoryIndicator()},Grid.prototype.find=function(t){for(var e=this.containerEl.getElementsByClassName("highlight");e[0];)e[0].parentNode.removeChild(e[0]);if(this.found=[],this.foundSelection.count=0,this.foundSelection.selected=0,t){for(var n=0;n<this.content.length;n++)for(var i=this.content[n],r=0;r<i.length;r++){var o=i[r],s=new RegExp(t,"ig"),a=this.originalContent[n][r];"no"!==o.allow&&(s.test(a.value)||s.test(a.formatted_value))&&(this.found[n]||(this.found[n]=[]),this.foundSelection.count++,this.found[n][r]={cell:o,highlight:this.createHighlight(a),originalCell:a})}this.updateSelector()}},Grid.prototype.gotoFoundCell=function(t){var e=this;if("number"==typeof t){if(t<0||t>this.foundSelection.count)return;this.foundSelection.selected=t}else{if(!(["prev","next"].indexOf(t)>-1))return;"next"===t?this.foundSelection.selected++:this.foundSelection.selected--,this.foundSelection.selected>this.foundSelection.count?this.foundSelection.selected=1:this.foundSelection.selected<1&&(this.foundSelection.selected=this.foundSelection.count)}var n=0;this.found.forEach2(function(t,i){t&&t.forEach2(function(t,i){t&&++n===e.foundSelection.selected&&(e.cellSelection.from=t.cell,e.cellSelection.to=t.cell,e.cellSelection.on=!0,e.goto(t.cell.index.col,t.cell.index.row,!0))})})},Grid.prototype.setSelector=function(t,e){e||(e=t),this.content[t.row]&&this.content[t.row][t.col]&&(this.updateSelectorAttributes(this.content[t.row][t.col],this.content[e.row][e.col],this.selection),this.cellSelection.from=this.content[t.row][t.col],this.cellSelection.to=this.content[e.row][e.col],this.emit(this.ON_CELL_SELECTED,this.cellSelection))},Grid.prototype.updateContent=function(){this.content=this.setCellIndexes(this.originalContent),this.applyFilters(),this.applySorting(),this.cellSelection.from&&!this.content[this.cellSelection.from.position.row]&&this.hideSelector()},Grid.prototype.showInput=function(){var t=this,e=this.originalContent[this.cellSelection.from.position.row][this.cellSelection.from.position.col],n=e.style["font-size"].indexOf("px")>-1?"px":"pt";if(this.input.style["font-size"]=""+parseFloat(e.style["font-size"])*this.scale/this.ratio+n,this.input.style["font-family"]=e.style["font-family"]+", sans-serif",this.input.style["font-weight"]=e.style["font-weight"],this.input.style["text-align"]=e.style["text-align"],this.input.style.visibility="visible",this.touch)void 0===this.keyValue&&(this.input.value=""+e.formatted_value),this.input.focus(),void 0!==this.keyValue?this.input.selectionStart=999:this.input.value&&(this.input.selectionStart=0,this.input.selectionEnd=999);else{this.selection.appendChild(this.input),this.selection.contentEditable=!1;var i=setInterval(function(){t.selection.contains(t.input)&&(clearInterval(i),void 0===t.keyValue&&(t.input.value=""+e.formatted_value),t.input.focus(),void 0!==t.keyValue?t.input.selectionStart=999:t.input.value&&(t.input.selectionStart=0,t.input.selectionEnd=999))},20)}},Grid.prototype.setCellIndexes=function(t){var e=[];this.links=[];for(var n=this.containerEl.getElementsByClassName("external-link");n[0];)n[0].parentNode.removeChild(n[0]);for(var i=0;i<t.length;i++){var r=t[i];e[i]=[];for(var o=0;o<r.length;o++){var s=t[i][o],a={value:_.clone(s.value),formatted_value:_.clone(s.formatted_value),width:parseFloat(s.style.width),position:{row:i,col:o}};e[i].push(a),s.link&&s.link.external&&(this.links[i]||(this.links[i]=[]),this.links[i][o]={cell:a,highlight:this.createHighlight(a,{className:"external-link",href:s.link.address,target:"_blank"})})}}return e},Grid.prototype.updateFound=function(t){var e=this;if(this.found[t.index.row]&&this.found[t.index.row][t.index.col]){var n=0;this.found.forEach2(function(i,r){i&&i.forEach2(function(i,r){i&&(n++,i.cell===t&&(e.foundSelection.selected=n))})})}},Grid.prototype.createHighlight=function(t,e,n){void 0===e&&(e={}),void 0===n&&(n={});var i=document.createElement(e.href?"a":"div"),r=document.createElement("div");for(var o in e)i[o]=e[o];i.className||(i.className="highlight"),i.style.position="absolute",i.style["z-index"]=10,i.style.left="0",i.style.top="0",i.style.width=t.width+"px",i.style.height=t.height+"px",i.style.display="none";for(var s in n)r.style[s]=n[s];return i.appendChild(r),this.containerEl.appendChild(i),i},Grid.prototype.applyFilters=function(){if(!Object.keys(this.filters).length)return!1;for(var rowsToRemove=[],rowIndex=0;rowIndex<this.originalContent.length;rowIndex++)if(!(this.freezeRange.valid&&rowIndex<this.freezeRange.index.row)){var _loop_1=function(f){var filter=this_1.filters[f],col=this_1.originalContent[rowIndex][filter.col];if(!col||rowsToRemove.indexOf(rowIndex)>-1)return"continue";var colValue="number"===filter.type?parseFloat(col.value):""+col.formatted_value,filterValue="number"===filter.type?parseFloat(filter.value):""+filter.value,validValue=!1;switch(filter.type){case"number":validValue=eval(colValue+" "+filter.exp+" "+filterValue);break;case"date":var dates=filterValue.split(","),fromDate=new Date(dates[0]).toISOString(),toDate=new Date(dates[1]).toISOString(),date=new Date(this_1.helpers.parseDateExcel(colValue)).toISOString();validValue=date>=fromDate&&date<=toDate;break;default:filterValue.split(",").forEach2(function(t){if(!validValue)switch(filter.exp){case"contains":validValue=colValue.toLowerCase().indexOf(t.toLowerCase())>-1;break;case"starts_with":validValue=colValue.toLowerCase().substring(0,t.length)===t.toLowerCase();break;default:validValue=colValue==t}})}validValue||rowsToRemove.push(rowIndex)},this_1=this;for(var f in this.filters)_loop_1(f)}for(var i=rowsToRemove.length-1;i>=0;i--)this.content.splice(rowsToRemove[i],1)},Grid.prototype.applySorting=function(){if(!Object.keys(this.sorting).length)return!1;var key=Object.keys(this.sorting)[0],filter=this.sorting[key],data=this.freezeRange.index.row?this.content.slice(this.freezeRange.index.row,this.content.length):this.content.slice(0),exp="DESC"===filter.direction?">":"<",opp="DESC"===filter.direction?"<":">";data.sort(function(a,b){var aVal="number"===filter.type?parseFloat(a[filter.col].value)||0:'"'+a[filter.col].value+'"',bVal="number"===filter.type?parseFloat(b[filter.col].value)||0:'"'+b[filter.col].value+'"';return eval(aVal+" "+exp+" "+bVal)?-1:eval(aVal+" "+opp+" "+bVal)?1:0}),this.content=this.freezeRange.index.row?this.content.slice(0,this.freezeRange.index.row).concat(data):data},Grid.prototype.buildCells=function(){this.resetStage(),this.stage.x.increments.push(0),this.stage.y.increments.push(0);for(var t={x:0,y:0},e=0;e<this.content.length;e++){var n=this.content[e];this.stage.x.pos=0;for(var i=void 0,r=void 0,o=0;o<n.length;o++){i=n[o],r=this.originalContent[i.position.row][i.position.col];var s=!1;if((r.style["text-wrap"]&&"wrap"===r.style["text-wrap"]||"break-word"===r.style["word-wrap"])&&(s=!0),i.wrap=s,i.x=this.stage.x.pos,i.y=this.stage.y.pos,i.width=parseFloat(r.style.width),i.height=parseFloat(r.style.height),i.index={row:e,col:o},i.allow=!0,i.link=r.link,this.stage.x.pos+=i.width,o===n.length-1&&this.borders.widths[r.style.rbw]&&(this.stage.x.pos+=this.borders.widths[r.style.rbw]),e||(!this.freezeRange.valid||this.freezeRange.valid&&o>=this.freezeRange.index.col?this.stage.x.increments.push(this.stage.x.pos-t.x):t.x+=i.width),this.trackingHighlights[e]&&this.trackingHighlights[e][o]){var a={};this.trackingHighlightMatchColor&&(a["background-color"]="#"+r.style.color.replace("#","")),this.trackingHighlights[e][o]=new GridTrackingHighlight(i,this.createHighlight(i,{className:"tracking "+this.trackingHighlightClassname},a)),this.trackingHighlights[e][o].lifetime=this.trackingHighlightLifetime}}this.stage.x.pos>this.stage.x.size&&(this.stage.x.size=this.stage.x.pos),this.stage.y.pos+=i.height,this.stage.y.size+=i.height,e===this.content.length-1&&this.borders.widths[r.style.bbw]&&(this.stage.y.pos+=this.borders.widths[r.style.bbw],this.stage.y.size+=this.borders.widths[r.style.bbw]),!this.freezeRange.valid||this.freezeRange.valid&&e>=this.freezeRange.index.row?this.stage.y.increments.push(this.stage.y.pos-t.y):t.y+=i.height}},Grid.prototype.updateCellAccess=function(){var t=this;if(this.content.length){for(var e=0;e<this.content.length;e++)for(var n=this.content[e],i=0;i<n.length;i++){var r=n[i];r.allow=!0,r.button=!1,r.formatting=!1}this.accessRanges.forEach2(function(e,n){e&&e.forEach2(function(e,i){e&&-1===e.indexOf("yes")&&e.forEach2(function(e){-1!==["ro","no"].indexOf(e)&&t.content[n]&&t.content[n][i]&&(t.content[n][i].allow=e)})})}),this.buttonRanges.forEach2(function(e,n){e&&e.forEach2(function(e,i){e&&t.content[n]&&t.content[n][i]&&(t.content[n][i].button=e)})});var o=this.originalContent.length-1,s=this.originalContent[0].length-1;this.styleRanges.forEach2(function(e,n){e&&e.forEach2(function(e,i){e&&t.content[n]&&t.content[n][i]&&e.forEach2(function(e){e.match(t.content[n][i].value)&&e.formatting.forEach2(function(r){for(var a=e.parseFormat(r,n,i,o,s),c=a.from.row;c<=a.to.row;c++)for(var l=a.from.col;l<=a.to.col;l++)t.content[c]&&t.content[c][l]&&(t.content[c][l].formatting?t.content[c][l].formatting=merge(t.content[c][l].formatting,a.style):t.content[c][l].formatting=a.style)})})})})}},Grid.prototype.updateFit=function(t,e){switch(this.fit=t,t){case"scroll":this.setScale(e?this.scale/this.ratio:this.ratioScale/this.ratio);break;case"width":if(!this.stage.x.size)return;this.setScale(this.width/this.stage.x.size);break;case"height":if(!this.stage.y.size)return;this.setScale(this.height/this.stage.y.size);break;case"contain":if(!this.stage.x.size||!this.stage.y.size)return;var n=this.width/this.stage.x.size,i=this.height/this.stage.y.size;this.setScale(i<n?i:n)}},Grid.prototype.setupTouch=function(){var t=this;this.hammer=new Hammer(this.containerEl);var e=new Hammer.Pan,n=new Hammer.Pinch;this.hammer.add([e,n]);var i=this.scale/this.ratio*1;this.hammer.on("pinchstart",function(e){t.fit="scroll",i=t.scale/t.ratio*1}),this.hammer.on("pinchmove",function(e){t.setScale(i*e.scale)}),this.hammer.on("pinchend",function(e){i=t.scale/t.ratio*1});var r={x:0,y:0};this.hammer.on("panstart",function(t){r={x:t.center.x,y:t.center.y}}),this.hammer.on("panmove",function(e){var n=Math.round(t.ratio/t.scale);n<1&&(n=1);var i=0;if(Math.abs(e.center.x-r.x)>5*t.scale){var o=e.velocityX>0?-1:1;r.x=e.center.x,i=n*o}var s=0;if(Math.abs(e.center.y-r.y)>5*t.scale){var a=e.velocityY>0?-1:1;r.y=e.center.y,s=n*a}t.setOffsets({x:i,y:s}),t.drawGrid()}),this.hammer.on("panend",function(t){})},Grid.prototype.isRightClick=function(t){var e;return"which"in t?e=3===t.which:"button"in t&&(e=2===t.button),e},Grid.prototype.setCellSelection=function(t,e,n,i){void 0===e&&(e=!1),void 0===i&&(i={x:0,y:0}),this.editing,this.cellHasHistory(t,i),this.cellSelection.clicked=n,this.cellSelection.from=t,this.cellSelection.to=t,this.cellSelection.go=!1,this.cellSelection.on=!1,this.disallowSelection||t.link||(this.cellSelection.go=e,this.cellSelection.on=!0,this.updateSelector()),this.updateFound(t),this.emit(this.ON_CELL_SELECTED,this.cellSelection),n&&this.emit(this.ON_CELL_CLICKED,{cell:t,history:t.history.show}),this.hasFocus=!0,this.keyValue=void 0,this.touch||(this.selection.innerText=""),this.editing?this.showInput():this.alwaysEditing&&(this.editing=!0)},Grid.prototype.keepSelectorWithinView=function(){var t=this;if(this.touch){var e=this.cellSelection.from.index.row;return this.freezeRange.valid&&(e+=this.freezeRange.index.row),void(this.visible[e]||(this.setOffsets({y:e}),requestAnimationFrame(this.drawGrid)))}var n,i=this.cellSelection.from.index.row,r=this.cellSelection.from.index.col,o=0,s=0,a=-1,c=-1,l=-1,u=-1;this.visible.forEach2(function(e,i){e&&(a<0&&(!t.freezeRange.valid||i>t.freezeRange.index.row)&&(a=i+0),c=i,n||t.freezeRange.valid&&!(i>t.freezeRange.index.row)||(n=e))}),n.forEach2(function(e,n){e&&(l<0&&(!t.freezeRange.valid||n>t.freezeRange.index.col)&&(l=n+0),u=n+0)}),i?i===this.content.length-1?this.offsets.y.index=this.offsets.y.max:i<a+2+this.freezeRange.index.row?s=-1:i>c-2&&(s=1):this.offsets.y.index=0,r?r===this.content[0].length-1?this.offsets.x.index=this.offsets.x.max:o=r-this.offsets.x.index-this.freezeRange.index.col:this.offsets.x.index=0,this.goto(o,s)},Grid.prototype.goto=function(t,e,n){void 0===n&&(n=!1),this.setOffsets({x:t,y:e},n),this.updateScrollbars(),this.drawGrid(),setTimeout(function(){},50)},Grid.prototype.restoreCell=function(t){t&&(t.dirty=!1,t.formatted_value=this.content[t.position.row][t.position.col].formatted_value,t.value=this.content[t.position.row][t.position.col].value)},Grid.prototype.nextCellInput=function(t,e){void 0===e&&(e="");var n=t.index.row,i=t.index.col;if("left"===e)return void(this.content[n][i-1]?this.setCellSelection(this.content[n][i-1]):this.content[n-1]&&this.setCellSelection(this.content[n-1][this.content[n].length-1]));if("up"===e){if(this.content[n-1]&&this.content[n-1][i])return void this.setCellSelection(this.content[n-1][i]);if(this.content[this.content.length-1]&&this.content[this.content.length-1][i-1])return void this.setCellSelection(this.content[this.content.length-1][i-1])}if("down"===e){if(this.content[n+1]&&this.content[n+1][i])return void this.setCellSelection(this.content[n+1][i]);if(this.content[0][i+1])return void this.setCellSelection(this.content[0][i+1])}return this.content[n][i+1]?void this.setCellSelection(this.content[n][i+1]):this.content[n+1]?void this.setCellSelection(this.content[n+1][0]):void this.setCellSelection(this.content[0][0])},Grid.prototype.setEditCell=function(t){return!0!==t.allow?(this.editing=!1,!1):(this.emitCellChange(this.cellSelection.from),void 0!==this.keyValue&&(t.formatted_value=t.value=_.clone(this.keyValue),t.dirty=!0),this.cellSelection.from=t,this.cellSelection.to=t,this.keepSelectorWithinView(),this.editing=!0,this.keyValue,!0)},Grid.prototype.emitCellChange=function(t){t&&t.dirty&&(this.keyValue=void 0,this.input.value="",this.softMerges(this.content[this.cellSelection.from.index.row],this.cellSelection.from.index.row),this.drawGrid(),t.dirty=!1)},Grid.prototype.isCanvas=function(t){for(var e=t;e&&e!==this.gc.canvas;)e=e.parentNode;return e===this.gc.canvas},Grid.prototype.isInput=function(t){for(var e=t;e&&e!==this.input;)e=e.parentNode;return e===this.input},Grid.prototype.getCell=function(t,e){var n=this.containerEl.getBoundingClientRect();t-=n.left-this.offsets.x.offset*this.scale/this.ratio,e-=n.top-this.offsets.y.offset*this.scale/this.ratio;for(var i,r=0;r<this.content.length;r++){for(var o=this.content[r],s=0;s<o.length;s++){var a=o[s];if(!(t<a.x*this.scale/this.ratio)&&!(t>(a.x+a.width)*this.scale/this.ratio||e<a.y*this.scale/this.ratio||e>(a.y+a.height)*this.scale/this.ratio)){i=a;break}}if(i)break}return i},Grid.prototype.cellHasHistory=function(t,e){void 0===e&&(e={x:0,y:0});var n=this.containerEl.getBoundingClientRect();e.x-=n.left-this.offsets.x.offset*this.scale/this.ratio,e.y-=n.top-this.offsets.y.offset*this.scale/this.ratio;var i=this.history[t.position.row]&&this.history[t.position.row][t.position.col]>=0;t.history={valid:i,show:!!(i&&e.x>(t.x+t.overlayWidth-16)*this.scale/this.ratio&&e.y<(t.y+16)*this.scale/this.ratio),color:i?this.userTrackingColors[this.history[t.position.row][t.position.col]]:""}},Grid.prototype.createScrollbars=function(){var t=this;["x","y"].forEach2(function(e){var n=t.scrollbars[e].anchor;t.scrollbars[e].track=document.createElement("div"),t.scrollbars[e].handle=document.createElement("div"),t.scrollbars[e].track.style.position="absolute",t.scrollbars[e].track.style["z-index"]=100,t.scrollbars[e].track.style.display="none",t.scrollbars[e].track.className="track",t.scrollbars[e].handle.style.position="absolute",t.scrollbars[e].handle.style["z-index"]=1,t.scrollbars[e].handle.style.left=0,t.scrollbars[e].handle.style.top=0,t.scrollbars[e].handle.className="handle",t.scrollbars[e].handle.addEventListener("mousedown",function(i){t.scrollbars.scrolling=!0,t.scrollbars[e].start=i[e],t.scrollbars[e].drag=!0,t.scrollbars[e].offset=parseInt(t.scrollbars[e].handle.style[n],10),i.preventDefault()},!1),"x"===e?(t.scrollbars[e].track.style.left=0,t.scrollbars[e].track.style.bottom=0,t.scrollbars[e].track.style.right=t.scrollbars.width+"px",t.scrollbars[e].track.style.height=t.scrollbars.width+"px",t.scrollbars[e].handle.style.height=t.scrollbars.width+"px"):(t.scrollbars[e].track.style.top=0,t.scrollbars[e].track.style.right=0,t.scrollbars[e].track.style.bottom=t.scrollbars.width+"px",t.scrollbars[e].track.style.width=t.scrollbars.width+"px",t.scrollbars[e].handle.style.width=t.scrollbars.width+"px"),t.scrollbars[e].track.appendChild(t.scrollbars[e].handle),t.containerEl.appendChild(t.scrollbars[e].track)})},Grid.prototype.updateScrollbars=function(){var t=this;if(!this.touch&&!this.fluid){["x","y"].forEach2(function(e){if(!t.offsets[e].maxOffset)return t.scrollbars[e].track.style.display="none",t.scrollbars[e].handle.style.display="none",t.scrollbars[e].show=!1,t.offsets[e].index=0,void(t.offsets[e].offset=0);var n=t.stage[e].label,i=t[n];t.scrollbars[e].show=!0,t.scrollbars[e].handle.style.display="block";var r=i*(i/(t.stage[e].size*t.scale));t.scrollbars[e].handle.style[n]=r+"px";var o=t.offsets[e].index/t.offsets[e].max*(i-r),s=t.scrollbars[e].anchor;t.scrollbars[e].handle.style[s]=o+"px",t.scrollbars[e].track.style.display="block",t.scrollbars[e].track.style[n]=t[n]+"px"})}},Grid.prototype.createSelector=function(){var t=this;this.selection=document.createElement("div"),this.selection.className="selection",this.touch||(this.selection.contentEditable=!0),this.selection.style.position="absolute",this.selection.style["z-index"]=20,this.selection.style.left=0,this.selection.style.top=0,this.selection.style.display="none",this.selection.addEventListener("paste",function(t){t.preventDefault()}),this.historyIndicator=document.createElement("div"),this.historyIndicator.className="history",this.historyIndicator.style.position="absolute",this.historyIndicator.style["z-index"]=30,this.historyIndicator.style.display="none",this.input=document.createElement("input"),this.input.setAttribute("autocapitalize","none"),this.input.style.position="absolute",this.input.style.border="0",this.input.style["font-size"]="12px",this.input.style.color="black",this.input.style["background-color"]="ivory",this.input.style["box-sizing"]="border-box",this.input.style.margin="0",this.input.style.padding="0 2px",this.input.style.outline="0",this.input.style.left="0px",this.input.style.right="0px",this.input.style.bottom="0px",this.input.style.top="0px",this.input.style.width="100%",this.input.style["text-align"]="left",this.input.style["z-index"]=10,this.input.style.visibility="hidden",this.input.style.display="display",this.input.style.height="100%",this.input.addEventListener("keyup",function(e){t.dirty=!0,t.emit(t.ON_CELL_VALUE,{cell:t.cellSelection.from,value:""+t.input.value})}),this.input.addEventListener("touchstart",function(t){}),this.input.addEventListener("paste",function(e){e.stopPropagation();var n="";try{n=e.clipboardData.getData("text/plain")}catch(t){}try{n||(n=window.clipboardData.getData("Text"))}catch(t){}t.dirty=!0,t.emit(t.ON_CELL_VALUE,{cell:t.cellSelection.from,value:""+n})}),this.touch&&this.selection.appendChild(this.input),this.containerEl.appendChild(this.selection)},Grid.prototype.updateSelectorAttributes=function(t,e,n,i){void 0===i&&(i=!1);var r=t.x,o=t.y,s=e.x+e.width-t.x,a=e.y+e.height-t.y;e.x<r&&(r=e.x,s=t.x+t.width-e.x),e.y<o&&(o=e.y,a=t.y+t.height-e.y),(!this.freezeRange.valid||t.position.col>=this.freezeRange.index.col)&&(r-=this.offsets.x.offset),r=r*this.scale/this.ratio,(!this.freezeRange.valid||t.position.row>=this.freezeRange.index.row)&&(o-=this.offsets.y.offset),o=o*this.scale/this.ratio,s=(s+1)*this.scale/this.ratio,a=(a+1)*this.scale/this.ratio,i?(n.style.left=r+s-this.historyIndicatorSize+"px",n.style["background-color"]=t.history.color):(n.style.left=r+"px",n.style.width=s+"px",n.style.height=a+"px"),n.style.top=o+"px";var c=!0;this.freezeRange.valid&&(t.position.row>this.freezeRange.index.row-1&&t.position.row-this.freezeRange.index.row<this.offsets.y.index&&(c=!1),t.position.col>this.freezeRange.index.col-1&&t.position.col-this.freezeRange.index.col<this.offsets.x.index&&(c=!1)),n.style.display=c?"block":"none"},Grid.prototype.hideHistoryIndicator=function(){this.containerEl.contains(this.historyIndicator)&&this.containerEl.removeChild(this.historyIndicator)},Grid.prototype.updateSelector=function(t){var e=this;t||this.hideHistoryIndicator(),this.cellSelection.on&&this.updateSelectorAttributes(this.cellSelection.from,this.cellSelection.to,this.selection),this.found.forEach2(function(t,n){t&&t.forEach2(function(t,i){t&&(e.visible[n]&&e.visible[n][i]?(e.containerEl.contains(t.highlight)||e.containerEl.appendChild(t.highlight),e.updateSelectorAttributes(t.cell,t.cell,t.highlight)):e.containerEl.contains(t.highlight)&&e.containerEl.removeChild(t.highlight))})}),this.links.forEach2(function(t,n){t&&t.forEach2(function(t,i){t&&(e.visible[n]&&e.visible[n][i]?(e.containerEl.contains(t.highlight)||e.containerEl.appendChild(t.highlight),e.updateSelectorAttributes(t.cell,t.cell,t.highlight)):e.containerEl.contains(t.highlight)&&e.containerEl.removeChild(t.highlight))})}),this.trackingHighlights.forEach2(function(t,n){t&&t.forEach2(function(t,i){t&&!0!==t&&(e.visible[n]&&e.visible[n][i]?(e.updateSelectorAttributes(t.cell,t.cell,t.highlight),e.containerEl.contains(t.highlight)||e.containerEl.appendChild(t.highlight),t.run?t.destroy():t.flash()):t.destroy())})})},Grid.prototype.setOffsets=function(t,e){var n=this;if(void 0===e&&(e=!1),["x","y"].forEach2(function(t){var e=1*n[n.stage[t].label]/n.scale*n.ratio;n.offsets[t].max=0,n.offsets[t].maxOffset=n.stage[t].size-e,n.offsets[t].maxOffset<0&&(n.offsets[t].maxOffset=0),n.stage[t].increments.forEach2(function(e,i){e>n.offsets[t].maxOffset&&!n.offsets[t].max&&(n.offsets[t].max=i)})}),t)for(var i in t)if(t[i]){if(e){var r=t[i],o="x"===i?"col":"row";this.freezeRange.valid&&(r-=this.freezeRange.index[o]+2),this.offsets[i].index=r}else this.offsets[i].index+=t[i];this.offsets[i].index<0&&(this.offsets[i].index=0),this.offsets[i].index>=this.offsets[i].max&&(this.offsets[i].index=this.offsets[i].max)}["x","y"].forEach2(function(t){var e=n.stage[t].increments[n.offsets[t].index];e>n.offsets[t].maxOffset&&(e=n.offsets[t].maxOffset),n.offsets[t].offset=e,n.allowBrowserScroll=n.offsets[t].index===n.offsets[t].max})},Grid.prototype.resetStage=function(){this.stage={x:{label:"width",pos:0,increments:[],size:0,stop:!1},y:{label:"height",pos:0,increments:[],size:0,stop:!1}}},Grid.prototype.setSize=function(){var t=this.containerRect=this.containerEl.getBoundingClientRect();t.width||(t.width=this.stage.x.size,t.height=this.stage.y.size);var e=!this.offsets.x.maxOffset&&!this.offsets.y.maxOffset||this.touch?0:this.scrollbars.width,n=!this.offsets.x.maxOffset&&!this.offsets.y.maxOffset||this.touch?0:this.scrollbars.width,i=this.stage.x.size*this.scale/this.ratio,r=this.stage.y.size*this.scale/this.ratio;(t.width>i||this.fluid||this.scrollbars.inset)&&(n=0),(t.height>r||this.fluid||this.scrollbars.inset)&&(e=0),this.width=this.fluid?this.stage.x.size:t.width-e,this.height=this.fluid?this.stage.y.size:t.height-n,this.gc.buffer.width=(this.fluid?this.stage.x.size:t.width-e)*this.ratio,this.gc.buffer.height=(this.fluid?this.stage.y.size:t.height-n)*this.ratio,this.gc.canvas.width=(this.fluid?this.stage.x.size:t.width-e)*this.ratio,this.gc.canvas.height=(this.fluid?this.stage.y.size:t.height-n)*this.ratio,this.gc.canvas.style.width=this.fluid?this.stage.x.size+"px":Math.floor(t.width-e)+"px",this.gc.canvas.style.height=this.fluid?this.stage.y.size+"px":Math.floor(t.height-n)+"px"},Grid.prototype.getTextOverlayWidth=function(t,e,n,i){var r=this.originalContent[t][e],o=r.style["text-align"],s=0,a=0;switch(o){case"right":s=-1;break;case"center":s=-1,a=1;break;default:a=1}if(!this.content[t][e+a]||!this.content[t][e+s])return{col:e,width:n};var c=e,l=e;if(a>0)for(var u=e+1;u<this.content[t].length&&!(this.content[t][u].formatted_value||""+this.content[t][u].value||"no"===this.content[t][u].allow)&&(n+=this.content[t][u].width,c=u,this.content[t][u].hidden=!0,!(n>i));u++);if(s<0)for(var u=e-1;u>=0&&!(this.content[t][u].formatted_value||""+this.content[t][u].value||"no"===this.content[t][u].allow)&&(n+=this.content[t][u].width,l=u,this.content[t][u].hidden=!0,!(n>i));u--);return{left:s,right:a,endCol:c,startCol:l,width:n}},Grid.prototype.softMerges=function(t,e){var n=this;void 0===t&&(t=[]),void 0===e&&(e=-1),t.forEach2(function(t,i){var r=n.originalContent[e][i],o=parseFloat(r.style.width);if(t.overlayWidth=o,t.overlayEnd=i,t.overlayStart=i,(r.formatted_value||r.value)&&!t.wrap){n.gc.bufferContext.font=n.getFontString(r);var s=n.gc.bufferContext.measureText(n.cleanValue(r.formatted_value||r.value)).width+3;if(s>o){var a=n.getTextOverlayWidth(e,i,o,s);t.overlayWidth=a.width,t.overlayEnd=a.endCol,t.overlayStart=a.startCol}}})},Grid.prototype.getFontString=function(t){return t.style["font-style"]+" "+t.style["font-weight"]+" "+t.style["font-size"]+' "'+t.style["font-family"]+'", sans-serif'},Grid.prototype.flattenStyles=function(t){var e={};this.cellStyles.forEach(function(n){e[n]=t[n]});for(var n in this.borders.names){var i=this.borders.names[n],r=this.borders.widths[t[n+"bw"]]+"px",o=t[n+"bs"],s="#"+t[n+"bc"].replace("#","");e["border-"+i]=r+" "+o+" "+s}var a="";for(var c in e){var l=e[c];"background-color"!==c&&"color"!==c||-1!==l.indexOf("#")||(l="#"+l),a+=c+": "+l+"; "}return a},Grid.prototype.getBackgroundColor=function(t,e){var n=""+t.style["background-color"]||"white",i="#"+n.replace("#","");return this.helpers.validHex(i)?n=i:"none"===n&&(n="white"),e.formatting&&e.formatting.background&&(n=e.formatting.background),n},Grid.prototype.drawGraphics=function(t,e,n){var i=this;if(0===(""+n.value).indexOf("data:image")){var r=new Image;r.onload=function(){i.gc.canvasContext.drawImage(r,e.x,e.y,e.width*i.scale,e.height*i.scale)},r.src=n.value}else if(!n.hidden&&(this.drawRect(t,{x:e.x,y:e.y,width:e.width,height:e.height},n),this.drawText(t,{x:e.x,y:e.y,width:e.width,height:e.height},n),"no"===n.allow)){var o=this.getBackgroundColor(t,n),s=this.helpers.getContrastYIQ(o);for(var a in this.noAccessImages)if(s===a&&this.noAccessImages[a]){var c=this.gc.bufferContext.createPattern(document.getElementById(this.noAccessImages[a]),"repeat");this.gc.bufferContext.beginPath(),this.gc.bufferContext.rect(e.x,e.y,e.width,e.height),this.gc.bufferContext.fillStyle=c,this.gc.bufferContext.fill()}}"none"!==t.style.tbs&&this.gridLines.push([{x:e._x-this.borders.widths[t.style.tbw]/2,y:e.y},{x:e._a,y:e.y},{width:this.borders.widths[t.style.tbw],color:t.style.tbc}]),"none"===t.style.rbs||e.a!==e._a||n.hidden||this.gridLines.push([{x:e._a,y:e.y},{x:e._a,y:e.b},{width:this.borders.widths[t.style.rbw],color:t.style.rbc}]),"none"!==t.style.bbs&&this.gridLines.push([{x:e._x,y:e.b},{x:e._a,y:e.b},{width:this.borders.widths[t.style.bbw],color:t.style.bbc}]),"none"===t.style.lbs||e.x!==e._x||n.hidden||this.gridLines.push([{x:e.x,y:e.y},{x:e.x,y:e.b},{width:this.borders.widths[t.style.lbw],color:t.style.lbc}])},Grid.prototype.drawLine=function(t,e,n){var i=this.translateCanvas(n.width||1);this.gc.bufferContext.beginPath(),this.gc.bufferContext.lineWidth=n.width||1,this.gc.bufferContext.strokeStyle="#"+(n.color||"000000").replace("#",""),this.gc.bufferContext.moveTo(t.x,t.y),this.gc.bufferContext.lineTo(e.x,e.y),this.gc.bufferContext.stroke(),this.resetCanvas(i)},Grid.prototype.drawTrackingRect=function(t,e){this.gc.bufferContext.beginPath(),this.gc.bufferContext.strokeStyle=this.userTrackingColors[this.history[e.position.row][e.position.col]],this.gc.bufferContext.lineWidth=2,this.gc.bufferContext.rect(t.x+2,t.y+2,t.width-3,t.height-3),this.gc.bufferContext.stroke()},Grid.prototype.drawSortingIndicator=function(t,e){this.gc.bufferContext.beginPath(),this.gc.bufferContext.fillStyle="red";var n=t.x+t.width-10-this.offsets.x.offset;if("DESC"===e){var i=t.y;this.gc.bufferContext.moveTo(n,i),this.gc.bufferContext.lineTo(n+10,i),this.gc.bufferContext.lineTo(n+5,i+5),this.gc.bufferContext.lineTo(n,i)}else{var i=t.y+t.height-5;this.gc.bufferContext.moveTo(n+5,i),this.gc.bufferContext.lineTo(n+10,i+5),this.gc.bufferContext.lineTo(n,i+5),this.gc.bufferContext.lineTo(n+5,i)}this.gc.bufferContext.fill()},Grid.prototype.drawOffsetRect=function(t,e,n){var i=this.getBackgroundColor(t,n);this.gc.bufferContext.beginPath(),this.gc.bufferContext.fillStyle=i,this.gc.bufferContext.fillRect(e.x-.5,e.y-.5,e.width+.5,e.height+.5)},Grid.prototype.drawRect=function(t,e,n){var i=this.getBackgroundColor(t,n);this.gc.bufferContext.beginPath(),this.gc.bufferContext.fillStyle=i,this.gc.bufferContext.fillRect(e.x,e.y,e.width,e.height)},Grid.prototype.cleanValue=function(t){return(t+"").trim().replace(/\s\s+/g," ")},Grid.prototype.drawText=function(t,e,n){var i=this;if("no"!==n.allow){var r=this.cleanValue(t.formatted_value||t.value),o="#"+t.style.color.replace("#","");n.formatting&&n.formatting.color&&(o=n.formatting.color),this.gc.bufferContext.fillStyle=o,this.gc.bufferContext.font=this.getFontString(t),this.gc.bufferContext.textAlign=t.style["text-align"].replace("justify","left").replace("start","left");var s=0,a=0;switch(t.style["text-align"]){case"right":s=e.x+e.width-3;break;case"middle":case"center":s=e.x+e.width/2;break;default:s=e.x+3}var c=0,l=this.gc.bufferContext.measureText("M").width,u=[];switch(n.wrap&&(u=this.findLines(r,l,e.width-6),c=u.offset),t.style["vertical-align"]){case"top":a=e.y+l+5;break;case"center":case"middle":a=e.y+e.height/2-c/2+l/2;break;default:a=e.y+e.height-5-c}if(this.gc.bufferContext.save(),this.gc.bufferContext.beginPath(),this.gc.bufferContext.rect(e.x,e.y,e.width,e.height),this.gc.bufferContext.clip(),n.wrap)u.lines.forEach2(function(e){if(i.gc.bufferContext.fillText(e.value,s,a+e.y),t.link){var n=Math.round(a+2+e.y),r=Math.round(i.gc.bufferContext.measureText(e.value).width),c=s;switch(t.style["text-align"]){case"right":c=s-r;break;case"middle":case"center":c=s-r/2}i.drawLine({x:c,y:n},{x:c+r,y:n},{width:1,color:o})}});else{if(t.style["number-format"]&&t.style["number-format"].indexOf("0.00")>-1&&/(Â¥|â‚¬|Â£|\$)/.test(r)){var h=r.split(" ");this.gc.bufferContext.fillText(h.length>1?h[1]:r,s,a),h.length>1&&(this.gc.bufferContext.textAlign="left",this.gc.bufferContext.fillText(h[0],e.x+3,a))}else this.gc.bufferContext.fillText(r,s,a);if(t.link){var d=Math.round(a+2),f=Math.round(this.gc.bufferContext.measureText(r).width),p=s;switch(t.style["text-align"]){case"right":p=s-f;break;case"middle":case"center":p=s-f/2}this.drawLine({x:p,y:d},{x:p+f,y:d},{width:1,color:o})}}this.gc.bufferContext.restore()}},Grid.prototype.findLines=function(t,e,n){for(var i=t.split(" "),r=[],o=[],s=0,a=e+4,c=0;c<i.length;c++){var l=this.gc.bufferContext.measureText(i[c]).width+2;if(l>n){var u=i[c].split(""),h=0;l=0,o=[];for(var d=0;d<u.length;d++)h=this.gc.bufferContext.measureText(o.join("")).width+2,h<n?(o.push(u[d]),l=h):(r.push({value:o.join(""),width:l}),o=[u[d]]);o.length&&r.push({value:o.join(""),width:l})}else r.push({value:i[c],width:l})}for(var f=[],p=0,g=[],d=0;d<r.length;d++)p+=r[d].width,p<n?g.push(r[d].value):(f.push({value:g.join(" "),y:s}),s+=a,g=[r[d].value],p=r[d].width);return g.length&&f.push({value:g.join(" "),y:s}),{lines:f,offset:e*(f.length-1)+4*(f.length-1)}},Grid.prototype.translateCanvas=function(t){var e=t%2/2;return this.gc.bufferContext.translate(e,e),e},Grid.prototype.resetCanvas=function(t){this.gc.bufferContext.translate(-t,-t)},Grid}(Emitter_1.default);exports.Grid=Grid;var GridTrackingHighlight=function(){function t(t,e){this.cell=t,this.highlight=e,this.run=!1,this.lifetime=3e3,this.done=!1,this.classy=new Classy_1.default}return t.prototype.flash=function(){var t=this;this.run=!0,this.interval=setInterval(function(){t.highlight.parentNode&&(t.classy.addClass(t.highlight,"flash"),clearInterval(t.interval),setTimeout(function(){t.done=!0,t.classy.addClass(t.highlight,"done")},t.lifetime))},50)},t.prototype.destroy=function(){this.done&&this.highlight.parentNode&&this.highlight.parentNode.removeChild(this.highlight)},t}(),GridWrap=function(){function t(){return Grid}return t.$inject=[],t}();exports.GridWrap=GridWrap},function(t,e,n){var i;!function(r){"use strict";function o(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t}function s(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.setDate(e.getDate()-(e.getDay()+6)%7+3);var n=new Date(e.getFullYear(),0,4);n.setDate(n.getDate()-(n.getDay()+6)%7+3);var i=e.getTimezoneOffset()-n.getTimezoneOffset();e.setHours(e.getHours()-i);var r=(e-n)/6048e5;return 1+Math.floor(r)}function a(t){var e=t.getDay();return 0===e&&(e=7),e}function c(t){return null===t?"null":void 0===t?"undefined":"object"!=typeof t?typeof t:Array.isArray(t)?"array":{}.toString.call(t).slice(8,-1).toLowerCase()}var l=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,e=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g;return function(i,r,u,h){if(1!==arguments.length||"string"!==c(i)||/\d/.test(i)||(r=i,i=void 0),i=i||new Date,i instanceof Date||(i=new Date(i)),isNaN(i))throw TypeError("Invalid date");r=String(l.masks[r]||r||l.masks.default);var d=r.slice(0,4);"UTC:"!==d&&"GMT:"!==d||(r=r.slice(4),u=!0,"GMT:"===d&&(h=!0));var f=u?"getUTC":"get",p=i[f+"Date"](),g=i[f+"Day"](),y=i[f+"Month"](),v=i[f+"FullYear"](),m=i[f+"Hours"](),_=i[f+"Minutes"](),b=i[f+"Seconds"](),w=i[f+"Milliseconds"](),E=u?0:i.getTimezoneOffset(),x=s(i),C=a(i),k={d:p,dd:o(p),ddd:l.i18n.dayNames[g],dddd:l.i18n.dayNames[g+7],m:y+1,mm:o(y+1),mmm:l.i18n.monthNames[y],mmmm:l.i18n.monthNames[y+12],yy:String(v).slice(2),yyyy:v,h:m%12||12,hh:o(m%12||12),H:m,HH:o(m),M:_,MM:o(_),s:b,ss:o(b),l:o(w,3),L:o(Math.round(w/10)),t:m<12?l.i18n.timeNames[0]:l.i18n.timeNames[1],tt:m<12?l.i18n.timeNames[2]:l.i18n.timeNames[3],T:m<12?l.i18n.timeNames[4]:l.i18n.timeNames[5],TT:m<12?l.i18n.timeNames[6]:l.i18n.timeNames[7],Z:h?"GMT":u?"UTC":(String(i).match(e)||[""]).pop().replace(n,""),o:(E>0?"-":"+")+o(100*Math.floor(Math.abs(E)/60)+Math.abs(E)%60,4),S:["th","st","nd","rd"][p%10>3?0:(p%100-p%10!=10)*p%10],W:x,N:C};return r.replace(t,function(t){return t in k?k[t]:t.slice(1,t.length-1)})}}();l.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},l.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},void 0!==(i=function(){return l}.call(e,n,e,t))&&(t.exports=i)}()},function(t,e){(function(e){t.exports=e}).call(e,{})},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=n(5),s=n(2),a=function(t){function e(e,n){var i=t.call(this)||this;return i.editableAreaId="pages-editable",i.focus=!1,i.clipboardTextPlain="",i.key="",i.doc=!1,i.validStyles=["color","background","background-color","border","border-left","border-right","border-top","border-bottom","width","height","text-align","vertical-align","font-family","font-size","font-weight","font-style","text-wrap","text-decoration","number-format","word-wrap","white-space"],i.excelStyles=["tb","rb","bb","lb"],i.excelBorderStyles={solid:"solid",dashed:"dashed",dashdotdot:"dotted",double:"double"},i.excelBorderWeights={"1px":"thin","2px":"medium","3px":"thick"},i.borderSides=["top","right","bottom","left"],i.borderSyles=["width","style","color"],i.onEditFocus=function(t){i.focus=!0},i.onEditBlur=function(t){i.focus=!1},i.onPasteDocument=function(t){if(!i.focus){var e=i.getClipboardText(t);i.clipboardTextPlain=e.text;var n=i.createPastedElement(e.html||e.text);i.getHtml(n)}},i.onPaste=function(t){var e=i.getClipboardText(t);i.clipboardTextPlain=e.text;try{var n=i.createPastedElement(e.html);i.getHtml(n),t.preventDefault()}catch(e){i.getHtml(t.target)}},i.onKeyDown=function(t){i.key=t.key,"Control"===i.key&&"v"===t.key||t.preventDefault()},i.utils=new o.default,i.init(e,n),i}return i(e,t),Object.defineProperty(e.prototype,"ON_DATA",{get:function(){return"data"},enumerable:!0,configurable:!0}),e.prototype.init=function(t,e){return this.destroy(),this.editableAreaEl="string"==typeof t?document.getElementById(t):t,this.editableAreaEl&&(this.utils.addEvent(this.editableAreaEl,"paste",this.onPaste),this.utils.addEvent(this.editableAreaEl,"focus",this.onEditFocus),this.utils.addEvent(this.editableAreaEl,"blur",this.onEditBlur),this.utils.addEvent(this.editableAreaEl,"keypress",this.onKeyDown),this.utils.addEvent(this.editableAreaEl,"drop",this.onPaste),this.editableAreaEl.focus()),e?(this.utils.addEvent(document,"paste",this.onPasteDocument),this.doc=!0):this.doc=!1,!0},e.prototype.destroy=function(){this.focus=!1,this.editableAreaEl&&(this.utils.removeEvent(this.editableAreaEl,"paste",this.onPaste),this.utils.removeEvent(this.editableAreaEl,"focus",this.onEditFocus),this.utils.removeEvent(this.editableAreaEl,"blur",this.onEditBlur),this.utils.removeEvent(this.editableAreaEl,"keypress",this.onKeyDown),this.utils.removeEvent(this.editableAreaEl,"drop",this.onKeyDown)),this.doc&&this.utils.removeEvent(document,"paste",this.onPasteDocument)},e.prototype.copyTextToClipboard=function(t){var e=document.createElement("textarea");e.style.position="fixed",e.style.top="-1000px",e.style.left="-1000px",e.style.width="2em",e.style.height="2em",e.style.padding=0,e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",e.value=t,document.body.appendChild(e),e.select();try{document.execCommand("copy");return!0}catch(t){return!1}document.body.removeChild(e)},e.prototype.getClipboardText=function(t){var e={html:"",text:""};try{e.text=t.clipboardData.getData("text/plain"),e.html=t.clipboardData.getData("text/html")}catch(t){}try{e.text||(e.text=window.clipboardData.getData("Text"))}catch(t){}return e},e.prototype.createPastedElement=function(t){var e=document.getElementById("pasted")||document.createElement("div");return e.id="pasted",e.innerHTML=t,e.style.left="-10000px",e.style.top="-10000px",e.style.position="absolute",e.style["z-index"]=-1,document.getElementsByTagName("body")[0].appendChild(e),e},e.prototype.getHtml=function(t){var e=this;setTimeout(function(){var n=t.getElementsByTagName("table");if(n.length)e.parseTable(n[0]),t.style.visibility="hidden";else if(t.innerHTML="",e.clipboardTextPlain){var i=e.parseText(e.clipboardTextPlain);e.emit(e.ON_DATA,i)}else e.emit(e.ON_DATA,!1)},10)},e.prototype.parseText=function(t){for(var e=[],n=t.split("\n"),i=0,r=[],o=[],s=n[0].match(/\t/gi)?n[0].match(/\t/gi).length:0,a=n[0].match(/,/gi)?n[0].match(/,/gi).length:0,c=0;c<n.length;c++){var l=n[c],u=void 0;u=s>=a?l.split(/\t(?=(?:[^\"]*\"[^\"]*\")*(?![^\"]*\"))/):l.split(/,(?=(?:[^\"]*\"[^\"]*\")*(?![^\"]*\"))/),u.length<2&&(l=l.replace(/( {2,9})/gi,","),u=l.split(/,(?=(?:[^\"]*\"[^\"]*\")*(?![^\"]*\"))/)),o[c]=u,u.length>i&&(i=u.length);for(var h=0;h<u.length;h++){var d=Math.ceil(this.getTextWidth(u[h],"normal 12pt Arial"));(!r[h]||r[h]<d)&&(r[h]=d)}}for(var c=0;c<n.length;c++){for(var u=o[c],f=[],h=0;h<i;h++){var p=u[h]?u[h].replace(/['"]+/g,""):"",g=isNaN(parseFloat(p.replace(/,/g,"")))?"left":"right";f.push({style:{color:"000000","background-color":"FFFFFF",lbs:"solid",lbw:"thin",rbw:"thin",bbs:"solid",tbs:"solid",rbs:"solid",tbw:"thin",lbc:"EFEFEF",bbc:"EFEFEF",bbw:"thin",tbc:"EFEFEF",rbc:"EFEFEF","font-weight":"normal","font-style":"normal","font-size":"11pt","font-family":"Calibri","text-align":g,width:r[h]+"px",height:"20px"},formatted_value:p,value:p})}e.push(f)}return e},e.prototype.parseTable=function(t){var e=this.collectClipData(t);this.emit(this.ON_DATA,e)},e.prototype.collectClipData=function(t){for(var e=[],n=this.tableColWidths(t),i=t.rows,r=0,o=0,a=[],c=0;c<i.length;c++){var l=i[c].cells;if(l.length){l.length>r&&(r=l.length,n&&n.length>r&&(r=n.length)),e.push([]);for(var u=0,h=0;h<l.length;h++){var d=l[h].rowSpan,f=l[h].colSpan,p=l[h].getElementsByTagName("a");a[h]&&a[h][o]&&e[o].push(a[h][o]);var g=l[h].textContent;p&&p.length&&(g=p[0].textContent),g=g.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&nbsp;/g," ").trim();var y={value:this.getRawValue(g,l[h].dataset.format),formatted_value:g};p&&p.length&&(y.link={external:!0,address:p[0].href}),y.style=this.cssToStyles(window.getComputedStyle(l[h]).cssText),l[h].dataset.format&&(y.style["number-format"]=l[h].dataset.format),n&&n[h]?y.style.width=n[u]+"px":"0px"===y.style.width&&(y.style.width="80px"),u++;var v=y.style.color;if(v&&-1===v.indexOf("#")&&-1===v.indexOf("rgb")&&(v="#"+v),this.utils.validHex(v)||(y.style.color="000000"),e[o].push(y),f>1){var m=s.recursive(!0,{},y);m.value="",m.formatted_value="";for(var _=1;_<f;_++)n&&n[u+_]&&(m.style.width=n[u+_]+"px"),e[o].push(m),u++}if(d>1){a[h]=[];for(var b=1;b<d;b++){var m=s.recursive(!0,{},y);m.value="",m.formatted_value="",m.style.height="auto",a[h][o+b]=s.recursive(!0,{},m)}}}o++}}for(var c=0;c<e.length;c++)if(!(e[c].length>=r)){var w=e[c][e[c].length-1];w.value="",w.formatted_value="";for(var _=e[c].length;_<r;_++)e[c].push(w)}return e},e.prototype.tableColWidths=function(t){var e=t.getElementsByTagName("colgroup");if(e.length){for(var n=[],i=e[0].getElementsByTagName("col"),r=0;r<i.length;r++)if(n.push(parseInt(i[r].width,10)),i[r].span&&i[r].span>1)for(var o=0;o<i[r].span-1;o++)n.push(parseInt(i[r].width,10));return n}},e.prototype.getRawValue=function(t,e){return void 0===e&&(e="@"),t},e.prototype.cssToStyles=function(t){for(var e=t.split(";"),n={},i=0;i<e.length;i++){var r=e[i].split(":");if(!(r.length<2)){var o=r[0].trim(),s=r[1].trim(),a=!1;if(o.indexOf("border-")>-1){var c=o.split("-");3===c.length&&-1!==this.borderSides.indexOf(c[1])&&-1!==this.borderSyles.indexOf(c[2])&&(a=!0)}if((-1!==this.validStyles.indexOf(o)||a)&&(s=s.split("!")[0],"font-family"===o&&(s=s.split(",")[0].replace(/"/gi,"")),("color"===o||"background-color"===o||-1!==o.indexOf("-color"))&&s.indexOf("rgb")>=0&&(s=""+this.utils.rgbToHex(s)),"font-size"===o&&s.indexOf("px")&&(s=Math.round(.73*parseFloat(s))+"pt"),"word-wrap"===o&&(n["text-wrap"]=s.trim()),"white-space"===o&&"normal"===s&&(s="inherit"),"text-align"===o&&(s.indexOf("right")>-1?s="right":s.indexOf("justify")>-1||s.indexOf("left")>-1?s="left":s.indexOf("center")>-1&&(s="center")),n[o]=s.trim(),a)){var l=this.mapExcelBorder(o,s);l&&(n[l.name]=l.value)}}}return n},e.prototype.mapExcelBorder=function(t,e){var n=t.split("-");if(3===n.length){var i=[n[1].substr(0,1),n[0].substr(0,1)];if(-1!==this.excelStyles.indexOf(i.join(""))&&-1!==this.borderSyles.indexOf(n[2])){var r=this.borderSyles.indexOf(n[2]),o=this.borderSyles[r];i.push(o.substr(0,1));var s="";switch(o){case"width":s=this.excelBorderWeights[Math.round(parseFloat(e))+"px"]||"none";break;case"style":s=this.excelBorderStyles[e]||"none";break;default:s=e}return{name:i.join(""),value:s}}}},e.prototype.getTextWidth=function(t,e){var n=this.getTextWidth.canvas||(this.getTextWidth.canvas=document.createElement("canvas")),i=n.getContext("2d");return i.font=e,i.measureText(t).width},e}(r.default);e.Clipboard=a;var c=function(){function t(){return a}return t.$inject=[],t}();e.ClipboardWrap=c},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r,o,s,a=n(1),c=n(11),l=n(12),u=function(){function t(t,e,n){return r=t,o=e,s=n,h}return t.$inject=["$q","ippStorageService","ippConfig"],t}();e.default=u;var h=function(t){function e(e){var n=t.call(this)||this;n.container=e,n.data=[],n.rendering=!1,n.annotationId="pdfAnnotations",n.pdfPages=1,n.pdfPage=1,n._fit="contain",n.touch=!1,n.hammer=!1,n.scale=1,n.ratio=1,n.ratioScale=1,n.scrollbars={width:8,inset:!1,scrolling:!1,x:{size:0,offset:0,offsetPercent:0,label:"width",style:"margin-left",show:!1,anchor:"left",track:void 0,handle:void 0},y:{size:0,offset:0,offsetPercent:0,label:"height",style:"margin-top",show:!1,anchor:"top",track:void 0,handle:void 0}},n.onResizeEvent=function(t){n.setAnnotationsBounds(),n.updateScrollbars(),n.setFit(n.fit)},n.onWheelEvent=function(t){var e=Math.abs(t.deltaY)>=100?Math.round(Math.abs(t.deltaY)/5):20;e*=t.deltaY>0?1:-1;var i="y";n.canvasBounds.height<=n.containerBounds.height&&n.canvasBounds.width>n.containerBounds.width&&(i="x"),n.moveScrollbarTrack(i,e)},n.onMouseUp=function(t){n.scrollbars.scrolling=!1,["x","y"].forEach2(function(t){n.scrollbars[t].drag=!1})},n.onMouseDown=function(t){},n.onKeydown=function(t){switch(t.keyCode){case 37:n.page("prev");break;case 39:n.page("next")}},n.onMouseMove=function(t){["x","y"].forEach2(function(e){if(n.scrollbars[e].drag&&n.scrollbars.scrolling){var i=t[e]-n.scrollbars[e].start;n.moveScrollbarTrack(e,i),n.scrollbars[e].start=t[e]}})},n.destroy();var i=new l,r=i.getResult();return n.touch=r.device&&("tablet"===r.device.type||"mobile"===r.device.type),n.pdfLink=new d,n.pdfLink.register(function(t,e){t===n.pdfLink.ON_GOTO_PAGE&&(n.pdfPage=e,n.renderPdf())}),n.containerEl="string"==typeof e?document.getElementById(e):e,n.containerEl.style.overflow=n.touch?"auto":"hidden",n.containerEl.style["text-align"]="center",n.canvasEl=document.createElement("canvas"),n.annotationsEl=document.createElementNS("http://www.w3.org/2000/svg","svg"),n.annotationsEl.style.position="absolute",n.annotationsEl.style["z-index"]="1",n.annotationsEl.style.left="0",n.annotationsEl.style.top="0",n.containerEl.appendChild(n.canvasEl),n.containerEl.appendChild(n.annotationsEl),n.ratio=window.devicePixelRatio,n.scale=n.ratio,n.ratioScale=n.scale,n.touch?n.setupTouch():(n.containerEl.addEventListener("wheel",n.onWheelEvent,!1),window.addEventListener("mouseup",n.onMouseUp,!1),window.addEventListener("mousedown",n.onMouseDown,!1),window.addEventListener("mousemove",n.onMouseMove,!1),window.addEventListener("keydown",n.onKeydown,!1),n.createScrollbars()),window.addEventListener("resize",n.onResizeEvent),n}return i(e,t),Object.defineProperty(e.prototype,"ON_LOADING",{get:function(){return"loading"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ON_LOADED",{get:function(){return"loaded"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fit",{get:function(){return this._fit},set:function(t){-1!==["scroll","width","height","contain"].indexOf(t)&&(this._fit=t)},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.containerEl&&(document.removeEventListener("resize",this.onResizeEvent),this.containerEl.innerHTML="",this.hammer?this.hammer.destroy():(this.containerEl.removeEventListener("wheel",this.onWheelEvent,!1),window.removeEventListener("mouseup",this.onMouseUp,!1),window.removeEventListener("mousedown",this.onMouseDown,!1),window.removeEventListener("mousemove",this.onMouseMove,!1),window.removeEventListener("keydown",this.onKeydown,!1)))},e.prototype.render=function(t){var e=this,n=r.defer();if(this.data=t,!this.data||!this.data[0]||!this.data[0][0])return n.reject(!1),n.promise;this.fileUrl=this.handleURL(this.data[0][0].formatted_value||this.data[0][0].value),this.rendering=!0;var i={};return this.fileUrl.indexOf("ipushpull.")>=0&&(i={Authorization:"Bearer "+o.persistent.get("access_token"),"x-ipp-client":s.api_key}),PDFJS.getDocument({url:this.fileUrl,httpHeaders:i},void 0,void 0,function(t){e.emit(e.ON_LOADING,t)}).then(function(t){e.pdfObj=t,e.pdfLink.setDocument(t),e.pdfPages=t.numPages,e.renderPdf(),n.resolve(!0)},function(t){n.reject(t)}),n.promise},e.prototype.setFit=function(t){if(-1!==["scroll","width","height","contain"].indexOf(t)){if(this.fit=t,"scroll"===t)this.canvasEl.style.width="auto",this.canvasEl.style.height="auto";else if("width"===t)this.canvasEl.style.width="100%",this.canvasEl.style.height="auto";else if("height"===t)this.canvasEl.style.width="auto",this.canvasEl.style.height="100%";else if("contain"===t){var e=this.containerEl.getBoundingClientRect(),n=(this.canvasEl.getBoundingClientRect(),this.canvasEl.width/this.canvasEl.height),i=e.width/e.height;n>i?(this.canvasEl.style.width="100%",this.canvasEl.style.height="auto"):(this.canvasEl.style.width="auto",this.canvasEl.style.height="100%")}this.containerEl.scrollLeft=0,this.containerEl.scrollTop=0,this.resetScrollbars(),this.setAnnotationsBounds(),this.updateScrollbars()}},e.prototype.page=function(t){"next"===t?this.pdfPage++:"prev"===t?this.pdfPage--:this.pdfPage=parseInt(t,10),this.setPage()},e.prototype.resetScrollbars=function(){var t=this;["x","y"].forEach2(function(e){var n=t.scrollbars[e].anchor;t.scrollbars[e].offset=0,t.scrollbars[e].size=0,t.scrollbars[e].show=!1,t.canvasEl.style[t.scrollbars[e].style]="0px",t.annotationsEl.style[t.scrollbars[e].style]="0px",t.scrollbars[e].handle&&(t.scrollbars[e].handle.style[n]="0px")})},e.prototype.moveScrollbarTrack=function(t,e){this.scrollbars[t].offset+=e;var n=this.scrollbars[t].label,i=(this.canvasBounds[n],this.containerBounds[n]-this.scrollbars[t].size);this.scrollbars[t].offset>i?this.scrollbars[t].offset=i:this.scrollbars[t].offset<0&&(this.scrollbars[t].offset=0);var r=this.scrollbars[t].anchor;this.scrollbars[t].handle.style[r]=this.scrollbars[t].offset+"px";var o=this.scrollbars[t].offset/(this.containerBounds[n]-this.scrollbars[t].size),s=(this.containerBounds[n]-this.canvasBounds[n])*o;this.scrollbars[t].offsetPercent=o,this.canvasEl.style[this.scrollbars[t].style]=s+"px",this.annotationsEl.style[this.scrollbars[t].style]=s+"px"},e.prototype.createScrollbars=function(){var t=this;["x","y"].forEach2(function(e){var n=t.scrollbars[e].anchor;t.scrollbars[e].track=document.createElement("div"),t.scrollbars[e].handle=document.createElement("div"),t.scrollbars[e].track.style.position="absolute",t.scrollbars[e].track.style["z-index"]=10,t.scrollbars[e].track.style.display="none",t.scrollbars[e].track.className="track",t.scrollbars[e].handle.style.position="absolute",t.scrollbars[e].handle.style["z-index"]=1,t.scrollbars[e].handle.style.left=0,t.scrollbars[e].handle.style.top=0,t.scrollbars[e].handle.className="handle",t.scrollbars[e].handle.addEventListener("mousedown",function(i){t.scrollbars.scrolling=!0,t.scrollbars[e].start=i[e],t.scrollbars[e].drag=!0,t.scrollbars[e].offset=parseInt(t.scrollbars[e].handle.style[n],10),i.preventDefault()},!1),"x"===e?(t.scrollbars[e].track.style.left=0,t.scrollbars[e].track.style.bottom=0,t.scrollbars[e].track.style.right=0,t.scrollbars[e].track.style.height=t.scrollbars.width+"px",t.scrollbars[e].handle.style.height=t.scrollbars.width+"px"):(t.scrollbars[e].track.style.top=0,t.scrollbars[e].track.style.right=0,t.scrollbars[e].track.style.bottom=0,t.scrollbars[e].track.style.width=t.scrollbars.width+"px",t.scrollbars[e].handle.style.width=t.scrollbars.width+"px"),t.scrollbars[e].track.appendChild(t.scrollbars[e].handle),t.containerEl.appendChild(t.scrollbars[e].track)})},e.prototype.updateScrollbars=function(){var t=this;this.touch||["x","y"].forEach2(function(e){var n=t.scrollbars[e].label;if(t.containerBounds[n]>=t.canvasBounds[n])return void(t.scrollbars[e].track.style.display="none");var i=t.canvasBounds[n],r=t.containerBounds[n]*(t.containerBounds[n]/i);t.scrollbars[e].handle.style[n]=r+"px",t.scrollbars[e].size=r;var o=t.scrollbars[e].anchor,s=t.scrollbars[e].offsetPercent,a=(t.containerBounds[n]-r)*s;t.scrollbars[e].handle.style[o]=a+"px",t.scrollbars[e].track.style.display="block",a=(t.containerBounds[n]-t.canvasBounds[n])*s,t.canvasEl.style[t.scrollbars[e].style]=a+"px",t.annotationsEl.style[t.scrollbars[e].style]=a+"px"})},e.prototype.setAnnotationsBounds=function(){this.containerBounds=this.containerEl.getBoundingClientRect(),this.canvasBounds=this.canvasEl.getBoundingClientRect(),this.annotationsEl.style.left=this.canvasBounds.left-this.containerBounds.left+"px",this.annotationsEl.style.width=this.canvasBounds.width+"px",this.annotationsEl.style.height=this.canvasBounds.height+"px"},e.prototype.setupTouch=function(){var t=this;this.hammer=new c(this.containerEl);var e=new c.Pan,n=new c.Pinch;this.hammer.add([e,n]);var i;this.hammer.on("pinchstart",function(e){var n=t.canvasEl.getBoundingClientRect();i=n.width,t.fit="scroll",t.canvasEl.style.width=i+"px",t.canvasEl.style.height="auto"}),this.hammer.on("pinchmove",function(e){t.canvasEl.style.width=i*e.scale+"px",t.setAnnotationsBounds()}),this.hammer.on("pinchend",function(t){});var r={x:0,y:0,left:this.containerEl.scrollLeft,top:this.containerEl.scrollTop};this.hammer.on("panstart",function(e){r.x=e.center.x,r.y=e.center.y,r.left=t.containerEl.scrollLeft,r.top=t.containerEl.scrollTop}),this.hammer.on("panmove",function(e){t.containerEl.scrollTop=r.top+r.y-e.center.y,t.containerEl.scrollLeft=r.left+r.x-e.center.x}),this.hammer.on("panend",function(t){})},e.prototype.setPage=function(){this.pdfPage>this.pdfPages?this.pdfPage=1:this.pdfPage<=0&&(this.pdfPage=this.pdfPages),this.renderPdf()},e.prototype.renderPdf=function(){var t=this,e=r.defer();return this.pdfObj.getPage(this.pdfPage).then(function(n){var i=n.getViewport(2),r=t.canvasEl.getContext("2d");t.canvasEl.height=i.height,t.canvasEl.width=i.width;var o={canvasContext:r,viewport:i};n.render(o).promise.then(function(o){t.setFit(t.fit),t.emit(t.ON_LOADED,!0),t.renderAnnotations(n,i,r),e.resolve(o)},e.reject)},function(t){}),e.promise},e.prototype.renderAnnotations=function(t,e,n){var i=this,r=this.annotationsEl;if(r){r.innerHTML="",this.setAnnotationsBounds();var o=function(t,n){var r=i.annotationsEl.namespaceURI,o=document.createElementNS(r,"a");o.setAttribute("class","pdf-link"),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"),o.addEventListener("click",function(){n.link?window.open(n.link,"_blank"):n.internal&&i.page(n.page+1)});var s=document.createElementNS(r,"rect");s.setAttribute("x",t.rect[0]),s.setAttribute("y",e.viewBox[3]-t.rect[3]),s.setAttribute("width",t.rect[2]-t.rect[0]),s.setAttribute("height",t.rect[3]-t.rect[1]),s.setAttribute("fill","rgba(30,144,255,1)"),o.appendChild(s),i.annotationsEl.appendChild(o)};t.getAnnotations().then(function(t){e=e.clone({dontFlip:!0}),r.setAttribute("viewBox",e.viewBox.join(" ")),t.forEach2(function(t){t.dest&&"string"==typeof t.dest?i.pdfObj.getDestination(t.dest).then(function(e){i.pdfObj.getPageIndex(e[0]).then(function(e){o(t,{internal:!0,page:e})},function(t){})},function(t){}):t.url&&o(t,{link:t.url})})})}},e.prototype.handleURL=function(t){return t.indexOf("dropbox.com")>-1?(t=t.split("www.dropbox.com").join("dl.dropboxusercontent.com"),s.docs_url+"/default/relay?url="+t):t},e}(a.default),d=function(t){function e(){var e=t.call(this)||this;return e._pagesRefCache=void 0,e}return i(e,t),Object.defineProperty(e.prototype,"ON_GOTO_PAGE",{get:function(){return"goto_page"},enumerable:!0,configurable:!0}),e.prototype.setDocument=function(t,e){this.baseUrl=e,this.pdfDocument=t,this._pagesRefCache={}},Object.defineProperty(e.prototype,"pagesCount",{get:function(){return this.pdfDocument.numPages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"page",{get:function(){return this.pdfViewer.currentPageNumber},set:function(t){this.pdfViewer.currentPageNumber=t},enumerable:!0,configurable:!0}),e.prototype.navigateTo=function(t){var e,n=this,i=function(t){var e=t instanceof Object?n._pagesRefCache[t.num+" "+t.gen+" R"]:t+1;e?(e>n.pagesCount&&(e=n.pagesCount),n.emit(n.ON_GOTO_PAGE,e)):n.pdfDocument.getPageIndex(t).then(function(e){var r=e+1,o=t.num+" "+t.gen+" R";n._pagesRefCache[o]=r,i(t)})};"string"==typeof t?(t,e=this.pdfDocument.getDestination(t)):e=Promise.resolve(t),e.then(function(e){t=e,e instanceof Array&&i(e[0])})},e.prototype.getDestinationHash=function(t){if("string"==typeof t)return this.getAnchorUrl("#"+escape(t));if(t instanceof Array){var e=t[0],n=e instanceof Object?this._pagesRefCache[e.num+" "+e.gen+" R"]:e+1;if(n){var i=this.getAnchorUrl("#page="+n),r=t[1];if("object"==typeof r&&"name"in r&&"XYZ"===r.name){var o=t[4],s=parseFloat(o);s&&(o=100*s),i+="&zoom="+o,(t[2]||t[3])&&(i+=","+(t[2]||0)+","+(t[3]||0))}return i}}return""},e.prototype.getAnchorUrl=function(t){return(this.baseUrl||"")+t},e.prototype.setHash=function(t){},e.prototype.executeNamedAction=function(t){},e.prototype.cachePageRef=function(t,e){var n=e.num+" "+e.gen+" R";this._pagesRefCache[n]=t},e}(a.default)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.$interval=t,this.storage=e,this.history={},this.historyFirst={},this._enabled=!1,this._length=0}return t.prototype.createInstance=function(){return new t(this.$interval,this.storage)},Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(t){var e=this;"boolean"==typeof t&&(this._enabled=t,this.cancel(),t?(this.restore(),this._length=this.totalChanges(),this._interval=this.$interval(function(){var t=e.totalChanges();e._length!==t&&e.storage.user.save("history",JSON.stringify(e.history)),e._length=t},1e4)):this.reset())},enumerable:!0,configurable:!0}),t.prototype.addHistory=function(t,e,n){void 0===n&&(n=!1),this.enabled&&(n&&this.history["page_"+t]&&this.history["page_"+t].length||(this.history["page_"+t]||(this.history["page_"+t]=[]),this.history["page_"+t].push(JSON.parse(JSON.stringify(e)))))},t.prototype.getHistory=function(t){return this.history["page_"+t]?this.history["page_"+t]:[]},t.prototype.getHistoryForCell=function(t,e,n){var i=this.getHistory(t);if(!i.length)return[];var r=[];return i.forEach2(function(t){t.content_diff.forEach2(function(i,o){i&&i.forEach2(function(i,s){i&&e===o&&n===s&&r.push({cell:JSON.parse(JSON.stringify(i)),modified_by:t.modified_by,modified_by_timestamp:t.modified_by_timestamp})})})}),r},t.prototype.restore=function(){this.history=this.storage.user.get("history")||{}},t.prototype.reset=function(){this.history={},this.storage.user.remove("history")},t.prototype.cancel=function(){this._interval&&this.$interval.cancel(this._interval)},t.prototype.totalChanges=function(){var t=0;for(var e in this.history)this.history.hasOwnProperty(e)&&(t+=this.history[e].length);return t},t.$inject=["$interval","ippStorageService"],t}();e.Tracking=i,e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t._instance=function(){return new t},t.prototype.decryptContent=function(t,e){if(this.libCheck()&&e){var n=forge.util.decode64(e),i=n.substring(0,16),r=n.substring(16);r=forge.util.createBuffer(r,"latin1"),i=forge.util.createBuffer(i,"latin1");var o=forge.cipher.createDecipher("AES-CBC",this.hashPassphrase(t.passphrase));o.start({iv:i}),o.update(r);var s;o.finish();try{s=JSON.parse(o.output.toString())}catch(t){s=void 0}return s}},t.prototype.encryptContent=function(t,e){if(this.libCheck()){var n=JSON.stringify(e),i=this.hashPassphrase(t.passphrase),r=forge.random.getBytesSync(16),o=forge.cipher.createCipher("AES-CBC",i);o.start({iv:r}),o.update(forge.util.createBuffer(n,"utf8")),o.finish();var s=o.output,a=forge.util.createBuffer();a.putBytes(r),a.putBytes(s.bytes());var c=a.getBytes();return forge.util.encode64(c)}},t.prototype.hashPassphrase=function(t){var e=forge.md.sha256.create();return e.update(t),e.digest().bytes()},t.prototype.libCheck=function(){return"undefined"!=typeof forge},t}();e.Crypto=i},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r,o,s,a,c,l,u,h,d,f,p,g=n(7),y=n(2),v=n(40),m=n(3),_=n(1),b=n(41),w=n(8),E=n(8),x=n(8),C=n(0),k=n(0),T=function(){function t(t,e,n,i,y,v,m,_){return r=t,o=e,s=n,a=i,c=y,l=v,u=m,h=_,d=new g.default,f=new w.Providers(r,o,a,c,l,h),p=new C.RangesWrap(r,a),S}return t.$inject=["$q","$timeout","$interval","ippApiService","ippAuthService","ippStorageService","ippCryptoService","ippConfig"],t}();e.PageWrap=T;var S=function(t){function e(e,n,i){var r=t.call(this)||this;return r.ready=!1,r.decrypted=!0,r.updatesOn=!0,r._supportsWS=!0,r._wsDisabled=!1,r._checkAccess=!0,r._error=!1,r._encryptionKeyPull={name:"",passphrase:""},r._encryptionKeyPush={name:"",passphrase:""},r.onPageError=function(t){t&&(t.code=t.httpCode||t.code,t.message=t.httpText||t.message||("string"==typeof t.data?t.data:"Page not found"),r.emit(r.EVENT_ERROR,t),404===t.code&&r.destroy(),"redirect"===t.type?(r._wsDisabled=!0,r.init(!0)):r._error=!0)},r.types={regular:r.TYPE_REGULAR,pageAccessReport:r.TYPE_PAGE_ACCESS_REPORT,domainUsageReport:r.TYPE_DOMAIN_USAGE_REPORT,globalUsageReport:r.TYPE_GLOBAL_USAGE_REPORT,pageUpdateReport:r.TYPE_PAGE_UPDATE_REPORT,alert:r.TYPE_ALERT,pdf:r.TYPE_PDF,liveUsage:r.TYPE_LIVE_USAGE_REPORT},r._supportsWS="WebSocket"in window||"MozWebSocket"in window,r._folderId=isNaN(+n)?void 0:n,r._pageId=isNaN(+e)?void 0:e,r._folderName=isNaN(+n)?n:void 0,r._pageName=isNaN(+e)?e:void 0,r._uuid=i,r._pageId||r._uuid?r.init(!!r._uuid):r.getPageId(r._folderName,r._pageName).then(function(t){if(!t.pageId)return void r.onPageError({code:404,message:"Page not found"});r._pageId=t.pageId,r._folderId=t.folderId,r.init()},function(t){r.onPageError(t||{code:404,message:"Page not found"})}),r}return i(e,t),Object.defineProperty(e.prototype,"TYPE_REGULAR",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TYPE_ALERT",{get:function(){return 5},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TYPE_PDF",{get:function(){return 6},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TYPE_PAGE_ACCESS_REPORT",{get:function(){return 1001},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TYPE_DOMAIN_USAGE_REPORT",{get:function(){return 1002},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TYPE_GLOBAL_USAGE_REPORT",{get:function(){return 1003},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TYPE_PAGE_UPDATE_REPORT",{get:function(){return 1004},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TYPE_LIVE_USAGE_REPORT",{get:function(){return 1007},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_READY",{get:function(){return"ready"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_DECRYPTED",{get:function(){return"decrypted"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_NEW_CONTENT",{get:function(){return"new_content"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_NEW_META",{get:function(){return"new_meta"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_RANGES_UPDATED",{get:function(){return"ranges_updated"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_ACCESS_UPDATED",{get:function(){return"access_updated"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EVENT_ERROR",{get:function(){return"error"},enumerable:!0,configurable:!0}),e.create=function(t,n,i,o,s){void 0===i&&(i=0),void 0===s&&(s=!1);var c=r.defer();if(o){var l=new e(o.id,o.domain_id);l.on(l.EVENT_READY,function(){l.clone(t,n).then(c.resolve,c.reject).finally(function(){l.destroy()})})}else a.createPage({domainId:t,data:{name:n,special_page_type:i,organization_public:s}}).then(function(n){var i=new e(n.data.id,t);i.on(i.EVENT_READY,function(){i.stop(),c.resolve(i)}),i.on(i.EVENT_ERROR,function(t){i.stop(),c.reject(t)})},function(t){c.reject(t)});return c.promise},Object.defineProperty(e.prototype,"encryptionKeyPull",{set:function(t){this._encryptionKeyPull=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encryptionKeyPush",{set:function(t){this._encryptionKeyPush=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"access",{get:function(){return this._access},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.updatesOn||(this._provider.start(),this.updatesOn=!0)},e.prototype.stop=function(){this.updatesOn&&(this._provider.stop(),this.updatesOn=!1)},e.prototype.push=function(t,e){var n=this;void 0===t&&(t=!1),void 0===e&&(e={});var i=r.defer(),o=m.clone(this.Content?this.Content._original:void 0),s=function(t){n.Content.dirty=!1,n.Content.update(n.Content.current,!0),t=v({},n._data,t.data),n._provider instanceof E.ProviderREST&&(n._provider.seqNo=n._data.seq_no);var e=!!o&&d.comparePageContent(o,n.Content.current,!0);t.diff=e||void 0,n.emit(n.EVENT_NEW_CONTENT,t),i.resolve(t)};return this._data.encryption_type_to_use||this._data.encryption_type_used||!this.Content.canDoDelta||t?this.pushFull(this.Content.getFull(),e).then(s,i.reject):this.pushDelta(this.Content.getDelta(),e).then(s,i.reject),i.promise},e.prototype.saveMeta=function(t){var e=this,n=r.defer();return delete t.access_rights,0===t.encryption_type_to_use&&(t.encryption_key_to_use=""),a.savePageSettings({domainId:this._folderId,pageId:this._pageId,data:t}).then(function(t){e._data=v({},e._data,t.data),n.resolve(t)},function(t){n.reject(d.parseApiError(t,"Could not save page settings"))}),n.promise},e.prototype.setAsFoldersDefault=function(){var t=this,e=r.defer(),n={domainId:this._folderId,data:{default_page_id:this._pageId}};return a.setDomainDefault(n).then(function(n){t._access.is_users_default_page=!0,e.resolve(n)},e.reject),e.promise},e.prototype.del=function(){var t={domainId:this._folderId,pageId:this._pageId};return a.deletePage(t)},e.prototype.decrypt=function(t){if(t||(t=this._encryptionKeyPull),this._data.encryption_type_used&&!t.passphrase)return void(this.decrypted=!1);if(this._data.encryption_type_used){if(!u)return this.emit(this.EVENT_ERROR,new Error("Encrypted pages not supported")),void(this.decrypted=!1);var e=u.decryptContent({name:t.name,passphrase:t.passphrase},this._data.encrypted_content);e?(this.decrypted=!0,this._data.content=e,this._encryptionKeyPull=t):(this.decrypted=!1,this.emit(this.EVENT_ERROR,new Error('Could not decrypt page with key "'+t.name+'" and passphrase "'+t.passphrase+'"')))}else this.decrypted=!0;this.decrypted&&(this.Content?this.Content.update(this._data.content):this.Content=new b.PageContent(this._data.content),this.emit(this.EVENT_DECRYPTED))},e.prototype.destroy=function(){this._provider&&this._provider.destroy(),this.removeEvent(),this._checkAccess=!1},e.prototype.clone=function(t,n,i){var o=this;void 0===i&&(i={});var s=r.defer();return this.ready?(i.clone_ranges&&1*this._folderId!=1*t&&(i.clone_ranges=!1),e.create(t,n,this._data.special_page_type).then(function(e){e.Content=o.Content,r.all([e.push(!0)]).then(function(n){i.clone_ranges?a.savePageSettings({domainId:t,pageId:e.data.id,data:{access_rights:o._data.access_rights}}).finally(function(){s.resolve(e)}):s.resolve(e)},s.reject)},function(t){s.reject(t)}),s.promise):(s.reject("Page is not ready"),s.promise)},e.prototype.copy=function(t,n,i){var o=this;void 0===i&&(i={});var s=r.defer();if(!this.ready)return s.reject("Page is not ready"),s.promise;var c={access_rights:!0,description:!0,push_interval:!0,pull_interval:!0,is_public:!0,encryption_type_to_use:!0,encryption_key_to_use:!0,background_color:!0,is_obscured_public:!0,record_history:!0,symphony_sid:!0};(!i.access_rights||i.access_rights&&1*this._folderId!=1*t)&&(c.access_rights=!1);var l={};for(var u in c)c[u]&&this._data[u]&&(l[u]=this._data[u]);return e.create(t,n,this._data.special_page_type).then(function(e){i.content&&Object.keys(l).length>0?(e.Content=o.Content,e.push(!0).then(function(){a.savePageSettings({domainId:t,pageId:e.data.id,data:l}).then(function(){s.resolve(e)},s.reject)},s.reject)):i.content?(e.Content=o.Content,e.push(!0).then(function(){s.resolve(e)},s.reject)):Object.keys(l).length>0?a.savePageSettings({domainId:t,pageId:e.data.id,data:l}).then(function(){s.resolve(e)},s.reject):s.resolve(e)},function(t){s.reject(t)}),s.promise},e.prototype.createProvider=function(t){this._provider&&this._provider.destroy(),this._provider=t||!this._supportsWS||"undefined"==typeof io||"polling"===h.transport?new E.ProviderREST(this._pageId,this._folderId,this._uuid):new x.ProviderSocket(this._pageId,this._folderId),this._checkAccess=!0},e.prototype.init=function(t){var e=this;if(this._supportsWS,this.createProvider(t),this._uuid)return this._accessLoaded=!0,void this.registerListeners();this.Ranges=new k.Ranges(this._folderId,this._pageId),this.Ranges.on(this.Ranges.EVENT_UPDATED,function(){e.emit(e.EVENT_RANGES_UPDATED)}),this.checkPageAccess(),this.registerListeners()},e.prototype.checkPageAccess=function(){var t=this;this._checkAccess&&this.getPageAccess().finally(function(){o(function(){t.checkPageAccess()},3e4)})},e.prototype.getPageId=function(t,e){var n=r.defer();return a.getPageByName({domainId:t,pageId:e}).then(function(t){n.resolve({pageId:t.data.id,folderId:t.data.domain_id,wsEnabled:t.ws_enabled})},function(t){n.reject(t)}),n.promise},e.prototype.getPageAccess=function(){var t=this,e=r.defer();return a.getPageAccess({domainId:this._folderId,pageId:this._pageId}).then(function(n){return n.httpCode&&n.httpCode>=300?void e.reject({code:n.httpCode,message:n.data?n.data.detail:"Unauthorized access"}):t._error?(t._error=!1,void t.emit(t.EVENT_READY,!0)):(t._access=n.data,t._accessLoaded=!0,t.checkReady(),!t._access.ws_enabled||t._provider instanceof x.ProviderSocket||t._supportsWS&&!t._wsDisabled&&(t._provider.destroy(),t._provider=new x.ProviderSocket(t._pageId,t._folderId),t.registerListeners()),void e.resolve())},function(n){t.onPageError(n),e.reject()}),e.promise},e.prototype.registerListeners=function(){var t=this;this._provider.on("content_update",function(e){e.special_page_type=t.updatePageType(e.special_page_type);var n=m.clone(t.Content?t.Content.current:0);t._data=y(t._data,e),t.decrypt(),t._contentLoaded=!0,t.checkReady();var i=!!n&&d.comparePageContent(n,t.Content.current);t._data.diff=i||void 0,t.emit(t.EVENT_NEW_CONTENT,t._data)}),this._provider.on("meta_update",function(e){e.special_page_type=t.updatePageType(e.special_page_type),delete e.content,delete e.encrypted_content,t.Ranges||(t.Ranges=new k.Ranges(e.domain_id,e.id),t.Ranges.on(t.Ranges.EVENT_UPDATED,function(){t.emit(t.EVENT_RANGES_UPDATED)})),t._data.access_rights!==e.access_rights&&(t.Ranges.parse(e.access_rights||"[]"),t.emit(t.EVENT_RANGES_UPDATED)),t._data=v({},t._data,e),t._metaLoaded=!0,t.checkReady(),t.emit(t.EVENT_NEW_META,e),!e.ws_enabled||t._provider instanceof x.ProviderSocket||t._supportsWS&&!t._wsDisabled&&(t._provider.destroy(),t._provider=new x.ProviderSocket(t._pageId,t._folderId),t.registerListeners())}),this._provider.on("error",this.onPageError)},e.prototype.pushFull=function(t,e){var n=this;void 0===e&&(e={});var i=r.defer();if(this._data.encryption_type_to_use){if(!this._encryptionKeyPush||this._data.encryption_key_to_use!==this._encryptionKeyPush.name)return i.reject("None or wrong encryption key"),i.promise;var o=this.encrypt(this._encryptionKeyPush,t);if(!o)return i.reject("Encryption failed"),i.promise;this._data.encrypted_content=o,this._data.encryption_type_used=1,this._data.encryption_key_used=this._encryptionKeyPush.name,this._encryptionKeyPull=m.clone(this._encryptionKeyPush)}else this._data.encryption_key_used="",this._data.encryption_type_used=0,this._data.content=t;var s={content:this._data.encryption_type_used?"":this._data.content,encrypted_content:this._data.encrypted_content,encryption_type_used:this._data.encryption_type_used,encryption_key_used:this._data.encryption_key_used};s=v({},s,e);var c={domainId:this._folderId,pageId:this._pageId,data:s};return a.savePageContent(c).then(function(t){n._data.seq_no=t.data.seq_no,i.resolve(t)},i.reject),i.promise},e.prototype.pushDelta=function(t,e){void 0===e&&(e={});var n=r.defer();t=v({},t,e);var i={domainId:this._folderId,pageId:this._pageId,data:t};return a.savePageContentDelta(i).then(n.resolve,n.reject),n.promise},e.prototype.checkReady=function(){this._contentLoaded&&this._metaLoaded&&this._accessLoaded&&!this.ready&&(this.ready=!0,this.emit(this.EVENT_READY))},e.prototype.updatePageType=function(t){return(t>0&&t<5||7===t)&&(t+=1e3),t},e.prototype.encrypt=function(t,e){return u.encryptContent(t,e)},e}(_.default)},function(t,e,n){"use strict";var i=Object.prototype.hasOwnProperty,r=Object.prototype.toString,o=Object.defineProperty,s=Object.getOwnPropertyDescriptor,a=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===r.call(t)},c=function(t){if(!t||"[object Object]"!==r.call(t))return!1;var e=i.call(t,"constructor"),n=t.constructor&&t.constructor.prototype&&i.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!n)return!1;var o;for(o in t);return void 0===o||i.call(t,o)},l=function(t,e){o&&"__proto__"===e.name?o(t,e.name,{enumerable:!0,configurable:!0,value:e.newValue,writable:!0}):t[e.name]=e.newValue},u=function(t,e){if("__proto__"===e){if(!i.call(t,e))return;if(s)return s(t,e).value}return t[e]};t.exports=function t(){var e,n,i,r,o,s,h=arguments[0],d=1,f=arguments.length,p=!1;for("boolean"==typeof h&&(p=h,h=arguments[1]||{},d=2),(null==h||"object"!=typeof h&&"function"!=typeof h)&&(h={});d<f;++d)if(null!=(e=arguments[d]))for(n in e)i=u(h,n),r=u(e,n),h!==r&&(p&&r&&(c(r)||(o=a(r)))?(o?(o=!1,s=i&&a(i)?i:[]):s=i&&c(i)?i:{},l(h,{name:n,newValue:t(p,s,r)})):void 0!==r&&l(h,{name:n,newValue:r}));return h}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(7),r=n(2),o=n(3),s=function(){function t(t){this.canDoDelta=!0,this.dirty=!1,this._original=[[]],this._current=[[]],this._newRows=[],this._newCols=[],this._defaultStyles={"background-color":"FFFFFF",color:"000000","font-family":"sans-serif","font-size":"11pt","font-style":"normal","font-weight":"normal",height:"20px","number-format":"","text-align":"left","text-wrap":"normal",width:"64px",tbs:"none",rbs:"none",bbs:"none",lbs:"none",tbc:"000000",rbc:"000000",bbc:"000000",lbc:"000000",tbw:"none",rbw:"none",bbw:"none",lbw:"none"},this.borders={widths:{none:0,thin:1,medium:2,thick:3},styles:{none:"solid",solid:"solid",double:"double"},names:{t:"top",r:"right",b:"bottom",l:"left"}},this.cellStyles=["background-color","color","font-family","font-size","font-style","font-weight","height","text-align","text-wrap","width","vertical-align"],t&&t.constructor===Array&&t.length&&t[0].length||(t=this.defaultContent()),this._utils=new i.default,this.update(t,!0)}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),t.prototype.update=function(t,e,n){if(void 0===e&&(e=!1),void 0===n&&(n=!1),!this.dirty||n){if(n)return this.dirty=!0,void(this._current=t);this._original=t;for(var i=[],o=r({},this._defaultStyles),s=[],a=0;a<this._original.length;a++){var c=this._original[a];i[a]=[];for(var l=0;l<c.length;l++){var u=void 0;!e&&this._current[a]&&this._current[a][l]&&this._current[a][l].dirty?(u=this._current[a][l],o=r({},u.originalStyle||u.style)):(u=r({},c[l]),u.style=r({},o,u.style),delete u.dirty,o=r({},u.style)),a||(s[l]=u.style.width),u.style.width=s[l],i[a].push(u)}}this._current=i}},t.prototype.reset=function(){for(var t=0;t<this._newRows.length;t++)this._current.splice(this._newRows[t],1);for(var t=0;t<this._newCols.length;t++)for(var e=0;e<this._current.length;e++)this._current[e].splice(this._newCols[t],1);this.dirty=!1,this.update(this._original,!0)},t.prototype.getCell=function(t,e){if(!this._current[t])throw new Error("row out of bounds");if(!this._current[t][e])throw new Error("column out of bounds");return this._current[t][e]},t.prototype.getCells=function(t,e){for(var n=[],i=t.row;i<=e.row;i++)for(var r=t.col;r<=e.col;r++)n[i]||(n[i]=[]),n[i][r]=this._current[i][r];return n},t.prototype.updateCell=function(t,e,n){if(!this._current[t])throw new Error("row out of bounds");if(!this._current[t][e])throw new Error("column out of bounds");n.dirty=!0;var i=r({},this._current[t][e],n);n.style&&(i.style=r({},this._current[t][e].style,n.style),i.originalStyle=r({},this._current[t][e].style)),this._current[t][e]=i},t.prototype.addRow=function(t){this._current[t]||(t=this._current.length-1);var e=[];if(this._current.length)for(var n=0;n<this._current[t].length;n++){var i=o.clone(this._current[t][n]);i.value="",i.formatted_value="",i.formatted_value="",i.dirty=!0,e.push(i)}this._current.splice(t+1,0,e)},t.prototype.addColumn=function(t){this._current[0][t]||(t=this._current[0].length-1);for(var e=0;e<this._current.length;e++){for(var n=void 0,i=0;i<this._current[e].length;i++)i===t&&(n=o.clone(this._current[e][i]),n.value="",n.formatted_value="",n.formatted_value="",n.dirty=!0);this._current[e].splice(t+1,0,n)}},t.prototype.removeRow=function(t){this._current[t]&&1!==this._current.length&&this._current.splice(t,1)},t.prototype.removeColumn=function(t){if(this._current[0][t]&&1!==this._current[0].length)for(var e=0;e<this._current.length;e++)this._current[e].splice(t,1)},t.prototype.getDelta=function(){var t=this._utils.clonePageContent(this._current),e={new_rows:[],new_cols:[],content_delta:[{row_index:0,cols:[{col_index:0,cell_content:{value:""}}]}]};e.content_delta=[],e.new_rows=this._newRows,e.new_cols=this._newCols;for(var n=0,i=0,r=0;r<t.length;r++){var s={},a=this._newRows.indexOf(r)>=0;i=0,a&&(s={row_index:r,cols:[]},n++);for(var c=0;c<t[r].length;c++)if(a){var l=o.clone(t[r][c]);delete l.dirty,s.cols.push({col_index:c,cell_content:l})}else{var u=this._newCols.indexOf(c)>=0;if(u&&i++,u||t[r][c].dirty){Object.keys(s).length||(s={row_index:r,cols:[]});var l=o.clone(t[r][c]);delete l.dirty,delete l.originalStyle,s.cols.push({col_index:c,cell_content:l})}}Object.keys(s).length&&e.content_delta.push(s)}return e},t.prototype.getFull=function(){for(var t=this._utils.clonePageContent(this._current),e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)delete t[e][n].dirty,delete t[e][n].originalStyle;return t},t.prototype.getHtml=function(){for(var t=0,e=0,n=0,i=[],r='<table style="border-collapse: collapse;">',o=0;o<this._current.length;o++){i[o]=[];var s=this._current[o];r+="<tr>",t=0;for(var a=0;a<s.length;a++){var c=s[a],l=this.flattenStyles(c.style);r+='<td style="'+l+'"><div>'+c.formatted_value+"</div></td>",t+=parseFloat(c.style.width),o||(e+=parseFloat(c.style.width)),a||(n+=parseFloat(c.style.height)),i[o].push({value:c.formatted_value,style:l})}o||"none"===s[s.length-1].style.rbw||(e+=parseFloat(s[s.length-1].style.rbw)),r+="</tr>"}return"none"!==this._current[this._current.length-1][0].style.rbw&&(n+=parseFloat(this._current[this._current.length-1][0].style.rbw)),r+="</table>",{width:e,height:n,html:r,cells:i}},t.prototype.flattenStyles=function(t){var e={};this.cellStyles.forEach(function(n){e[n]=t[n]});for(var n in this.borders.names){var i=this.borders.names[n],r=this.borders.widths[t[n+"bw"]]+"px",o=t[n+"bs"],s="#"+t[n+"bc"].replace("#","");e["border-"+i]=r+" "+o+" "+s}var a="";for(var c in e){var l=e[c];"background-color"!==c&&"color"!==c||-1!==l.indexOf("#")||(l="#"+l),a+=c+": "+l+"; "}return a},t.prototype.defaultContent=function(){return[[{value:"",formatted_value:""}]]},t}();e.PageContent=s}])});